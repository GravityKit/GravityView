!function($){var gvSearchWidget={selectFields:null,init:function(){var gvsw=gvSearchWidget;$("body").on("click",'h5.field-id-search_widget a[href="#settings"]',gvsw.openDialog),$("body").on("click",".gv-dialog-options a[href='#addSearchField']",gvsw.addField),$("body").on("click",".gv-dialog-options a[href='#removeSearchField']",gvsw.removeField),$("body").on("change",".gv-dialog-options select.gv-search-fields",gvsw.updateRow),$("body").on("dialogbeforeclose",".gv-dialog-options",gvsw.updateOnClose),$("#gravityview_form_id").change(gvsw.clearCache)},openDialog:function(e){var gvsw=gvSearchWidget;e.preventDefault(),gvsw.renderUI($(this).parents(".gv-fields"))},addField:function(e){e.preventDefault();var gvsw=gvSearchWidget,table=$(this).parents("table"),row=$(this).parents("tr");row.hasClass("no-search-fields")&&(row.remove(),row=null),table.find("tr.no-search-fields").remove(),gvsw.addRow(table,row,null)},removeField:function(e){e.preventDefault();var gvsw=gvSearchWidget,table=$(this).parents("table");$(this).parents("tr").remove(),table.find("tr").length<2&&gvsw.addEmptyMsg(table)},renderUI:function(parent){var gvsw=gvSearchWidget,fields=$(".gv-search-fields-value",parent).val(),dialog=$(".gv-dialog-options",parent);$("table",dialog).length||(dialog.append('<p id="gv-loading">'+gvGlobals.loading_text+"</p>"),table=gvsw.addTable(),""===fields?gvsw.addEmptyMsg(table):gvsw.populateRows(table,fields),dialog.append(table),dialog.find("table tbody").sortable(),$("#gv-loading").remove())},populateRows:function(table,fields){var gvsw=gvSearchWidget,rows=$.parseJSON(fields),pos=null;$.each(rows,function(i,values){gvsw.addRow(table,pos,values),pos=table.find("tbody tr:last")})},addTable:function(){return $('<table cellpading="0" cellspacing="0" border="0"><thead><tr><th>&nbsp;</th><th>'+gvSearchVar.label_searchfield+"</th><th>"+gvSearchVar.label_inputtype+"</th><th>&nbsp;</th></tr><thead><tbody></tbody></table>")},addEmptyMsg:function(table){$(table).append('<tr class="no-search-fields"><td colspan="4">&nbsp;'+gvSearchVar.label_nofields+'&nbsp;&nbsp;<a href="#addSearchField">'+gvSearchVar.label_addfield+"</a></td></tr>")},addRow:function(table,row,curr){var gvsw=gvSearchWidget;if(null===gvsw.selectFields)return void gvsw.getSelectFields(table,row,curr);var rowString='<tr class="gv-search-field-row new-row"><td><span class="dashicons dashicons-sort"></span></td><td>'+gvsw.selectFields+'</td><td class="row-inputs"><select class="gv-search-inputs"></select></td><td class="row-options"><a href="#addSearchField" class="dashicons dashicons-plus-alt"></a><a href="#removeSearchField" class="dashicons dashicons-dismiss"></a></td></tr>';null!==row&&row.length?$(row,table).after(rowString):$("tbody",table).append(rowString),table.find("tr.new-row").each(function(){null!==curr&&$(this).find("select.gv-search-fields").val(curr.field),gvsw.updateSelectInput($(this)),null!==curr&&$(this).find("select.gv-search-inputs").val(curr.input),$(this).removeClass("new-row")})},updateRow:function(){var row=$(this).parents("tr");gvSearchWidget.updateSelectInput(row)},updateSelectInput:function(tr){var gvsw=gvSearchWidget,type=tr.find("select.gv-search-fields option:selected").attr("data-type"),options=gvsw.getSelectInput(type);tr.find("select.gv-search-inputs").html(options)},getSelectFields:function(table,row,curr){var gvsw=gvSearchWidget;$.ajax({url:ajaxurl,type:"POST",async:!0,dataType:"html",data:{action:"gv_searchable_fields",nonce:gvSearchVar.nonce,formid:$("#gravityview_form_id").val()},success:function(response){"0"!==response&&(gvsw.selectFields=response,gvsw.addRow(table,row,curr))}})},getSelectInput:function(type){var types=$.parseJSON(gvSearchVar.inputs),options="",list=types.text;return"multi"===type?list=types.multi:"date"===type&&(list=types.date),$.each(list,function(key,label){options+='<option value="'+key+'">'+label+"</option>"}),options},updateOnClose:function(){var dialog=$(this),configs=[];dialog.find("table tr.gv-search-field-row").each(function(){var row={};row.field=$(this).find("select.gv-search-fields").val(),row.input=$(this).find("select.gv-search-inputs").val(),configs.push(row)}),$(".gv-search-fields-value",dialog).val(JSON.stringify(configs))},clearCache:function(){gvsw.selectFields=null}};$(document).ready(function(){gvSearchWidget.init()})}(jQuery);