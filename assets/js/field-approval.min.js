!function($){"use strict";var self={response:{status:""},debug:!1,dt_selector:".gv-datatables",css_classes:{approved:"gv-approval-approved",unapproved:"gv-approval-unapproved",disapproved:"gv-approval-disapproved",loading:"gv-approval-loading"},selector:".gv-approval-toggle"};$(function(){self.setup_triggers()}),self.setup_triggers=function(){$(self.dt_selector).length>0?$(".gv-datatables").on("draw.dt",self.add_toggle_approval_trigger):self.add_toggle_approval_trigger()},self.add_toggle_approval_trigger=function(){var gv_select_status=function(element,status){$(element).find("a").removeClass("selected").end().find('a[data-approved="'+status+'"]').addClass("selected")};tippy(self.selector,{interactive:!0,arrow:!0,arrowType:"round",theme:"light-border",content:gvApproval.status_popover_template,placement:gvApproval.status_popover_placement,onShow:function(showEvent){var $entry_element=$(showEvent.reference),current_status=parseInt($entry_element.attr("data-current-status"),10),onClickHandler=function(linkClickEvent){linkClickEvent.preventDefault();var new_status=parseInt($(linkClickEvent.target).attr("data-approved"),10);$entry_element._newStatus=new_status,self.toggle_approval(linkClickEvent,$entry_element),gv_select_status(showEvent.popper,new_status)};document.gvStatusKeyPressHandler=function(keyPressEvent){keyPressEvent.preventDefault();var key=keyPressEvent.key||keyPressEvent.keyCode;if("Escape"===key||"Esc"===key)return void showEvent.popper._tippy.hide();-1!==["1","2","3"].indexOf(key)&&$(showEvent.popper).find('a[data-approved="'+key+'"]').trigger("click")},$(document).on("keyup",document.gvStatusKeyPressHandler),$(showEvent.popper).on("click",onClickHandler),gv_select_status(showEvent.popper,current_status)},onHide:function(hideEvent){$(hideEvent.popper).off("click"),$(document).off("keyup",document.gvStatusKeyPressHandler)}}),$(self.selector).on("click",function(e){if(e.preventDefault(),$(e.target).hasClass(self.css_classes.loading))return self.debug&&console.log("add_toggle_approval_trigger","Cannot toggle approval while approval is pending."),!1;self.toggle_approval(e)})},self.toggle_approval=function(e,$target){if(e.preventDefault(),$target&&$target._newStatus)var $link=$target,new_status=$target._newStatus;else var $link=$(e.target).is("span")?$(e.target).parent():$(e.target),new_status=self.get_new_status(e,$link.attr("data-current-status"));var entry_slug=$link.attr("data-entry-slug"),form_id=$link.attr("data-form-id");return self.debug&&console.log("toggle_approval",{target:e.target,current_approval_value:$link.attr("data-current-status"),new_status:new_status}),$link.addClass(self.css_classes.loading),self.update_approval(entry_slug,form_id,new_status,$link),!1},self.get_new_status=function(e,old_status){var new_status;if(e.altKey)return e.preventDefault(),e.shiftKey?gvApproval.status.disapproved.value:gvApproval.status.unapproved.value;switch(old_status+""){case gvApproval.status.approved.value+"":new_status=gvApproval.status.disapproved.value;break;default:new_status=gvApproval.status.approved.value}return new_status},self.update_approval=function(entry_slug,form_id,set_approved,$target){var css_class,new_status,data={action:"gv_update_approved",entry_slug:entry_slug,form_id:form_id,approved:set_approved,nonce:gvApproval.nonce};return $target.attr("aria-busy",!0),$.post(gvApproval.ajaxurl,data,function(response){if(response.success){switch(response.data.status){case gvApproval.status.approved.value:new_status=gvApproval.status.approved,css_class=self.css_classes.approved;break;case gvApproval.status.disapproved.value:new_status=gvApproval.status.disapproved,css_class=self.css_classes.disapproved;break;case gvApproval.status.unapproved.value:new_status=gvApproval.status.unapproved,css_class=self.css_classes.unapproved}$target.prop("title",new_status.title).attr("data-current-status",response.data.status).removeClass(self.css_classes.disapproved).removeClass(self.css_classes.approved).removeClass(self.css_classes.unapproved).addClass(css_class).find("span").text(new_status.label)}else"0"!==response&&(self.debug&&console.error("AJAX Error",response),alert(response.data[0].message));$target.attr("aria-busy",!1).removeClass(self.css_classes.loading),self.debug&&console.log("update_approval",{data:data,response:response})}),!0}}(jQuery);