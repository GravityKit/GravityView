!function($){"use strict";var self={response:{status:""},debug:!1,dt_selector:".gv-datatables",css_classes:{approved:"gv-approval-approved",unapproved:"gv-approval-unapproved",disapproved:"gv-approval-disapproved",loading:"gv-approval-loading"},selector:".gv-approval-toggle"};$(function(){self.setup_triggers()}),self.setup_triggers=function(){$(self.dt_selector).length>0?$(".gv-datatables").on("draw.dt",self.add_toggle_approval_trigger):self.add_toggle_approval_trigger()},self.add_toggle_approval_trigger=function(){$(self.selector).on("click",function(e){if($(e.target).hasClass(self.css_classes.loading))return e.preventDefault(),self.debug&&console.log("add_toggle_approval_trigger","Cannot toggle approval while approval is pending."),!1;self.toggle_approval(e)})},self.toggle_approval=function(e){e.preventDefault();var $link=$(e.target).is("span")?$(e.target).parent():$(e.target),entry_slug=$link.attr("data-entry-slug"),form_id=$link.attr("data-form-id"),new_status=self.get_new_status($link.attr("data-current-status"));return self.debug&&console.log("toggle_approval",{target:e.target,current_approval_value:$link.attr("data-current-status"),new_status:new_status}),$link.addClass(self.css_classes.loading),self.update_approval(entry_slug,form_id,new_status,$link),!1},self.get_new_status=function(old_status){var new_status;switch(old_status+""){case gvApproval.status.approved.value+"":new_status=gvApproval.status.disapproved.value;break;default:new_status=gvApproval.status.approved.value}return new_status},self.update_approval=function(entry_slug,form_id,set_approved,$target){var css_class,new_status,data={action:"gv_update_approved",entry_slug:entry_slug,form_id:form_id,approved:set_approved,nonce:gvApproval.nonce};return $target.attr("aria-busy",!0),$.post(gvApproval.ajaxurl,data,function(response){if(response.success){switch(response.data.status){case gvApproval.status.approved.value:new_status=gvApproval.status.approved,css_class=self.css_classes.approved;break;case gvApproval.status.disapproved.value:new_status=gvApproval.status.disapproved,css_class=self.css_classes.disapproved;break;case gvApproval.status.unapproved.value:new_status=gvApproval.status.unapproved,css_class=self.css_classes.unapproved}$target.prop("title",new_status.title).attr("data-current-status",response.data.status).removeClass(self.css_classes.disapproved).removeClass(self.css_classes.approved).removeClass(self.css_classes.unapproved).addClass(css_class).find("span").text(new_status.label)}else"0"!==response&&(self.debug&&console.error("AJAX Error",response),alert(response.data[0].message));$target.attr("aria-busy",!1).removeClass(self.css_classes.loading),self.debug&&console.log("update_approval",{data:data,response:response})}),!0}}(jQuery);