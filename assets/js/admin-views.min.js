!function($){var viewConfiguration,viewGeneralSettings;viewConfiguration={startFreshStatus:!1,hasUnsavedChanges:!1,altKey:!1,dialogWidth:750,performingAjaxAction:!1,init:function(){var vcfg=viewConfiguration;vcfg.gvSelectForm=$("#gravityview_form_id"),vcfg.gvSwitchView=$("#gv_switch_view_button"),vcfg.currentFormId=vcfg.gvSelectForm.val(),vcfg.currentTemplateId=$("#gravityview_directory_template").val(),vcfg.toggleInitialVisibility(vcfg),$("body").on("keydown keyup",vcfg.altKeyListener).on("change","#gravityview_form_id",vcfg.formChange).on("click",'a[href="#gv_start_fresh"]',vcfg.startFresh).on("click","#publish, #save-post",vcfg.processFormSubmit).on("submit","#post",vcfg.processFormSubmit).on("click",".gv-view-types-hover",vcfg.selectTemplateHover).on("click","a[rel*=external]",vcfg.openExternalLinks).on("click mouseup keyup",vcfg.closeTooltips).on("click",'.gv-field-filter-form span[role="button"]',vcfg.switchTooltipLayout).on("click","#gv_switch_view_button",vcfg.switchView).on("click",".clear-all-fields",vcfg.removeAllFields).on("click",".gv_select_template",vcfg.selectTemplate).on("click",".ui-tooltip-content .gv-fields",vcfg.startAddField).on("click",".gv-shortcode input",vcfg.selectText).on("gravityview_form_change",vcfg.updateFormLinks).on("gravityview_form_change",vcfg.updateWidgetFormIds).on("change",".gv-dialog-options input[name*=show_as_link]",vcfg.toggleShowAsEntry).on("change",".gv-dialog-options input[name*=only_loggedin]",vcfg.toggleCustomVisibility).on("change",".gv-dialog-options [name*=allow_edit_cap]",vcfg.toggleCustomVisibility).on("click",".gv-field-controls .gv-remove-field",vcfg.removeField).on("click",".gv-field-controls .gv-field-settings",vcfg.openFieldSettings).on("dblclick",".gv-fields:not(.gv-nonexistent-form-field)",vcfg.openFieldSettings).on("change",".gv-setting-list, #gravityview_settings, .gv-dialog-options",vcfg.toggleCheckboxes).on("change","#gravityview_settings",vcfg.zebraStripeSettings).on("click",".gv-field-details--toggle",function(e){var $dialog=$(this).parents(".ui-dialog"),was_closed=$(".gv-field-details",$dialog).hasClass("gv-field-details--closed");return viewConfiguration.toggleFieldDetails($dialog,was_closed),$.cookie("gv-field-details-expanded",was_closed,{path:gvGlobals.admin_cookiepath}),!1}).on("search keydown keyup",".gv-field-filter-form input:visible",vcfg.setupFieldFilters).on("click",".gv-section .is-dismissible .notice-dismiss",function(e){var warning_name=$(this).parents(".gv-section").attr("id")+"-"+$("#post_ID").val();$.cookie("warning-dismissed-"+warning_name,1,{path:gvGlobals.admin_cookiepath}),$("body").trigger("gravityview/tabs-ready")}).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry",vcfg.toggleTabConfigurationWarnings).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry gravityview/view-config-updated",vcfg.toggleRemoveAllFields).on("search keydown keyup",".gv-field-filter-form input:visible",vcfg.setupFieldFilters).on("focus",".gv-add-field",function(e){$(this).parent(".gv-fields").addClass("trigger--hover")}).on("blur",".gv-add-field",function(e){$(this).parent(".gv-fields").removeClass("trigger--hover")}).on("keydown",".gv-add-field",function(e){if(13!==e.keyCode&&32!==e.keyCode)return!0;$(this).parent(".gv-fields").addClass("trigger--active")}).on("keyup",".gv-add-field",function(e){if(13!==e.keyCode&&32!==e.keyCode)return!0;$(this).parent(".gv-fields").removeClass("trigger--active")}),$(window).resize(function(){var $open_dialog=$(".ui-dialog:visible").find(".ui-dialog-content");$open_dialog.dialog("option","position",{my:"center",at:"center",of:window});var window_width=vcfg.dialogWidth,ninety_five_per=.95*$(window).width();vcfg.dialogWidth>ninety_five_per&&(window_width=ninety_five_per),$open_dialog.dialog("option","width",window_width)}),window.onbeforeunload=function(){return!!vcfg.hasUnsavedChanges||null},gvGlobals.passed_form_id&&vcfg.gvSelectForm.trigger("change")},getCookieVal:function(cookie){return!(!cookie||"undefined"===cookie||"false"===cookie)&&cookie},toggleTabConfigurationWarnings:function(e){var tabs={single:{configured:$(".gv-dialog-options input[name*=show_as_link]:checked","#directory-active-fields").length||$('[data-fieldid="entry_link"]',"#directory-active-fields").length,icon:"dashicons-media-default"},edit:{configured:$('.gv-fields .field-key[value="edit_link"]').length,icon:"dashicons-welcome-write-blog"}};$.each(tabs,function(index,value){var warning_name=index+"-fields-"+$("#post_ID").val(),dismissed_warning=viewConfiguration.getCookieVal($.cookie("warning-dismissed-"+warning_name)),show_warning=!dismissed_warning&&0===value.configured;$("#"+index+"-fields").find(".notice-warning").toggle(show_warning),$('li[aria-controls="'+index+'-view"]').toggleClass("tab-not-configured",show_warning).find(".tab-icon").toggleClass("dashicons-warning",show_warning).toggleClass(value.icon,!show_warning)})},altKeyListener:function(e){viewConfiguration.altKey=e.altKey},zebraStripeSettings:function(){jQuery("#gravityview_settings").find("table").each(function(){$trs=$(this).find("tr").not('[style="display: none;"]'),$trs.removeClass("alternate"),$trs.filter(":even").addClass("alternate")})},toggleCheckboxes:function(e){var target=e.currentTarget?e.currentTarget:e;viewConfiguration.toggleRequired(target,"requires",!1),viewConfiguration.toggleRequired(target,"requires-not",!0);var $parent=$(target).is(".gv-fields")?$(target):$(target).parents(".gv-fields");viewConfiguration.toggleDisabled($("input:checkbox[name*=link_to_]",$parent),$("input:checkbox[name*=show_as_link]",$parent)),viewConfiguration.toggleDisabled($("input:checkbox[name*=link_phone]",$parent),$("input:checkbox[name*=show_as_link]",$parent))},toggleDisabled:function($one,$two){$one.is(":checked")&&$two.attr("disabled",!0),$two.filter(":checked").length>0&&$one.attr("disabled",!0)},toggleRequired:function(currentTarget,data_attr,reverse_logic){var $parent=$(currentTarget);$parent.find("[data-"+data_attr+"]").each(function(){var requires=$(this).data(data_attr),requires_array=requires.split("="),requires_name=requires_array[0],requires_value=requires_array[1],$input=$parent.find(':input[name$="['+requires_name+']"]');$input.is(":checkbox")?reverse_logic?$(this).toggle($input.not(":checked")):$(this).toggle($input.is(":checked")):void 0!==requires_value&&(reverse_logic?$(this).toggle($input.val()!==requires_value):$(this).toggle($input.val()===requires_value))})},switchTooltipLayout:function(e){var layout=$(this).data("value");viewConfiguration.setTooltipLayout(layout)},setTooltipLayout:function(layout){$(".gv-items-picker--"+layout).addClass("active"),$(".gv-items-picker").not(".gv-items-picker--"+layout).removeClass("active"),$(".gv-items-picker-container").attr("data-layout",layout),$.cookie("gv-items-picker-layout",layout,{path:gvGlobals.admin_cookiepath})},closeTooltips:function(e){var activeTooltips=$("[data-tooltip='active']"),close=!1,return_false=!1;switch(e.type){case"keyup":if(27===e.keyCode){if($(".ui-autocomplete").is(":visible"))return;close=0===$(".gv-field-filter-form input[data-has-search]:focus").length,return_false=close,window.Beacon&&window.Beacon("close")}((13===e.keyCode||32===e.keyCode)&&$(e.target).is(".close")||$(e.target).is(".dashicons-dismiss"))&&(close=!0);break;case"mouseup":$(e.target).parents(".ui-dialog,.ui-tooltip").length||$(e.target).is(".ui-dialog,.ui-tooltip")?close=!1:activeTooltips.length>0&&(close=!0),$(e.target).parents(".close").length&&(close=!0);break;case"click":$(e.target).is(".gv-overlay")&&(close=!0,return_false=!0,$(e.target).remove())}if(close&&(activeTooltips.tooltip("close"),$(".ui-dialog:visible").find(".ui-dialog-content").dialog("close"),return_false))return!1},toggleShowAsEntry:function(e){var parent=$(e.target).parents(".gv-fields");parent.toggleClass("has-single-entry-link",$(e.target).is(":checked")),parent.find(".gv-field-controls .dashicons-media-default").toggleClass("hide-if-js",$(e.target).not(":checked")),$("body").trigger("gravityview/show-as-entry",$(e.target).is(":checked"))},toggleCustomVisibility:function(e){var custom_visibility;custom_visibility=$(e.target).is("select")?"read"!==$(e.target).val():$(e.target).is(":checked");var parent=$(e.target).parents(".gv-fields");parent.toggleClass("has-custom-visibility",custom_visibility),parent.find(".gv-field-controls .icon-custom-visibility").toggleClass("hide-if-js",!custom_visibility)},selectText:function(e){return e.preventDefault(),$(this).trigger("focus").trigger("select"),!1},toggleInitialVisibility:function(vcfg){0!==vcfg.gvSelectForm.length&&(""===vcfg.currentFormId?vcfg.hideView():$("#gravityview_directory_template").length&&$("#gravityview_directory_template").val().length>0?($("#gravityview_select_template").slideUp(150),vcfg.showViewConfig()):(vcfg.templateFilter("custom"),vcfg.showViewTypeMetabox()),vcfg.togglePreviewButton(),vcfg.zebraStripeSettings(!0))},togglePreviewButton:function(){var preview_button=$("#preview-action").find(".button");""===viewConfiguration.gvSelectForm.val()?preview_button.hide():preview_button.show()},hideView:function(){var vcfg=viewConfiguration;vcfg.currentFormId="",vcfg.togglePreviewButton(),$("#gravityview_view_config, #gravityview_select_template, #gravityview_sort_filter, .gv-form-links").hide(),viewGeneralSettings.metaboxObj.hide()},updateFormLinks:function(){var vcfg=viewConfiguration;$(".gv-form-links a").each(function(){var new_url=$(this).attr("href").replace(/id=([0-9]+)/gm,"id="+vcfg.gvSelectForm.val());$(this).attr("href",new_url)})},updateWidgetFormIds:function(){var vcfg=viewConfiguration;$(".field-form-id").each(function(){$(this).val(vcfg.gvSelectForm.val())})},toggleViewTypeMetabox:function(){var $templates=$("#gravityview_select_template");$templates.is(":visible")?(viewConfiguration.gvSwitchView.text(function(){return $(this).attr("data-text-backup")}),$templates.slideUp(150)):(viewConfiguration.gvSwitchView.attr("data-text-backup",function(){return $(this).text()}).text(gvGlobals.label_cancel),$templates.slideDown(150))},showViewTypeMetabox:function(){$("#gravityview_select_template").slideDown(150)},startFresh:function(e){e.preventDefault();var vcfg=viewConfiguration;vcfg.startFreshStatus=!0,vcfg.getConfiguredFields().length?vcfg.showDialog("#gravityview_select_preset_dialog"):vcfg.startFreshContinue()},startFreshContinue:function(){var vcfg=viewConfiguration;$("#gravityview_form_id_start_fresh").val("1"),$("#gravityview_form_id").val(""),vcfg.currentFormId="",vcfg.currentTemplateId="",vcfg.gvSwitchView.hide(),vcfg.templateFilter("preset"),vcfg.showViewTypeMetabox(),vcfg.hideViewConfig(),vcfg.togglePreviewButton()},formChange:function(e){e.preventDefault();var vcfg=viewConfiguration;vcfg.altKey||(vcfg.startFreshStatus=!1,vcfg.getConfiguredFields().length?vcfg.showDialog("#gravityview_change_form_dialog"):vcfg.formChangeContinue(),vcfg.togglePreviewButton())},formChangeContinue:function(){var vcfg=viewConfiguration;vcfg.gvSelectForm.val()?(vcfg.templateFilter("custom"),vcfg.getAvailableFields(),vcfg.getSortableFields(),vcfg.currentFormId||vcfg.currentTemplateId?vcfg.gvSwitchView.show():(vcfg.showViewTypeMetabox(),vcfg.gvSwitchView.fadeOut(150))):(vcfg.getConfiguredFields().remove(),vcfg.hideView(),vcfg.gvSwitchView.fadeOut(150)),vcfg.currentTemplateId="",vcfg.currentFormId=vcfg.gvSelectForm.val(),vcfg.hasUnsavedChanges=!0,$("body").trigger("gravityview_form_change").addClass("gv-form-changed")},showDialog:function(dialogSelector,buttons){var vcfg=viewConfiguration,thisDialog=$(dialogSelector),cancel_button={text:gvGlobals.label_cancel,click:function(){thisDialog.is("#gravityview_change_form_dialog")?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.val(vcfg.currentFormId)):thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig()),thisDialog.dialog("close")}},continue_button={text:gvGlobals.label_continue,click:function(){thisDialog.is("#gravityview_change_form_dialog")||thisDialog.is("#gravityview_select_preset_dialog")?vcfg.startFreshStatus?vcfg.startFreshContinue():vcfg.formChangeContinue():thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg.selectTemplateContinue(),vcfg.toggleViewTypeMetabox()),thisDialog.dialog("close")}},default_buttons=[cancel_button,continue_button];buttons=buttons||default_buttons,thisDialog.dialog({dialogClass:"wp-dialog gv-dialog",appendTo:thisDialog.parent(),draggable:!1,resizable:!1,width:function(){return $(window).width()>vcfg.dialogWidth?vcfg.dialogWidth:$(window).width()-10},open:function(){return $('<div class="gv-overlay" />').prependTo("#wpwrap"),vcfg.toggleCheckboxes(thisDialog),vcfg.setupFieldDetails(thisDialog),vcfg.setupCodeMirror(thisDialog),$("#directory-fields, #single-fields").find(".active-drop-widget").sortable("disable"),$("#directory-fields, #single-fields, #edit-fields").find(".active-drop-field").sortable("disable"),!0},close:function(e){e.preventDefault(),$("textarea.code",thisDialog).each(function(){$CodeMirror=$(this).next(".CodeMirror"),0!==$CodeMirror.length&&$CodeMirror[0].hasOwnProperty("CodeMirror")&&$CodeMirror[0].CodeMirror.toTextArea()}),$(".gv-field-settings.active","#gravityview_view_config").removeClass("active"),vcfg.setCustomLabel(thisDialog),$("#wpwrap").find("> .gv-overlay").fadeOut("fast",function(){$(this).remove()}),$("#directory-fields, #single-fields").find(".active-drop-widget").sortable("enable"),$("#directory-fields, #single-fields, #edit-fields").find(".active-drop-field").sortable("enable"),$("body").trigger("gravityview/dialog-closed",thisDialog)},closeOnEscape:!0,buttons:buttons})},setupCodeMirror:function(dialog){$("textarea.code",dialog).each(function(){var editor=wp.codeEditor.initialize($(this),{undoDepth:1e3});editor.codemirror.setSize("95%");var $textarea=$(this),editorId=$textarea.attr("id"),mergeTags=window.gfMergeTags.getAutoCompleteMergeTags($textarea),mergeTag="",initialEditorCursorPos=editor.codemirror.getCursor();$textarea.parent().find(".all-merge-tags").insertBefore($textarea),$textarea.autocomplete({appendTo:$textarea.parent(),minLength:1,position:{my:"center top",at:"center bottom",collision:"none"},source:mergeTags,select:function(event,ui){var val=ui.item.value.replace(/^{|}$/gm,""),currentEditorCursorPos=editor.codemirror.getCursor();editor.codemirror.replaceRange(val,initialEditorCursorPos,window.wp.CodeMirror.Pos(currentEditorCursorPos.line,currentEditorCursorPos.ch)),editor.codemirror.focus(),editor.codemirror.setCursor(window.wp.CodeMirror.Pos(currentEditorCursorPos.line,currentEditorCursorPos.ch+val.length+1))}});var $autocompleteEl=$textarea.parent().find("ul.ui-autocomplete"),closeAutocompletion=function(){$("#"+editorId).autocomplete("close")};$("body").on("keyup",function(e){$autocompleteEl.is(":visible")&&27===e.which&&(e.preventDefault(),closeAutocompletion(),$textarea.focus())}),editor.codemirror.on("mousedown",function(){closeAutocompletion()}),editor.codemirror.on("keydown",function(el,e){$autocompleteEl.is(":visible")&&(38!==e.which&&40!==e.which&&13!==e.which||($autocompleteEl.not(":focus")&&$autocompleteEl.focus(),e.preventDefault()))}),editor.codemirror.on("change",function(e,obj){"{}"===obj.text[0]&&(initialEditorCursorPos=editor.codemirror.getCursor());var currentEditorCursorPos=editor.codemirror.getCursor();if(mergeTag=editor.codemirror.getRange({ch:initialEditorCursorPos.ch-1,line:initialEditorCursorPos.line},currentEditorCursorPos),"{"===mergeTag[0])return void $("#"+editorId).autocomplete("search",mergeTag);closeAutocompletion()})})},setupFieldDetails:function(dialog){$(".gv-field-details--container",dialog).insertAfter(".ui-dialog-title:visible");var show_details_cookie=$.cookie("gv-field-details-expanded"),show_details=viewConfiguration.getCookieVal(show_details_cookie);viewConfiguration.toggleFieldDetails(dialog,show_details),viewConfiguration.migrateSurveyScore(dialog)},migrateSurveyScore:function($dialog){if(0!==$dialog.parents('[data-inputtype="survey"]').length){var $score=$dialog.find(".gv-setting-container-score input");$score&&0!=1*$score.val()&&$dialog.find('.gv-setting-container-choice_display input[value="score"]').trigger("click").trigger("focus")}},toggleFieldDetails:function($dialog,show_details){$dialog.find(".gv-field-details").toggleClass("gv-field-details--closed",!show_details).end().find(".gv-field-details--toggle .dashicons").toggleClass("dashicons-arrow-down",!!show_details).toggleClass("dashicons-arrow-right",!show_details).end()},setCustomLabel:function(dialog){var $custom_label,$admin_label=$("[name*=admin_label]",dialog);$custom_label=$admin_label.length&&$admin_label.val()?$admin_label:$("[name*=custom_label]",dialog);var $label=dialog.parents(".gv-fields").find(".gv-field-label-text-container");if($custom_label.length){var custom_label_text=$custom_label.val().trim();custom_label_text.length>0?$label.html(custom_label_text):$label.html($label.attr("data-original-title"))}},getSortableFields:function(context,id){var vcfg=viewConfiguration;$(".gravityview_sort_field").prop("disabled","disabled").empty().append("<option>"+gvGlobals.loading_text+"</option>");var data={action:"gv_sortable_fields_form",nonce:gvGlobals.nonce};void 0!==context&&"preset"===context?data.template_id=id:data.form_id=vcfg.gvSelectForm.val(),$.post(ajaxurl,data,function(response){"false"!==response&&"0"!==response&&$(".gravityview_sort_field").empty().append(response).prop("disabled",null)})},hideViewConfig:function(){$("#gravityview_view_config").slideUp(150),$(document).trigger("gv_admin_views_hideViewConfig")},showViewConfig:function(){$("#gravityview_view_config").slideDown(150),viewGeneralSettings.metaboxObj.show(),viewConfiguration.toggleDropMessage(),viewConfiguration.init_droppables(),viewConfiguration.init_tooltips(),$(document).trigger("gv_admin_views_showViewConfig")},switchView:function(e){e.preventDefault(),e.stopImmediatePropagation();var vcfg=viewConfiguration;vcfg.templateFilter("custom"),vcfg.toggleViewTypeMetabox()},templateFilter:function(templateType){$(".gv-view-types-module").each(function(){$(this).attr("data-filter")===templateType?$(this).parent().show():$(this).parent().hide()})},selectTemplate:function(e){var vcfg=viewConfiguration;e.preventDefault(),e.stopImmediatePropagation(),vcfg.wantedTemplate=$(this);var selectedTemplateId=vcfg.wantedTemplate.attr("data-templateid"),regexMatch=/(.*?)_(.*?)$/i,currTemplateIdSlug=vcfg.currentTemplateId.replace(regexMatch,"$2"),selectedTemplateIdSlug=selectedTemplateId.replace(regexMatch,"$2"),slugmatch=selectedTemplateIdSlug===currTemplateIdSlug;vcfg.currentTemplateId&&!slugmatch&&vcfg.getConfiguredFields().length?vcfg.currentTemplateId!==selectedTemplateId?vcfg.getConfiguredFields().length?vcfg.showDialog("#gravityview_switch_template_dialog"):(vcfg.toggleViewTypeMetabox(),vcfg.selectTemplateContinue(slugmatch)):(vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig()):($("#gravityview_select_template").slideUp(150),vcfg.selectTemplateContinue(slugmatch))},selectTemplateContinue:function(slugmatch){var vcfg=viewConfiguration,selectedTemplateId=vcfg.wantedTemplate.attr("data-templateid");$("#gravityview_directory_template").val(selectedTemplateId).trigger("change");var $parent=vcfg.wantedTemplate.parents(".gv-view-types-module");$parent.parents(".gv-grid").find(".gv-view-types-module").removeClass("gv-selected"),$parent.addClass("gv-selected"),vcfg.waiting("start"),vcfg.startFreshStatus?(vcfg.getAvailableFields("preset",selectedTemplateId),vcfg.getPresetFields(selectedTemplateId),vcfg.getSortableFields("preset",selectedTemplateId)):(slugmatch?vcfg.waiting("stop"):vcfg.updateActiveAreas(selectedTemplateId),vcfg.gvSwitchView.fadeIn(150),vcfg.toggleViewTypeMetabox()),vcfg.currentTemplateId=selectedTemplateId,vcfg.hasUnsavedChanges=!0},selectTemplateHover:function(e){var vcfg=viewConfiguration,$link=$(e.target),$parent=$link.parents(".gv-view-types-module");if($link.is("[rel=internal]")&&!$link.hasClass("gv-layout-activate"))return!0;if(e.preventDefault(),e.stopImmediatePropagation(),$link.hasClass("gv-layout-activate")){if(vcfg.performingAjaxAction)return;var activate=function(){var defer=$.Deferred();return $link.addClass("disabled"),vcfg.performingAjaxAction=!0,$(".gv-view-template-notice").hide(),$.post(ajaxurl,{action:"gravityview_admin_installer_activate",data:{path:$link.attr("data-template-path")}},function(response){if(!response.success)return defer.reject(response.data.error);$parent.find(".gv-view-types-hover > div:eq(0)").hide(),$parent.find(".gv-view-types-hover > div:eq(1)").removeClass("hidden"),$parent.removeClass("gv-view-template-placeholder"),$parent.find(".gv-view-types-hover > div:eq(1) .gv_select_template").trigger("click"),defer.resolve()}).fail(function(){defer.reject(gvAdminInstaller.activateErrorLabel)}),defer.promise()};return void $.when(activate()).always(function(){vcfg.performingAjaxAction=!1,$link.removeClass("disabled")}).fail(function(error){$(".gv-view-template-notice").show().find("p").text(error),document.querySelector(".gv-view-template-notice").scrollIntoView({behavior:"smooth"})})}$(this).find(".gv_select_template").trigger("click")},openExternalLinks:function(){return(!window.Beacon||!($(this).is("[data-beacon-article]")||$(this).is("[data-beacon-article-modal]")||$(this).is("[data-beacon-article-sidebar]")||$(this).is("[data-beacon-article-inline]")))&&(window.open(this.href),!1)},previewTemplate:function(e){e.preventDefault(),e.stopImmediatePropagation();var parent=$(e.currentTarget).parents(".gv-view-types-module");parent.find(".gv-template-preview").dialog({dialogClass:"wp-dialog gv-dialog",appendTo:$("#gravityview_select_template"),width:viewConfiguration.dialogWidth,open:function(){$('<div class="gv-overlay" />').prependTo("#wpwrap")},close:function(){$(this).dialog("option","appendTo",parent),$("#wpwrap").find("> .gv-overlay").fadeOut("fast",function(){$(this).remove()})},closeOnEscape:!0,buttons:[{text:gvGlobals.label_close,click:function(){$(this).dialog("close")}}]})},updateActiveAreas:function(template){var vcfg=viewConfiguration;$("#directory-active-fields, #single-active-fields").children().remove();var data={action:"gv_get_active_areas",template_id:template,nonce:gvGlobals.nonce};vcfg.updateViewConfig(data)},getPresetFields:function(template){var vcfg=viewConfiguration;$("#directory-active-fields, #single-active-fields").children().remove();var data={action:"gv_get_preset_fields",template_id:template,nonce:gvGlobals.nonce};vcfg.updateViewConfig(data)},updateViewConfig:function(data){var vcfg=viewConfiguration;$.post(ajaxurl,data,function(response){if(response){var content=JSON.parse(response);$("#directory-header-widgets").html(content.header),$("#directory-footer-widgets").html(content.footer),$("#directory-active-fields").append(content.directory),$("#single-active-fields").append(content.single),vcfg.showViewConfig(),vcfg.waiting("stop"),$("body").trigger("gravityview/view-config-updated",content)}}),vcfg.hasUnsavedChanges=!0},waiting:function(action){$containers=$("#wpwrap,.gv-fields"),"start"===action?$containers.addClass("gv-wait"):$containers.removeClass("gv-wait")},remove_tooltips:function(el){$(el||".gv-add-field").is(":ui-tooltip")&&$(".gv-add-field").tooltip("destroy").off("click")},init_tooltips:function(el){$(el||".gv-add-field").tooltip({show:150,hide:200,content:function(){var context=$(this).attr("data-context"),formId=$(this).attr("data-formid")||$("#gravityview_form_id").val(),templateId=$("#gravityview_directory_template").val();switch($(this).attr("data-objecttype")){case"field":return $("#"+context+"-available-fields-"+(formId||templateId)).html();case"widget":return $("#directory-available-widgets").html()}},close:function(){$(this).attr("data-tooltip",null)},open:function(event,tooltip){$(this).attr("data-tooltip","active").attr("data-tooltip-id",$(this).attr("aria-describedby")),$focus_item=$("input[type=search]",tooltip.tooltip),$focus_item.length||($focus_item=$(tooltip.tooltip).find(".close").first());var activate_layout="list";$(tooltip).find(".gv-items-picker-container[data-layout]").length?activate_layout=$(tooltip).find(".gv-items-picker-container[data-layout]").attr("data-layout"):(layout_cookie=$.cookie("gv-items-picker-layout"),viewConfiguration.getCookieVal(layout_cookie)&&(activate_layout=layout_cookie)),viewConfiguration.setTooltipLayout(activate_layout),$focus_item.trigger("focus")},closeOnEscape:!0,disabled:!0,position:{my:"center bottom",at:"center top-12"},tooltipClass:"gravityview-item-picker-tooltip top"}).attr("title","").on("mouseout focusout",function(e){e.stopImmediatePropagation()}).on("click",function(e){$(this).attr("title",""),e.preventDefault(),$(this).tooltip("open")})},setupFieldFilters:function(e){var input=$(this).val().trim(),$tooltip=$(this).parents(".ui-tooltip-content"),$resultsNotFound=$tooltip.find(".gv-no-results");if("keydown"===e.type)return void $(this).attr("data-has-search",input.length>0?input.length:null);$tooltip.find(".gv-fields").show().filter(function(){var match_title=$(this).find(".gv-field-label").attr("data-original-title").match(new RegExp(input,"i")),match_id=$(this).attr("data-fieldid").match(new RegExp(input,"i")),match_parent=!!$(this).attr("data-parent-label")&&$(this).attr("data-parent-label").match(new RegExp(input,"i"));return!match_title&&!match_id&&!match_parent}).hide(),$tooltip.find(".gv-fields:visible").length?$resultsNotFound.hide():$resultsNotFound.show()},refreshGFtooltips:function(){$(".gf_tooltip").tooltip({show:500,hide:1e3,content:function(){return $(this).prop("title")}})},getConfiguredFields:function(){return $("#directory-active-fields, #single-active-fields, #edit-active-fields").find(".gv-fields")},getAvailableFields:function(preset,templateid){var vcfg=viewConfiguration;vcfg.toggleDropMessage(),vcfg.getConfiguredFields().remove();var data={action:"gv_available_fields",nonce:gvGlobals.nonce};data.form_preset_ids=void 0!==preset&&"preset"===preset?[templateid]:[vcfg.gvSelectForm.val()],$("#directory-available-fields-"+data.form_preset_ids[0]).length||$.ajax({type:"post",url:ajaxurl,data:data,success:function(response){(response.success||response.data)&&$.each(response.data,function(context,markup){$("#"+context+"-fields").append(markup)})}})},startAddField:function(e){$(this).has(".field-id-all-fields").length?viewConfiguration.addAllFields($(this)):viewConfiguration.addField($(this),e)},addAllFields:function(clicked){clicked.siblings(".gv-fields").filter(function(){var field_id=$(this).data("fieldid");return+field_id===parseInt(field_id,10)}).each(function(){$(this).trigger("click")}),$("a.gv-add-field[data-tooltip='active']").tooltip("close")},addField:function(clicked,e){e.preventDefault();var vcfg=viewConfiguration,newField=clicked.clone().hide(),areaId=clicked.parents(".ui-tooltip").attr("id"),templateId=$("#gravityview_directory_template").val(),tooltipId=clicked.parents(".ui-tooltip").attr("id"),addButton=$('.gv-add-field[data-tooltip-id="'+tooltipId+'"]'),data={action:"gv_field_options",template:templateId,area:addButton.attr("data-areaid"),context:addButton.attr("data-context"),field_id:newField.attr("data-fieldid"),field_label:newField.find(".gv-field-label").attr("data-original-title"),field_type:addButton.attr("data-objecttype"),input_type:newField.attr("data-inputtype"),form_id:parseInt($(clicked).attr("data-formid"),10)||vcfg.currentFormId,nonce:gvGlobals.nonce};$.ajax({type:"POST",url:ajaxurl,data:data,async:!0,beforeSend:function(){vcfg.disable_publish()},complete:function(){vcfg.enable_publish()}}).done(function(response){newField.append(response),$(".gv-dialog-options",newField).length>0&&$(".gv-field-settings",newField).removeClass("hide-if-js"),$('[data-tooltip-id="'+areaId+'"]').parents(".gv-droppable-area").find(".active-drop").append(newField).end().attr("data-tooltip-id",""),$("body").trigger("gravityview/field-added",newField),newField.fadeIn(100,function(){vcfg.refresh_merge_tags()}),vcfg.refreshGFtooltips()}).fail(function(jqXHR){vcfg.enable_publish(),alert(gvGlobals.field_loaderror),console.log(jqXHR)}).always(function(){vcfg.toggleDropMessage(),vcfg.hasUnsavedChanges=!0})},refresh_merge_tags:function(){$(".all-merge-tags").remove(),$merge_tag_supported=$(".merge-tag-support"),"undefined"!=typeof form&&$("body").not(".gv-form-changed")&&$merge_tag_supported.length>=0&&window.gfMergeTags&&(gfMergeTags.hasOwnProperty("destroy")?$merge_tag_supported.each(function(){new gfMergeTagsObj(form,$(this))}):window.gfMergeTags=new gfMergeTagsObj(form))},enable_publish:function(){$(document).trigger("autosave-enable-buttons.edit-post"),$("#publishing-action").find("#publish").prop("disabled",null).removeClass("button-primary-disabled")},disable_publish:function(){$(document).trigger("autosave-disable-buttons.edit-post"),$("#publishing-action").find("#publish").prop("disabled","disabled").addClass("button-primary-disabled")},init_droppables:function(){var vcfg=viewConfiguration;$("#directory-fields, #single-fields").find(".active-drop-widget").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-widget",start:function(event,ui){$("#directory-fields, #single-fields").find(".active-drop-container-widget").addClass("is-receivable")},stop:function(event,ui){$("#directory-fields, #single-fields").find(".active-drop-container-widget").removeClass("is-receivable")},receive:function(event,ui){var sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid");ui.item.find('[name^="widgets['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))}),vcfg.toggleDropMessage()}}),$("#directory-fields, #single-fields, #edit-fields").find(".active-drop-field").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-field",start:function(event,ui){$("#directory-fields, #single-fields, #edit-fields").find(".active-drop-container-field").addClass("is-receivable")},stop:function(event,ui){$("#directory-fields, #single-fields, #edit-fields").find(".active-drop-container-field").removeClass("is-receivable")},receive:function(event,ui){if(ui.item.find(".gv-dialog-options").length>0){var sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid");ui.item.find('[name^="fields['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))})}vcfg.toggleDropMessage()}})},toggleDropMessage:function(){$(".active-drop").each(function(){$(this).find(".gv-fields").length>0?$(this).find(".drop-message").hide():$(this).find(".drop-message").fadeIn(100)})},removeField:function(e){e.preventDefault();var vcfg=viewConfiguration,area=$(e.currentTarget).parents(".active-drop");if(vcfg.hasUnsavedChanges=!0,e.altKey&&$(area).find(".gv-fields").length>1)return void vcfg.removeAllFields(e,area);$(e.currentTarget).parents(".gv-fields").fadeOut("fast",function(){$(this).remove(),$("body").trigger("gravityview/field-removed",$(this)),vcfg.toggleDropMessage()})},removeAllFields:function(e,area){e.preventDefault(),window.confirm(gvGlobals.remove_all_fields)&&(area=area||null,area||(area_id=$(e.originalEvent.target).data("areaid"),area=$(e.originalEvent.target).parents('div[data-areaid="'+area_id+'"]')[0]),$(area).find(".gv-fields").remove(),$("body").trigger("gravityview/all-fields-removed"),viewConfiguration.toggleDropMessage())},toggleRemoveAllFields:function(e,item){has_fields=!1,$(".active-drop:visible").each(function(index,item){has_fields=$(this).find(".gv-fields").length>1,$(".clear-all-fields",$(item).parents(".gv-droppable-area")).toggle(has_fields)})},openFieldSettings:function(e){e.preventDefault();var parent,vcfg=viewConfiguration;parent=$(e.currentTarget).is(".gv-fields")?$(e.currentTarget):$(e.currentTarget).parents(".gv-fields"),$(".gv-field-settings",parent).addClass("active"),vcfg.updateVisibilitySettings(e,!0),$("body").on("change",".gv-fields input:checkbox",vcfg.updateVisibilitySettings);var buttons=[{text:gvGlobals.label_close,class:"button button-link",click:function(){$(this).dialog("close")}}];vcfg.showDialog(parent.find(".gv-dialog-options"),buttons)},updateVisibilitySettings:function(e,first_run){var vcfg=viewConfiguration;first_run=first_run||!1;var $parent=$(e.currentTarget).is(".gv-fields")?$(e.currentTarget):$(e.currentTarget).parents(".gv-fields");$(".gv-setting-list",$parent).trigger("change"),$("input:checkbox",$parent).attr("disabled",null),vcfg.hasUnsavedChanges=!0},toggleVisibility:function($checkbox,$toggled,first_run,inverse){var speed=0,checked=$checkbox.is(":checked");checked=inverse?!checked:checked,checked?$toggled.parents(".gv-setting-container").fadeIn(speed):$toggled.parents(".gv-setting-container").fadeOut(speed)},processFormSubmit:function(e){var vcfg=viewConfiguration,templateId=$("#gravityview_directory_template").val();return vcfg.startFreshStatus?(vcfg.createPresetForm(e,templateId),!1):(!vcfg.startFreshStatus||""===templateId)&&(vcfg.hasUnsavedChanges=!1,vcfg.serializeForm(e))},serializeForm:function(e){var serialized_data,$fields,$post=$("#post");return!!$post.data("gv-valid")||(e.stopImmediatePropagation(),$post.data("gv-valid",!1),$post.data("gv-serialized")?serialized_data=$post.data("gv-serialized"):($fields=$post.find(":input[name^=fields]"),serialized_data=$fields.serialize(),$fields.remove(),$post.data("gv-serialized",serialized_data)),$post.find(":input[name=gv_fields]").remove(),$post.append($("<input/>",{name:"gv_fields",value:serialized_data,type:"hidden"})),setTimeout(function(){$post.data("gv-valid",!0),"click"===e.type?$(e.target).trigger("click"):$post.trigger("submit")},101),!1)},createPresetForm:function(e,templateId){var vcfg=viewConfiguration,$target=$(e.target);e.stopPropagation();var data={action:"gv_set_preset_form",template_id:templateId,nonce:gvGlobals.nonce};return $.ajax({type:"POST",url:ajaxurl,data:data,async:!1,success:function(response){"false"!==response&&"0"!==response?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.find("option:selected").removeAttr("selected").end().append(response),"click"===e.type?$target.trigger("click"):$("#post").trigger("submit")):$target.before('<div id="message" class="error below-h2"><p>'+gvGlobals.label_publisherror+"</p></div>")}}),!1}},viewGeneralSettings={templateId:null,metaboxObj:null,init:function(){viewGeneralSettings.metaboxObj=$("#gravityview_settings"),viewGeneralSettings.initTabs(),$("#gravityview_directory_template").on("change",viewGeneralSettings.updateSettingsDisplay).trigger("change"),$("body").on("gravityview/settings/tab/enable",viewGeneralSettings.enableSettingTab).on("gravityview/settings/tab/disable",viewGeneralSettings.disableSettingTab)},updateSettingsDisplay:function(){viewGeneralSettings.templateId=$(this).val(),$("tr[data-show-if]").each(viewGeneralSettings.toggleSetting)},toggleSetting:function(){var row=$(this),templates=row.attr("data-show-if");templates.length<1||(viewGeneralSettings.templateId.length>0&&templates.indexOf(viewGeneralSettings.templateId)>-1?row.show():(row.find("select, input").val("").prop("checked",!1),row.hide()))},initTabs:function(){viewGeneralSettings.metaboxObj.on("tabscreate",viewGeneralSettings.tabsCreate).insertAfter($("#gravityview_view_config")).tabs().addClass("ui-tabs-vertical ui-helper-clearfix").find("li").removeClass("ui-corner-top")},tabsCreate:function(event,ui){var $container=$(this),$panels=$container.find(".ui-tabs-panel"),max=[];$panels.each(function(){max.push($(this).outerHeight(!0))}).css({"min-height":_.max(max)})},enableSettingTab:function(e,tab){viewGeneralSettings.metaboxObj.tabs("enable",$(tab).attr("id"))},disableSettingTab:function(e,tab){viewGeneralSettings.metaboxObj.tabs("disable",$(tab).attr("id"))}},jQuery(function($){$("#title-prompt-text").text(gvGlobals.label_viewname),viewGeneralSettings.init(),viewConfiguration.init(),$(".gv-datepicker").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1});var cookie_key="gv-active-tab-"+$("#post_ID").val(),activate_tab=$.cookie(cookie_key);!1===viewConfiguration.getCookieVal(activate_tab)&&(activate_tab=0),location.hash&&$(location.hash).length&&(activate_tab=$(location.hash).index()-1),$("#gv-view-configuration-tabs").tabs({active:activate_tab,hide:!1,show:!1,activate:function(event,ui){$.cookie(cookie_key,ui.newTab.index(),{path:gvGlobals.cookiepath}),$("body").trigger("gravityview/tabs-ready")}}),$("body").trigger("gravityview/loaded")}),window.gvAdminActions={initTooltips:viewConfiguration.init_tooltips,removeTooltips:viewConfiguration.remove_tooltips,showDialog:viewConfiguration.showDialog},$(window).load(function(){var _sendToEditor=window.send_to_editor;window.send_to_editor=function(val){var $el=$("#"+window.wpActiveEditor);if(!$el.hasClass("codemirror"))return _sendToEditor(val);var codeMirror=$el.next(".CodeMirror")[0].CodeMirror,cursorPosition=codeMirror.getCursor();codeMirror.replaceRange(val,window.wp.CodeMirror.Pos(cursorPosition.line,cursorPosition.ch))}})}(jQuery);