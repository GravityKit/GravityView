!function($){var viewConfiguration,viewGeneralSettings;$.widget.bridge("gvTooltip",$.ui.tooltip),viewConfiguration={startFreshStatus:!1,hasUnsavedChanges:!1,altKey:!1,dialogWidth:750,performingAjaxAction:!1,init:function(){var vcfg=viewConfiguration;vcfg.gvSelectForm=$("#gravityview_form_id"),vcfg.gvSwitchView=$("#gv_switch_view_button"),vcfg.currentFormId=vcfg.gvSelectForm.val(),vcfg.currentTemplateId=$("#gravityview_directory_template").val(),vcfg.directAccessSelect=$("#gv-direct-access-select"),vcfg.toggleInitialVisibility(vcfg),$("body").on("keydown keyup",vcfg.altKeyListener).on("change","#gravityview_form_id",vcfg.formChange).on("click",'a[href="#gv_start_fresh"]',vcfg.startFresh).on("click","#publish, #save-post",vcfg.processFormSubmit).on("submit","#post",vcfg.processFormSubmit).on("click",".gv-view-types-hover",vcfg.selectTemplateHover).on("click","a[rel*=external]",vcfg.openExternalLinks).on("click mouseup keyup",vcfg.closeTooltips).on("click",'.gv-field-filter-form span[role="button"]',vcfg.switchTooltipLayout).on("click","#gv_switch_view_button",vcfg.switchView).on("click",".clear-all-fields",vcfg.removeAllFields).on("click",".gv_select_template",vcfg.selectTemplate).on("click",".ui-tooltip-content .gv-fields",vcfg.startAddField).on("click",".gv-shortcode input",vcfg.selectText).on("click","#gv-direct-access .edit-direct-access",vcfg.editDirectAccess).on("click","#gv-direct-access-select .cancel-direct-access",vcfg.cancelDirectAccess).on("click","#gv-direct-access-select .save-direct-access",vcfg.updateDirectAccess).on("gravityview_form_change",vcfg.updateFormLinks).on("gravityview_form_change",vcfg.updateWidgetFormIds).on("change",".gv-dialog-options input[name*=show_as_link]",vcfg.toggleShowAsEntry).on("change",".gv-dialog-options input[name*=only_loggedin]",vcfg.toggleCustomVisibility).on("change",".gv-dialog-options [name*=allow_edit_cap]",vcfg.toggleCustomVisibility).on("click",".gv-field-controls .gv-remove-field",vcfg.removeField).on("click",".gv-field-controls .gv-field-settings",vcfg.openFieldSettings).on("dblclick",".gv-fields:not(.gv-nonexistent-form-field)",vcfg.openFieldSettings).on("gravityview/loaded",vcfg.toggleCheckboxes).on("change",".gv-setting-list, #gravityview_settings, .gv-dialog-options",vcfg.toggleCheckboxes).on("change","#gravityview_settings",vcfg.zebraStripeSettings).on("click",".gv-field-details--toggle",function(e){var $dialog=$(this).parents(".ui-dialog"),was_closed=$(".gv-field-details",$dialog).hasClass("gv-field-details--closed");return viewConfiguration.toggleFieldDetails($dialog,was_closed),$.cookie("gv-field-details-expanded",was_closed,{path:gvGlobals.admin_cookiepath}),!1}).on("search keydown keyup",".gv-field-filter-form input:visible",vcfg.setupFieldFilters).on("click",".gv-section .is-dismissible .notice-dismiss",function(e){var warning_name=$(this).parents(".gv-section").attr("id")+"-"+$("#post_ID").val();$.cookie("warning-dismissed-"+warning_name,1,{path:gvGlobals.admin_cookiepath}),$("body").trigger("gravityview/tabs-ready")}).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry gravityview/view-config-updated",vcfg.toggleTabConfigurationWarnings).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry gravityview/view-config-updated",vcfg.toggleRemoveAllFields).on("search keydown keyup",".gv-field-filter-form input:visible",vcfg.setupFieldFilters).on("focus",".gv-add-field",function(e){$(this).parent(".gv-fields").addClass("trigger--hover")}).on("blur",".gv-add-field",function(e){$(this).parent(".gv-fields").removeClass("trigger--hover")}).on("keydown",".gv-add-field",function(e){return 13!==e.keyCode&&32!==e.keyCode||void $(this).parent(".gv-fields").addClass("trigger--active")}).on("keyup",".gv-add-field",function(e){return 13!==e.keyCode&&32!==e.keyCode||void $(this).parent(".gv-fields").removeClass("trigger--active")}),$(window).resize(function(){var $open_dialog=$(".ui-dialog:visible").find(".ui-dialog-content");$open_dialog.dialog("option","position",{my:"center",at:"center",of:window});var window_width=vcfg.dialogWidth,ninety_five_per=.95*$(window).width();vcfg.dialogWidth>ninety_five_per&&(window_width=ninety_five_per),$open_dialog.dialog("option","width",window_width)}),window.addEventListener("beforeunload",event=>{vcfg.hasUnsavedChanges&&event.preventDefault()}),gvGlobals.passed_form_id&&vcfg.gvSelectForm.trigger("change");var _sendToEditor=window.send_to_editor;window.send_to_editor=function(val){var cursorPosition=$("#"+window.wpActiveEditor);if(!cursorPosition.hasClass("codemirror")&&_sendToEditor)return _sendToEditor(val);var codeMirror=cursorPosition.next(".CodeMirror")[0].CodeMirror,cursorPosition=codeMirror.getCursor();codeMirror.replaceRange(val,window.wp.CodeMirror.Pos(cursorPosition.line,cursorPosition.ch))},$("div .gform-dropdown__trigger").on("click.gravityforms",vcfg.sendMergeTagValueToCodemirrorEditor)},getCookieVal:function(cookie){return!(!cookie||"undefined"===cookie||"false"===cookie)&&cookie},toggleTabConfigurationWarnings:function(e){var tabs={single:{configured:$(".gv-dialog-options input[name*=show_as_link]:checked","#directory-active-fields").length||$('[data-fieldid="entry_link"]',"#directory-active-fields").length,icon:"dashicons-media-default"},edit:{configured:$('.gv-fields .field-key[value="edit_link"]').length,icon:"dashicons-welcome-write-blog"}};$.each(tabs,function(index,value){var show_warning=index+"-fields-"+$("#post_ID").val(),show_warning=!viewConfiguration.getCookieVal($.cookie("warning-dismissed-"+show_warning))&&0===value.configured;$("#"+index+"-fields").find(".notice-warning").toggle(show_warning),$('li[aria-controls="'+index+'-view"]').toggleClass("tab-not-configured",show_warning).find(".tab-icon").toggleClass("dashicons-warning",show_warning).toggleClass(value.icon,!show_warning)})},altKeyListener:function(e){viewConfiguration.altKey=e.altKey},zebraStripeSettings:function(){jQuery("#gravityview_settings").find("table").each(function(){$trs=$(this).find("tr").not('[style="display: none;"]'),$trs.removeClass("alternate"),$trs.filter(":even").addClass("alternate")})},toggleCheckboxes:function($parent){$parent=$parent.currentTarget||$parent;viewConfiguration.toggleRequired($parent,"requires",!1),viewConfiguration.toggleRequired($parent,"requires-not",!0);$parent=$($parent).is(".gv-fields")?$($parent):$($parent).parents(".gv-fields");viewConfiguration.toggleDisabled($("input:checkbox[name*=link_to_]",$parent),$("input:checkbox[name*=show_as_link]",$parent)),viewConfiguration.toggleDisabled($("input:checkbox[name*=link_phone]",$parent),$("input:checkbox[name*=show_as_link]",$parent))},toggleDisabled:function($one,$two){$one.is(":checked")&&$two.attr("disabled",!0),0<$two.filter(":checked").length&&$one.attr("disabled",!0)},toggleRequired:function(currentTarget,data_attr,reverse_logic){var $parent=$(currentTarget);$parent.find("[data-"+data_attr+"]").each(function(){var requires_value=$(this).data(data_attr).split("="),$input=requires_value[0],requires_value=requires_value[1],$input=$parent.find(':input[name$="['+$input+']"]');$input.is(":checkbox")?reverse_logic?$(this).toggle($input.not(":checked")):$(this).toggle($input.is(":checked")):void 0!==requires_value&&(reverse_logic?$(this).toggle($input.val()!==requires_value):$(this).toggle($input.val()===requires_value))})},switchTooltipLayout:function(e){var layout=$(this).data("value");viewConfiguration.setTooltipLayout(layout)},setTooltipLayout:function(layout){$(".gv-items-picker--"+layout).addClass("active"),$(".gv-items-picker").not(".gv-items-picker--"+layout).removeClass("active"),$(".gv-items-picker-container").attr("data-layout",layout),$.cookie("gv-items-picker-layout",layout,{path:gvGlobals.admin_cookiepath})},closeTooltips:function(e){var activeTooltips=$("[data-tooltip='active']"),close=!1,return_false=!1;switch(e.type){case"keyup":if(27===e.keyCode){if($(".ui-autocomplete").is(":visible"))return;return_false=close=0===$(".gv-field-filter-form input[data-has-search]:focus").length,window.Beacon&&window.Beacon("close")}((13===e.keyCode||32===e.keyCode)&&$(e.target).is(".close")||$(e.target).is(".dashicons-dismiss"))&&(close=!0);break;case"mouseup":$(e.target).parents(".ui-dialog,.ui-tooltip").length||$(e.target).is(".ui-dialog,.ui-tooltip")?close=!1:0<activeTooltips.length&&(close=!0),$(e.target).parents(".close").length&&(close=!0);break;case"click":$(e.target).is(".gv-overlay")&&(return_false=close=!0,$(e.target).remove())}if(close&&(activeTooltips.gvTooltip("close"),$(".ui-dialog:visible").find(".ui-dialog-content").dialog("close"),return_false))return!1},toggleShowAsEntry:function(e){var parent=$(e.target).parents(".gv-fields");parent.toggleClass("has-single-entry-link",$(e.target).is(":checked")),parent.find(".gv-field-controls .dashicons-media-default").toggleClass("hide-if-js",$(e.target).not(":checked")),$("body").trigger("gravityview/show-as-entry",$(e.target).is(":checked"))},toggleCustomVisibility:function(parent){var custom_visibility=$(parent.target).is("select")?"read"!==$(parent.target).val():$(parent.target).is(":checked"),parent=$(parent.target).parents(".gv-fields");parent.toggleClass("has-custom-visibility",custom_visibility),parent.find(".gv-field-controls .icon-custom-visibility").toggleClass("hide-if-js",!custom_visibility)},selectText:function(e){return e.preventDefault(),$(this).trigger("focus").trigger("select"),!1},editDirectAccess:function(e){var vcfg=viewConfiguration;e.preventDefault(),vcfg.directAccessSelect.is(":visible")||(vcfg.directAccessSelect.slideDown("fast",function(){vcfg.directAccessSelect.find('input[type="radio"]').first().trigger("focus")}),$(this).hide())},cancelDirectAccess:function(e){viewConfiguration.directAccessSelect.slideUp("fast"),$("#gv-direct-access-display strong").text(function(){return $(this).data("initial-label")}),$("#gv-direct-access .edit-direct-access").show().trigger("focus"),e.preventDefault()},updateDirectAccess:function(e){let checked,selectedDirectAccess=viewConfiguration.directAccessSelect.find("input:radio:checked");viewConfiguration.directAccessSelect.slideUp("fast"),$("#gv-direct-access .edit-direct-access").show().trigger("focus"),checked="embed"===selectedDirectAccess.val(),$("#gravityview_se_embed_only").prop("checked",checked),$("#gv-direct-access-display strong").text(selectedDirectAccess.data("display-label")),$("#gv-direct-access").toggleClass("embed-only",checked),e.preventDefault()},toggleInitialVisibility:function(vcfg){0!==vcfg.gvSelectForm.length&&(""===vcfg.currentFormId?vcfg.hideView():$("#gravityview_directory_template").length&&0<$("#gravityview_directory_template").val().length?($("#gravityview_select_template").slideUp(150),vcfg.showViewConfig()):(vcfg.templateFilter("custom"),vcfg.showViewTypeMetabox()),vcfg.currentFormId&&!vcfg.currentTemplateId&&vcfg.gvSwitchView.hide(),vcfg.togglePreviewButton(),vcfg.zebraStripeSettings(!0))},togglePreviewButton:function(){var preview_button=$("#preview-action").find(".button");""===viewConfiguration.gvSelectForm.val()?preview_button.hide():preview_button.show()},hideView:function(){var vcfg=viewConfiguration;vcfg.currentFormId="",vcfg.togglePreviewButton(),$("#gravityview_view_config, #gravityview_select_template, #gravityview_sort_filter, .gv-form-links").hide(),viewGeneralSettings.metaboxObj.hide()},updateFormLinks:function(){var vcfg=viewConfiguration;$(".gv-form-links a").each(function(){var new_url=$(this).attr("href").replace(/id=([0-9]+)/gm,"id="+vcfg.gvSelectForm.val());$(this).attr("href",new_url)})},updateWidgetFormIds:function(){var vcfg=viewConfiguration;$(".field-form-id").each(function(){$(this).val(vcfg.gvSelectForm.val())})},toggleViewTypeMetabox:function(){var $templates=$("#gravityview_select_template"),vcfg=viewConfiguration;$templates.is(":visible")?(vcfg.gvSwitchView.text(function(){return $(this).attr("data-text-backup")}),vcfg.currentTemplateId&&$templates.slideUp(150)):(vcfg.currentTemplateId?vcfg.gvSwitchView.attr("data-text-backup",function(){return $(this).text()}).text(gvGlobals.label_cancel):vcfg.gvSwitchView.hide(),$templates.slideDown(150))},showViewTypeMetabox:function(){$("#gravityview_select_template").slideDown(150)},startFresh:function(vcfg){vcfg.preventDefault();vcfg=viewConfiguration;vcfg.startFreshStatus=!0,vcfg.getConfiguredFields().length?vcfg.showDialog("#gravityview_select_preset_dialog"):vcfg.startFreshContinue()},startFreshContinue:function(){var vcfg=viewConfiguration;$("#gravityview_form_id_start_fresh").val("1"),$("#gravityview_form_id").val(""),vcfg.currentFormId="",vcfg.currentTemplateId="",vcfg.gvSwitchView.hide(),vcfg.templateFilter("preset"),vcfg.showViewTypeMetabox(),vcfg.hideViewConfig(),vcfg.togglePreviewButton()},formChange:function(vcfg){vcfg.preventDefault();vcfg=viewConfiguration;vcfg.altKey||(vcfg.startFreshStatus=!1,vcfg.getConfiguredFields().length?vcfg.showDialog("#gravityview_change_form_dialog"):vcfg.formChangeContinue(),vcfg.togglePreviewButton())},formChangeContinue:function(){var vcfg=viewConfiguration;vcfg.gvSelectForm.val()?(vcfg.templateFilter("custom"),Promise.all([vcfg.getAvailableFields(),vcfg.getSortableFields()]).then(function(){vcfg.currentFormId||vcfg.currentTemplateId?(vcfg.currentTemplateId&&vcfg.currentTemplateId&&vcfg.gvSwitchView.show(),vcfg.gvSwitchView.click()):(vcfg.showViewTypeMetabox(),vcfg.gvSwitchView.fadeOut(150))})):(vcfg.getConfiguredFields().remove(),vcfg.hideView(),vcfg.gvSwitchView.fadeOut(150)),vcfg.currentTemplateId="",vcfg.currentFormId=vcfg.gvSelectForm.val(),vcfg.setUnsavedChanges(!0),$("body").trigger("gravityview_form_change").addClass("gv-form-changed")},showDialog:function(continue_button,buttons){var vcfg=viewConfiguration,thisDialog=$(continue_button),cancel_button={text:gvGlobals.label_cancel,click:function(){thisDialog.is("#gravityview_change_form_dialog")?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.val(vcfg.currentFormId)):thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig()),thisDialog.dialog("close")}},continue_button={text:gvGlobals.label_continue,click:function(){thisDialog.is("#gravityview_change_form_dialog")||thisDialog.is("#gravityview_select_preset_dialog")?vcfg.startFreshStatus?vcfg.startFreshContinue():vcfg.formChangeContinue():thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg.selectTemplateContinue(),vcfg.toggleViewTypeMetabox()),thisDialog.dialog("close")}};buttons=buttons||[cancel_button,continue_button],thisDialog.dialog({dialogClass:"wp-dialog gv-dialog",appendTo:thisDialog.parent(),draggable:!1,resizable:!1,width:function(){return $(window).width()>vcfg.dialogWidth?vcfg.dialogWidth:$(window).width()-10},open:function(){return $('<div class="gv-overlay" />').prependTo("#wpwrap"),vcfg.toggleCheckboxes(thisDialog),vcfg.setupFieldDetails(thisDialog),vcfg.refresh_merge_tags(thisDialog,function(){vcfg.setupCodeMirror(thisDialog)}),$sortableEls=$('.ui-widget-content[aria-hidden="false"]').find(".active-drop-widget, .active-drop-field"),$sortableEls.length&&$sortableEls.each((i,el)=>{$(el).hasClass("ui-sortable")&&$(el).sortable("disable")}),!0},close:function(e){e.preventDefault(),$("textarea.code",thisDialog).each(function(){$CodeMirror=$(this).next(".CodeMirror"),0!==$CodeMirror.length&&$CodeMirror[0].hasOwnProperty("CodeMirror")&&$CodeMirror[0].CodeMirror.toTextArea()}),thisDialog.find(".merge-tag-support").removeClass("merge-tag-support").addClass("gv-merge-tag-support"),$(".gv-field-settings.active","#gravityview_view_config").removeClass("active"),vcfg.setCustomLabel(thisDialog),$("#wpwrap").find("> .gv-overlay").fadeOut("fast",function(){$(this).remove()}),$sortableEls=$('.ui-widget-content[aria-hidden="false"]').find(".active-drop-widget, .active-drop-field"),$sortableEls.length&&$sortableEls.each((i,el)=>{$(el).hasClass("ui-sortable")&&$(el).sortable("enable")}),$("body").trigger("gravityview/dialog-closed",thisDialog)},closeOnEscape:!0,buttons:buttons})},setupCodeMirror:function(dialog){var vcfg=viewConfiguration;$("textarea.code:visible",dialog).each(function(){const codemirrorConfig=$.extend(!0,{},wp.codeEditor.defaultSettings);var $textarea,editorId,mergeTag,initialEditorCursorPos,$autocompleteEl,closeAutocompletion,mergeTags=$(this).data("codemirror");mergeTags&&(codemirrorConfig.codemirror=$.extend({},codemirrorConfig.codemirror,mergeTags));let editor=wp.codeEditor.initialize($(this),codemirrorConfig);($(this).hasClass("merge-tag-support")||$(this).hasClass("gv-merge-tag-support"))&&(editor.codemirror.setSize("95%"),$textarea=$(this),editorId=$textarea.attr("id"),mergeTags=window.gfMergeTags.getAutoCompleteMergeTags($textarea),mergeTag="",initialEditorCursorPos=editor.codemirror.getCursor(),$textarea.parent().find(".all-merge-tags").detach().insertBefore($textarea),$textarea.parent().find("div .gform-dropdown__trigger").on("click.gravityforms",vcfg.sendMergeTagValueToCodemirrorEditor),$textarea.autocomplete({appendTo:$textarea.parent(),minLength:1,position:{my:"center top",at:"center bottom",collision:"none"},source:mergeTags,select:function(event,currentEditorCursorPos){var val=currentEditorCursorPos.item.value.replace(/^{|}$/gm,""),currentEditorCursorPos=editor.codemirror.getCursor();editor.codemirror.replaceRange(val,initialEditorCursorPos,window.wp.CodeMirror.Pos(currentEditorCursorPos.line,currentEditorCursorPos.ch)),editor.codemirror.focus(),editor.codemirror.setCursor(window.wp.CodeMirror.Pos(currentEditorCursorPos.line,currentEditorCursorPos.ch+val.length+1))}}),$autocompleteEl=$textarea.parent().find("ul.ui-autocomplete"),closeAutocompletion=function(){$("#"+editorId).autocomplete("close")},$("body").on("keyup",function(e){$autocompleteEl.is(":visible")&&27===e.which&&(e.preventDefault(),closeAutocompletion(),$textarea.focus())}),editor.codemirror.on("mousedown",function(){closeAutocompletion()}),editor.codemirror.on("keydown",function(el,e){$autocompleteEl.is(":visible")&&(38!==e.which&&40!==e.which&&13!==e.which||($autocompleteEl.not(":focus")&&$autocompleteEl.focus(),e.preventDefault()))}),editor.codemirror.on("change",function(e,currentEditorCursorPos){"{}"===currentEditorCursorPos.text[0]&&(initialEditorCursorPos=editor.codemirror.getCursor());currentEditorCursorPos=editor.codemirror.getCursor();"{"!==(mergeTag=editor.codemirror.getRange({ch:initialEditorCursorPos.ch-1,line:initialEditorCursorPos.line},currentEditorCursorPos))[0]?closeAutocompletion():$("#"+editorId).autocomplete("search",mergeTag)}))})},sendMergeTagValueToCodemirrorEditor:function(e){var _activeEditorBackup=window.wpActiveEditor;window.wpActiveEditor=$(e.currentTarget).parentsUntil(".gv-setting-container").find("textarea").attr("id"),window.wpActiveEditor&&window.send_to_editor($(this).data("value")),window.wpActiveEditor=_activeEditorBackup},setupFieldDetails:function(dialog){$(".gv-field-details--container",dialog).insertAfter(".ui-dialog-title:visible");var show_details=$.cookie("gv-field-details-expanded"),show_details=viewConfiguration.getCookieVal(show_details);viewConfiguration.toggleFieldDetails(dialog,show_details),viewConfiguration.migrateSurveyScore(dialog)},migrateSurveyScore:function($dialog){var $score;0===$dialog.parents('[data-inputtype="survey"]').length||($score=$dialog.find(".gv-setting-container-score input"))&&0!=+$score.val()&&$dialog.find('.gv-setting-container-choice_display input[value="score"]').trigger("click").trigger("focus")},toggleFieldDetails:function($dialog,show_details){$parent=$dialog.parent(),$parent.find(".gv-field-details").toggleClass("gv-field-details--closed",!show_details).end().find(".gv-field-details--toggle .dashicons").toggleClass("dashicons-arrow-down",!!show_details).toggleClass("dashicons-arrow-right",!show_details).end()},setCustomLabel:function($label){var custom_label_text=$("[name*=admin_label]",$label),custom_label_text=custom_label_text.length&&custom_label_text.val()?custom_label_text:$("[name*=custom_label]",$label),$label=$label.parents(".gv-fields").find(".gv-field-label-text-container");custom_label_text.length&&(0<(custom_label_text=custom_label_text.val().trim()).length?$label.html(custom_label_text):$label.html($label.attr("data-original-title")))},getSortableFields:function(context,id){return new Promise((resolve,reject)=>{var vcfg=viewConfiguration;$(".gravityview_sort_field").prop("disabled","disabled").empty().append("<option>"+gvGlobals.loading_text+"</option>");var data={action:"gv_sortable_fields_form",nonce:gvGlobals.nonce};void 0!==context&&"preset"===context?data.template_id=id:data.form_id=vcfg.gvSelectForm.val(),$.post(ajaxurl,data,function(response){"false"!==response&&"0"!==response&&$(".gravityview_sort_field").empty().append(response).prop("disabled",null),resolve()})})},hideViewConfig:function(){$("#gravityview_view_config").slideUp(150),$(document).trigger("gv_admin_views_hideViewConfig")},showViewConfig:function(){$("#gravityview_view_config").slideDown(150),viewGeneralSettings.metaboxObj.show(),viewConfiguration.toggleDropMessage(),viewConfiguration.init_tooltips(),$(document).trigger("gv_admin_views_showViewConfig")},switchView:function(vcfg){vcfg.preventDefault(),vcfg.stopImmediatePropagation();vcfg=viewConfiguration;vcfg.templateFilter("custom"),vcfg.toggleViewTypeMetabox()},templateFilter:function(templateType){$(".gv-view-types-module").each(function(){$(this).attr("data-filter")===templateType?$(this).parent().show():$(this).parent().hide()})},selectTemplate:function(slugmatch){var vcfg=viewConfiguration;slugmatch.preventDefault(),slugmatch.stopImmediatePropagation(),vcfg.wantedTemplate=$(this);var selectedTemplateId=vcfg.wantedTemplate.attr("data-templateid"),regexMatch=/(.*?)_(.*?)$/i,slugmatch=vcfg.currentTemplateId.replace(regexMatch,"$2"),slugmatch=selectedTemplateId.replace(regexMatch,"$2")===slugmatch;vcfg.currentTemplateId&&!slugmatch&&vcfg.getConfiguredFields().length?vcfg.currentTemplateId!==selectedTemplateId?vcfg.getConfiguredFields().length?vcfg.showDialog("#gravityview_switch_template_dialog"):(vcfg.toggleViewTypeMetabox(),vcfg.selectTemplateContinue(slugmatch)):(vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig()):($("#gravityview_select_template").slideUp(150),vcfg.selectTemplateContinue(slugmatch))},selectTemplateContinue:function(slugmatch){var vcfg=viewConfiguration,selectedTemplateId=vcfg.wantedTemplate.attr("data-templateid"),selectedFormId=vcfg.gvSelectForm.val();$("#gravityview_directory_template").val(selectedTemplateId).trigger("change");var $parent=vcfg.wantedTemplate.parents(".gv-view-types-module");$parent.parents(".gv-grid").find(".gv-view-types-module").removeClass("gv-selected"),$parent.addClass("gv-selected"),vcfg.waiting("start"),vcfg.startFreshStatus?Promise.all([vcfg.getAvailableFields("preset",selectedTemplateId),vcfg.getPresetFields(selectedTemplateId),vcfg.getSortableFields("preset",selectedTemplateId)]).then(function(){$(".ui-tabs-panel").each(function(){vcfg.init_droppables(this)})}):(slugmatch?vcfg.waiting("stop"):vcfg.updateActiveAreas(selectedTemplateId,+selectedFormId),vcfg.gvSwitchView.fadeIn(150),vcfg.toggleViewTypeMetabox()),vcfg.currentTemplateId=selectedTemplateId,vcfg.setUnsavedChanges(!0)},selectTemplateHover:function(on_success){const vcfg=viewConfiguration,$link=$(on_success.target),$parent=$link.parents(".gv-view-types-module");if($link.is("[rel=internal]")&&!$link.hasClass("gv-layout-activate")&&!$link.hasClass("gv-layout-install"))return!0;on_success.preventDefault(),on_success.stopImmediatePropagation();var server_request=(ajaxRoute,payload)=>{const defer=$.Deferred();$link.addClass("disabled"),vcfg.performingAjaxAction=!0,$(".gv-view-template-notice").hide();var{_wpNonce:nonce,_wpAjaxAction:action,_wpAjaxUrl:url,ajaxRouter,frontendFoundationVersion}=window.gvGlobals.foundation_licenses_router;return $.post(url,{nonce:nonce,action:action,ajaxRouter:ajaxRouter,ajaxRoute:ajaxRoute,frontendFoundationVersion:frontendFoundationVersion,payload:payload}).done(response=>{response.success?defer.resolve():defer.reject(response.data)}).fail(response=>{defer.reject(response.responseText)}),defer.promise()},on_fail=error=>{$(".gv-view-template-notice").show().find("p").html(error),document.querySelector(".gv-view-template-notice").scrollIntoView({behavior:"smooth"})},do_always=()=>{vcfg.performingAjaxAction=!1,$link.removeClass("disabled")},on_success=()=>{$parent.find(".gv-view-types-hover > div:eq(0)").hide(),$parent.find(".gv-view-types-hover > div:eq(1)").removeClass("hidden"),$parent.removeClass("gv-view-template-placeholder"),$parent.find("a.gv_select_template").attr("data-templateid",$link.data("templateid")).trigger("click")};return $link.hasClass("gv-layout-activate")?vcfg.performingAjaxAction?void 0:void $.when(server_request("activate_product",{text_domain:$link.attr("data-template-text-domain")})).then(on_success).always(do_always).fail(on_fail):$link.hasClass("gv-layout-install")?vcfg.performingAjaxAction?void 0:void $.when(server_request("install_product",{id:$link.attr("data-download-id"),activate:!0})).then(on_success).always(do_always).fail(on_fail):void $(this).find(".gv_select_template").trigger("click")},openExternalLinks:function(){return window.Beacon&&($(this).is("[data-beacon-article]")||$(this).is("[data-beacon-article-modal]")||$(this).is("[data-beacon-article-sidebar]")||$(this).is("[data-beacon-article-inline]"))||window.open(this.href),!1},previewTemplate:function(e){e.preventDefault(),e.stopImmediatePropagation();var parent=$(e.currentTarget).parents(".gv-view-types-module");parent.find(".gv-template-preview").dialog({dialogClass:"wp-dialog gv-dialog",appendTo:$("#gravityview_select_template"),width:viewConfiguration.dialogWidth,open:function(){$('<div class="gv-overlay" />').prependTo("#wpwrap")},close:function(){$(this).dialog("option","appendTo",parent),$("#wpwrap").find("> .gv-overlay").fadeOut("fast",function(){$(this).remove()})},closeOnEscape:!0,buttons:[{text:gvGlobals.label_close,click:function(){$(this).dialog("close")}}]})},updateActiveAreas:function(template,data){var vcfg=viewConfiguration;$("#directory-active-fields, #single-active-fields").children().remove();data={action:"gv_get_active_areas",template_id:template,form_id:data,nonce:gvGlobals.nonce};return vcfg.updateViewConfig(data)},getPresetFields:function(data){var vcfg=viewConfiguration;$("#directory-active-fields, #single-active-fields").children().remove();data={action:"gv_get_preset_fields",template_id:data,nonce:gvGlobals.nonce};return vcfg.updateViewConfig(data)},updateViewConfig:function(data){return new Promise((resolve,reject)=>{var vcfg=viewConfiguration;$.post(ajaxurl,data,function(content){content&&(content=JSON.parse(content),$("#directory-header-widgets").html(content.header),$("#directory-footer-widgets").html(content.footer),$("#directory-active-fields").append(content.directory),$("#single-active-fields").append(content.single),vcfg.showViewConfig(),vcfg.waiting("stop"),$("body").trigger("gravityview/view-config-updated",content)),resolve()}),vcfg.setUnsavedChanges(!0)})},waiting:function(action){$containers=$("#wpwrap,.gv-fields"),"start"===action?$containers.addClass("gv-wait"):$containers.removeClass("gv-wait")},remove_tooltips:function(el){$(el||".gv-add-field").is(":ui-tooltip")&&$(".gv-add-field").gvTooltip("destroy").off("click")},init_tooltips:function(el){0!==$(el||".gv-add-field").not(":ui-tooltip").length&&$(el||".gv-add-field").gvTooltip({show:150,hide:200,content:function(){var context=$(this).attr("data-context"),formId=$(this).attr("data-formid")||$("#gravityview_form_id").val(),templateId=$("#gravityview_directory_template").val();switch($(this).attr("data-objecttype")){case"field":return $("#"+context+"-available-fields-"+(formId||templateId)).html();case"widget":return $("#directory-available-widgets").html()}},close:function(){$(this).attr("data-tooltip",null)},open:function(event,tooltip){$(this).attr("data-tooltip","active").attr("data-tooltip-id",$(this).attr("aria-describedby")),$focus_item=$("input[type=search]",tooltip.tooltip),$focus_item.length||($focus_item=$(tooltip.tooltip).find(".close").first());var activate_layout="list";$(tooltip).find(".gv-items-picker-container[data-layout]").length?activate_layout=$(tooltip).find(".gv-items-picker-container[data-layout]").attr("data-layout"):(layout_cookie=$.cookie("gv-items-picker-layout"),viewConfiguration.getCookieVal(layout_cookie)&&(activate_layout=layout_cookie)),viewConfiguration.setTooltipLayout(activate_layout),$focus_item.trigger("focus")},closeOnEscape:!0,disabled:!0,position:{my:"center bottom",at:"center top-12"},tooltipClass:"gravityview-item-picker-tooltip top"}).attr("title","").on("mouseout focusout",function(e){e.stopImmediatePropagation()}).on("click",function(e){$(this).attr("title",""),e.preventDefault(),$(this).gvTooltip("open")})},setupFieldFilters:function(e){var input=$(this).val().trim(),$tooltip=$(this).parents(".ui-tooltip-content"),$resultsNotFound=$tooltip.find(".gv-no-results");"keydown"!==e.type?($tooltip.find(".gv-fields").show().filter(function(){var match_title=$(this).find(".gv-field-label").attr("data-original-title").match(new RegExp(input,"i")),match_id=$(this).attr("data-fieldid").match(new RegExp(input,"i")),match_parent=!!$(this).attr("data-parent-label")&&$(this).attr("data-parent-label").match(new RegExp(input,"i"));return!match_title&&!match_id&&!match_parent}).hide(),$tooltip.find(".gv-fields:visible").length?$resultsNotFound.hide():$resultsNotFound.show()):$(this).attr("data-has-search",0<input.length?input.length:null)},refreshGFtooltips:function(){$(".gf_tooltip").gvTooltip({show:500,hide:1e3,content:function(){return $(this).prop("title")}})},getConfiguredFields:function(){return $("#directory-active-fields, #single-active-fields, #edit-active-fields").find(".gv-fields")},getAvailableFields:function(preset,templateid){return new Promise((resolve,reject)=>{var vcfg=viewConfiguration;vcfg.toggleDropMessage(),vcfg.getConfiguredFields().remove();var data={action:"gv_available_fields",nonce:gvGlobals.nonce};data.form_preset_ids=void 0!==preset&&"preset"===preset?[templateid]:[vcfg.gvSelectForm.val()],$("#directory-available-fields-"+data.form_preset_ids[0]).length||$.post(ajaxurl,data,function(response){response.success||response.data||resolve(),$.each(response.data,function(context,markup){$("#"+context+"-fields").append(markup)}),resolve()})})},startAddField:function(e){$(this).has(".field-id-all-fields").length?viewConfiguration.addAllFields($(this)):viewConfiguration.addField($(this),e)},addAllFields:function(clicked){clicked.siblings(".gv-fields").filter(function(){var field_id=$(this).data("fieldid");return+field_id===parseInt(field_id,10)}).each(function(){$(this).trigger("click")}),$("a.gv-add-field[data-tooltip='active']").gvTooltip("close")},addField:function(data,addButton){addButton.preventDefault();var vcfg=viewConfiguration,newField=data.clone().hide(),areaId=data.parents(".ui-tooltip").attr("id"),templateId=$("#gravityview_directory_template").val(),addButton=data.parents(".ui-tooltip").attr("id"),addButton=$('.gv-add-field[data-tooltip-id="'+addButton+'"]'),data={action:"gv_field_options",template:templateId,area:addButton.attr("data-areaid"),context:addButton.attr("data-context"),field_id:newField.attr("data-fieldid"),field_label:newField.find(".gv-field-label").attr("data-original-title"),field_type:addButton.attr("data-objecttype"),input_type:newField.attr("data-inputtype"),form_id:parseInt($(data).attr("data-formid"),10)||vcfg.currentFormId,nonce:gvGlobals.nonce};$.ajax({type:"POST",url:ajaxurl,data:data,async:!0,beforeSend:function(){vcfg.disable_publish()},complete:function(){vcfg.enable_publish()}}).done(function(response){newField.append(response),$(".ui-tabs-panel").each(function(){vcfg.init_droppables(this)}),0<$(".gv-dialog-options",newField).length&&$(".gv-field-settings",newField).removeClass("hide-if-js"),$('[data-tooltip-id="'+areaId+'"]').parents(".gv-droppable-area").find(".active-drop").append(newField).end().attr("data-tooltip-id",""),$("body").trigger("gravityview/field-added",newField),newField.fadeIn(100),vcfg.refreshGFtooltips()}).fail(function(jqXHR){vcfg.enable_publish(),alert(gvGlobals.field_loaderror),console.log(jqXHR)}).always(function(){vcfg.toggleDropMessage(),vcfg.setUnsavedChanges(!0)})},refresh_merge_tags:function($source,onRefresh){let $merge_tag_supported=$source?$(".gv-merge-tag-support,.merge-tag-support",$source):$(".gv-merge-tag-support:visible");if($merge_tag_supported.removeClass("gv-merge-tag-support mt-initialized").addClass("merge-tag-support"),window.gform?.instances?.mergeTags)return $(".all-merge-tags",$source).remove(),document.dispatchEvent(new Event("DOMContentLoaded")),void setTimeout(function(){$merge_tag_supported.removeClass("merge-tag-support").addClass("gv-merge-tag-support"),onRefresh&&onRefresh()},300);"undefined"!=typeof form&&$("body").not(".gv-form-changed")&&0<=$merge_tag_supported.length&&(window.gfMergeTags&&($(".all-merge-tags:visible").remove(),gfMergeTags.hasOwnProperty("destroy")?$merge_tag_supported.each(function(){new gfMergeTagsObj(form,$(this))}):window.gfMergeTags=new gfMergeTagsObj(form)),$merge_tag_supported.removeClass("merge-tag-support").addClass("gv-merge-tag-support"),onRefresh&&onRefresh())},enable_publish:function(){$(document).trigger("autosave-enable-buttons.edit-post"),$("#publishing-action").find("#publish").prop("disabled",null).removeClass("button-primary-disabled")},disable_publish:function(){$(document).trigger("autosave-disable-buttons.edit-post"),$("#publishing-action").find("#publish").prop("disabled","disabled").addClass("button-primary-disabled")},init_droppables:function(panel){var vcfg;$(panel).find(".active-drop-field").sortable("instance")||(vcfg=viewConfiguration,$(panel).find(".active-drop-widget").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-widget",start:function(event,ui){$("#directory-fields, #single-fields").find(".active-drop-container-widget").addClass("is-receivable")},stop:function(event,ui){$("#directory-fields, #single-fields").find(".active-drop-container-widget").removeClass("is-receivable")},change:function(event,ui){vcfg.setUnsavedChanges(!0)},receive:function(event,ui){var sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid");ui.item.find('[name^="widgets['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))}),vcfg.toggleDropMessage()}}),$(panel).find(".active-drop-field").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-field",start:function(event,ui){$(panel).find(".active-drop-container-field").addClass("is-receivable")},stop:function(event,ui){$(panel).find(".active-drop-container-field").removeClass("is-receivable")},change:function(event,ui){vcfg.setUnsavedChanges(!0)},receive:function(event,ui){var sender_area,receiver_area;0<ui.item.find(".gv-dialog-options").length&&(sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid"),ui.item.find('[name^="fields['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))})),vcfg.toggleDropMessage()}}))},toggleDropMessage:function(){$(".active-drop").each(function(){0<$(this).find(".gv-fields").length?$(this).find(".drop-message").hide():$(this).find(".drop-message").fadeIn(100)})},removeField:function(e){e.preventDefault();var vcfg=viewConfiguration,area=$(e.currentTarget).parents(".active-drop");vcfg.setUnsavedChanges(!0),e.altKey&&1<$(area).find(".gv-fields").length?vcfg.removeAllFields(e,area):$(e.currentTarget).parents(".gv-fields").fadeOut("fast",function(){$(this).remove(),$("body").trigger("gravityview/field-removed",$(this)),vcfg.toggleDropMessage()})},removeAllFields:function(e,area){e.preventDefault(),window.confirm(gvGlobals.remove_all_fields)&&((area=area||null)||(area_id=$(e.originalEvent.target).data("areaid"),area=$(e.originalEvent.target).parents('div[data-areaid="'+area_id+'"]')[0]),$(area).find(".gv-fields").remove(),$("body").trigger("gravityview/all-fields-removed"),viewConfiguration.toggleDropMessage())},toggleRemoveAllFields:function(e,item){has_fields=!1,$(".active-drop:visible").each(function(index,item){has_fields=1<$(this).find(".gv-fields").length,$(".clear-all-fields",$(item).parents(".gv-droppable-area")).toggle(has_fields)})},openFieldSettings:function(buttons){buttons.preventDefault();var vcfg=viewConfiguration,parent=$(buttons.currentTarget).is(".gv-fields")?$(buttons.currentTarget):$(buttons.currentTarget).parents(".gv-fields");$(".gv-field-settings",parent).addClass("active"),vcfg.updateVisibilitySettings(buttons,!0),$("body").on("change",".gv-fields input:checkbox",vcfg.updateVisibilitySettings);buttons=[{text:gvGlobals.label_close,class:"button button-link",click:function(){$(this).dialog("close")}}];vcfg.showDialog(parent.find(".gv-dialog-options"),buttons)},updateVisibilitySettings:function($parent,first_run){var vcfg=viewConfiguration;$parent=$($parent.currentTarget).is(".gv-fields")?$($parent.currentTarget):$($parent.currentTarget).parents(".gv-fields");$(".gv-setting-list",$parent).trigger("change"),$("input:checkbox",$parent).attr("disabled",null),vcfg.setUnsavedChanges(!0)},toggleVisibility:function(checked,$toggled,first_run,inverse){checked=checked.is(":checked");(checked=inverse?!checked:checked)?$toggled.parents(".gv-setting-container").fadeIn(0):$toggled.parents(".gv-setting-container").fadeOut(0)},processFormSubmit:function(e){var vcfg=viewConfiguration,templateId=$("#gravityview_directory_template").val();return vcfg.startFreshStatus?(vcfg.createPresetForm(e,templateId),!1):(!vcfg.startFreshStatus||""===templateId)&&(vcfg.setUnsavedChanges(!1),vcfg.serializeForm(e))},setUnsavedChanges(has_changes){viewConfiguration.hasUnsavedChanges=has_changes},serializeForm:function(e){var serialized_data,$fields,$post=$("#post");return!!$post.data("gv-valid")||(e.stopImmediatePropagation(),$post.data("gv-valid",!1),$post.data("gv-serialized")?serialized_data=$post.data("gv-serialized"):(serialized_data=($fields=$post.find(":input[name^=fields]")).serialize(),$fields.prop("disabled",!0),$post.data("gv-serialized",serialized_data)),$post.find(":input[name=gv_fields]").prop("disabled",!0),$post.append($("<input/>",{name:"gv_fields",value:serialized_data,type:"hidden"})),setTimeout(function(){$post.data("gv-valid",!0),"click"===e.type?$(e.target).trigger("click"):$post.trigger("submit")},101),!1)},createPresetForm:function(e,data){var vcfg=viewConfiguration,$target=$(e.target);e.stopPropagation();data={action:"gv_set_preset_form",template_id:data,nonce:gvGlobals.nonce};return $.ajax({type:"POST",url:ajaxurl,data:data,async:!1,success:function(response){"false"!==response&&"0"!==response?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.find("option:selected").removeAttr("selected").end().append(response),"click"===e.type?$target.trigger("click"):$("#post").trigger("submit")):$target.before('<div id="message" class="error below-h2"><p>'+gvGlobals.label_publisherror+"</p></div>")}}),!1}},viewGeneralSettings={templateId:null,metaboxObj:null,init:function(){viewGeneralSettings.metaboxObj=$("#gravityview_settings"),viewGeneralSettings.initTabs(),$("#gravityview_directory_template").on("change",viewGeneralSettings.updateSettingsDisplay).trigger("change"),$("body").on("gravityview/settings/tab/enable",viewGeneralSettings.enableSettingTab).on("gravityview/settings/tab/disable",viewGeneralSettings.disableSettingTab)},updateSettingsDisplay:function(){viewGeneralSettings.templateId=$(this).val(),$("tr[data-show-if]").each(viewGeneralSettings.toggleSetting)},toggleSetting:function(){var row=$(this),templates=row.attr("data-show-if");templates.length<1||(0<viewGeneralSettings.templateId.length&&-1<templates.indexOf(viewGeneralSettings.templateId)?row.show():(row.find("select, input").val("").prop("checked",!1),row.hide()))},initTabs:function(){let cookie_key="gv-active-setting-tab-"+$("#post_ID").val(),active_settings_tab=$.cookie(cookie_key);!1===viewConfiguration.getCookieVal(active_settings_tab)&&(active_settings_tab=0),viewGeneralSettings.metaboxObj.on("tabscreate",viewGeneralSettings.tabsCreate).insertAfter($("#gravityview_view_config")).tabs({active:active_settings_tab,create:function(event,ui){setTimeout(function(){viewConfiguration.setupCodeMirror(ui.panel)},50)},activate:function(event,ui){$.cookie(cookie_key,ui.newTab.index(),{path:gvGlobals.admin_cookiepath}),viewConfiguration.setupCodeMirror(ui.newPanel)}}).addClass("ui-tabs-vertical ui-helper-clearfix").find("li").removeClass("ui-corner-top")},tabsCreate:function(event,ui){var $panels=$(this).find(".ui-tabs-panel"),max=[];$panels.each(function(){max.push($(this).outerHeight(!0))}).css({"min-height":_.max(max)})},enableSettingTab:function(e,tab){viewGeneralSettings.metaboxObj.tabs("enable",$(tab).attr("id"))},disableSettingTab:function(e,tab){viewGeneralSettings.metaboxObj.tabs("disable",$(tab).attr("id"))}},jQuery(function($){$("#title-prompt-text").text(gvGlobals.label_viewname),viewGeneralSettings.init(),viewConfiguration.init(),$(".gv-datepicker").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1});var cookie_key="gv-active-tab-"+$("#post_ID").val(),activate_tab=$.cookie(cookie_key);!1===viewConfiguration.getCookieVal(activate_tab)&&(activate_tab=0),location.hash&&$(location.hash).length&&(activate_tab=$(location.hash).index()-1),$("#gv-view-configuration-tabs").tabs({active:activate_tab,hide:!1,show:!1,create:function(event,ui){viewConfiguration.init_droppables(ui.panel),$("body").trigger("gravityview/tab-ready",ui.panel),$("body").trigger("gravityview/tabs-ready")},activate:function(event,ui){$.cookie(cookie_key,ui.newTab.index(),{path:gvGlobals.cookiepath}),viewConfiguration.init_droppables(ui.newPanel),$("body").trigger("gravityview/tab-ready",ui.newPanel)}}),$("body").trigger("gravityview/loaded")}),window.gvAdminActions={initTooltips:viewConfiguration.init_tooltips,removeTooltips:viewConfiguration.remove_tooltips,showDialog:viewConfiguration.showDialog}}(jQuery);