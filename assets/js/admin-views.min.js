!function($){var viewConfiguration,viewGeneralSettings;$.widget.bridge("gvTooltip",$.ui.tooltip);let $spinner=$('<svg class="loading" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 6.47715 6.47715 2 12 2V5C8.13401 5 5 8.13401 5 12H2Z" fill="currentColor"></path></svg>'),EXPAND_ICON='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M2.2 7.2c.4 0 .7-.3.7-.7V6l-.2-2.1 1.6 1.7 2 2c.1.2.3.2.5.2.5 0 .8-.3.8-.8 0-.2 0-.4-.2-.5l-2-2-1.7-1.6h2.2c0 .1.5.1.5.1.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7H2.6c-.8 0-1.2.5-1.2 1.2v3.7c0 .4.3.7.8.7zm7.4 7.5h3.8c.8 0 1.2-.4 1.2-1.2V9.8c0-.4-.3-.7-.8-.7-.4 0-.7.3-.7.7v2.6c.1 0-1.5-1.7-1.5-1.7l-2-2c-.1-.1-.3-.2-.5-.2-.5 0-.8.3-.8.8s0 .4.2.5l2 2 1.7 1.6H10c0-.1-.5-.1-.5-.1-.4 0-.7.3-.7.7 0 .4.3.7.7.7z"/></svg>';viewConfiguration={startFreshStatus:!1,hasUnsavedChanges:!1,altKey:!1,dialogWidth:750,performingAjaxAction:!1,maxDialogWidth:.95,ignoreEscapeEvent:!1,init:function(){var vcfg=viewConfiguration,_sendToEditor=(vcfg.gvSelectForm=$("#gravityview_form_id"),vcfg.gvSwitchView=$("#gv_switch_view_button"),vcfg.currentFormId=vcfg.gvSelectForm.val(),vcfg.currentDirectoryTemplate=$("#gravityview_directory_template").val(),vcfg.currentSingletemplate=$("#gravityview_single_template").val(),vcfg.directAccessSelect=$("#gv-direct-access-select"),vcfg.toggleInitialVisibility(vcfg),$(document.body).on("keydown keyup",vcfg.altKeyListener).on("change","#gravityview_form_id",vcfg.formChange).on("click",'a[href="#gv_start_fresh"]',vcfg.startFresh).on("click","#publish, #save-post",vcfg.processFormSubmit).on("submit","#post",vcfg.processFormSubmit).on("click",".gv-view-types-hover",vcfg.selectTemplateHover).on("click","a[rel*=external]",vcfg.openExternalLinks).on("click mouseup keyup",vcfg.closeTooltips).on("click",'.gv-field-filter-form span[role="button"]',vcfg.switchTooltipLayout).on("click","#gv_switch_view_button",vcfg.switchView).on("click",".clear-all-fields",vcfg.removeAllFields).on("click",".gv_select_template",vcfg.selectTemplate).on("change","select[data-view-dropdown]",vcfg.selectTemplate).on("click",".ui-tooltip-content .gv-fields",vcfg.startAddField).on("click",".gv-add-field-before",function(){$(this).closest(".active-drop-container").find("a.gv-add-field").trigger("click",{before:$(this).closest(".gv-fields")})}).on("click",".gv-field-duplicate",vcfg.duplicateField).on("click","#gv-direct-access .edit-direct-access",vcfg.editDirectAccess).on("click","#gv-direct-access-select .cancel-direct-access",vcfg.cancelDirectAccess).on("click","#gv-direct-access-select .save-direct-access",vcfg.updateDirectAccess).on("gravityview_form_change",vcfg.updateFormLinks).on("gravityview_form_change",vcfg.updateWidgetFormIds).on("change",".gv-dialog-options input[name*=show_as_link]",vcfg.toggleShowAsEntry).on("change",".gv-dialog-options input[name*=only_loggedin]",vcfg.toggleCustomVisibility).on("change",".gv-dialog-options [name*=allow_edit_cap]",vcfg.toggleCustomVisibility).on("change",".gv-dialog-options [name*=input_type]",vcfg.toggleInputHidden).on("click",".gv-field-controls .gv-remove-field",vcfg.removeField).on("click",".gv-field-controls .gv-field-settings",vcfg.openFieldSettings).on("dblclick",".gv-fields:not(.gv-nonexistent-form-field) h5",vcfg.openFieldSettings).on("change","#gravityview_settings",vcfg.changedSettingsAction).on("click",'div[data-js="gform-simplebar"]',vcfg.changedSettingsAction).on("click",".gv-field-details--toggle",function(e){var $dialog=$(this).parents(".ui-dialog"),was_closed=$(".gv-field-details",$dialog).hasClass("gv-field-details--closed");return viewConfiguration.toggleFieldDetails($dialog,was_closed),$.cookie("gv-field-details-expanded",was_closed,{path:gvGlobals.admin_cookiepath}),!1}).on("search keydown keyup",".gv-field-filter-form input:visible",vcfg.setupFieldFilters).on("click",".gv-section .is-dismissible .notice-dismiss",function(e){var warning_name=$(this).parents(".gv-section").attr("id")+"-"+$("#post_ID").val();$.cookie("warning-dismissed-"+warning_name,1,{path:gvGlobals.admin_cookiepath}),$(document.body).trigger("gravityview/tabs-ready")}).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry gravityview/view-config-updated",vcfg.toggleTabConfigurationWarnings).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry gravityview/view-config-updated",vcfg.toggleRemoveAllFields).on("search keydown keyup",".gv-field-filter-form input:visible",vcfg.setupFieldFilters).on("gravityview/loaded",function(){$(".gv-setting-list, #gravityview_settings").on("change",vcfg.toggleCheckboxes).trigger("change")}).on("change",".gv-dialog-options",vcfg.toggleCheckboxes).on("focus",".gv-add-field",function(e){$(this).parent(".gv-fields").addClass("trigger--hover")}).on("blur",".gv-add-field",function(e){$(this).parent(".gv-fields").removeClass("trigger--hover")}).on("keydown",".gv-add-field",function(e){if(13!==e.keyCode&&32!==e.keyCode)return!0;$(this).parent(".gv-fields").addClass("trigger--active")}).on("keyup",".gv-add-field",function(e){if(13!==e.keyCode&&32!==e.keyCode)return!0;$(this).parent(".gv-fields").removeClass("trigger--active")}).on("gravityview/dropdown/activate gravityview/dropdown/install",vcfg.enableLockedTemplate).on("gravityview/dialog-opened",function(e,dialog){var $expandButton,dialog=$(dialog).parent();dialog.find(".gv-dialog-warning").length||0===dialog.find(".gv-dialog-expand").length&&vcfg.dialogWidth<$(window).width()*vcfg.maxDialogWidth&&($expandButton=$("<button>",{class:"gv-dialog-expand ui-button","aria-label":gvGlobals.label_expand_dialog,"aria-expanded":"false","aria-controls":dialog.find(".ui-dialog-content").attr("id")||"dialog-content",title:gvGlobals.label_expand_dialog,html:'<span class="screen-reader-text">'+gvGlobals.label_expand_dialog+"</span>"+EXPAND_ICON}),dialog.find(".ui-dialog-titlebar").append($expandButton))}).on("click",".gv-dialog-expand",function(e){var $button,isExpanded;"keydown"===e.type&&"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e=$(this).closest(".ui-dialog"),$button=$(this),isExpanded=e.hasClass("gv-dialog-expanded"),e.toggleClass("gv-dialog-expanded"),$button.attr({"aria-expanded":!isExpanded,"aria-label":isExpanded?gvGlobals.label_contract_dialog:gvGlobals.label_expand_dialog,title:isExpanded?gvGlobals.label_contract_dialog:gvGlobals.label_expand_dialog}).find(".screen-reader-text").text(isExpanded?gvGlobals.label_contract_dialog:gvGlobals.label_expand_dialog).end().find("svg").replaceWith(isExpanded?EXPAND_ICON:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6.9 2c-.4 0-.7.3-.7.7v.5l.2 2.1-1.6-1.7-2-2c-.1-.2-.3-.2-.5-.2-.5 0-.8.3-.8.8s0 .4.2.5l2 2 1.7 1.6H3.2c0-.1-.5-.1-.5-.1-.4 0-.7.3-.7.7s.3.7.7.7h3.8c.8 0 1.2-.5 1.2-1.2V2.7c0-.4-.3-.7-.8-.7zm6.5 6.4H9.6c-.8 0-1.2.5-1.2 1.2v3.7c0 .4.3.7.8.7s.7-.3.7-.7v-2.6c-.1 0 1.5 1.7 1.5 1.7l2 2c.1.2.3.2.5.2.5 0 .8-.3.8-.8s0-.4-.2-.5l-2-2-1.7-1.6H13c0 .1.5.1.5.1.4 0 .7-.3.7-.7s-.3-.7-.7-.7z"/></svg>'),$(window).trigger("resize"))}).on("tooltipopen",vcfg.onTooltipOpen),$(window).on("resize",function(){var $openDialog=$(".ui-dialog:visible").find(".ui-dialog-content");$openDialog.dialog("option","position",{my:"center",at:"center",collision:"fit",of:window,within:$("#wpwrap")}),$openDialog.dialog("option","width",vcfg.getDialogWidth($openDialog))}),window.addEventListener("beforeunload",event=>{vcfg.hasUnsavedChanges&&event.preventDefault()}),gvGlobals.passed_form_id&&vcfg.gvSelectForm.trigger("change"),window.send_to_editor);window.send_to_editor=function(val){var $el=$("#"+window.wpActiveEditor);if(!$el.hasClass("codemirror")&&_sendToEditor)return _sendToEditor(val);var $el=$el.next(".CodeMirror")[0].CodeMirror,cursorPosition=$el.getCursor();$el.replaceRange(val,window.wp.CodeMirror.Pos(cursorPosition.line,cursorPosition.ch))},$("div .gform-dropdown__trigger").on("click.gravityforms",vcfg.sendMergeTagValueToCodemirrorEditor)},getDialogWidth:function($dialog){var dialog_width=viewConfiguration.dialogWidth,$dialog=(0<$dialog.parents('[data-fieldid="search_bar"]').length&&(dialog_width=1200),$(window).width()*viewConfiguration.maxDialogWidth);return $dialog<dialog_width?$dialog:dialog_width},getCookieVal:function(cookie){return!(!cookie||"undefined"===cookie||"false"===cookie)&&cookie},toggleTabConfigurationWarnings:function(e){var tabs={single:{configured:$(".gv-dialog-options input[name*=show_as_link]:checked","#directory-active-fields").length||$('[data-fieldid="entry_link"]',"#directory-active-fields").length,icon:"dashicons-media-default"},edit:{configured:$('.gv-fields .field-key[value="edit_link"]').length,icon:"dashicons-welcome-write-blog"}};$.each(tabs,function(index,value){var warning_name=index+"-fields-"+$("#post_ID").val(),warning_name=viewConfiguration.getCookieVal($.cookie("warning-dismissed-"+warning_name)),$fields_section=$("#"+index+"-fields"),fields_count=$fields_section.find(".active-drop .gv-fields").length,warning_name=!warning_name&&0===value.configured&&0<fields_count;$fields_section.find(".notice-no-link").toggle(warning_name),$('li[aria-controls="'+index+'-view"]').toggleClass("tab-not-configured",warning_name).find(".tab-icon").toggleClass("dashicons-warning",warning_name).toggleClass(value.icon,!warning_name)})},altKeyListener:function(e){viewConfiguration.altKey=e.altKey},changedSettingsAction:function(event){viewGeneralSettings.metaboxObj.find("[name^=template_settings]:visible").each(function(){viewConfiguration.validateField($(this))}),viewConfiguration.zebraStripeSettings()},validateField:function($field){var rules=$field.data("rules");rules&&(rules=viewConfiguration.validateValue($field.val(),rules),$field.toggleClass("gv-error",!!rules),$field.parent().find(".gv-error-message").remove(),rules)&&$field.parent().append($("<div>",{class:"gv-error-message",text:rules}))},validateValue(value,rules){if(rules){var i,validators=viewConfiguration.getValidators();for(i in rules)if(rules.hasOwnProperty(i)){var parts,ruleset=rules[i],rule=ruleset.rule,ruleset=ruleset.message,param="",isValid=!0;if(rule.includes(":")&&(rule=(parts=rule.split(/:(.+)/))[0],param=parts[1]),!(isValid=validators[rule]?validators[rule](value,param):isValid))return ruleset}}},getValidators:function(){return{required:function(value){return null!=value&&""!==value.toString().trim()},max:function(value,max){return null!=value&&Number(value)<=max},min:function(value,min){return null!=value&&Number(value)>=min},email:function(value){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)},integer:function(value){return Number.isInteger?Number.isInteger(Number(value)):Number(value)%1==0},matches:function(value,pattern){return new RegExp(pattern).test(value)}}},zebraStripeSettings:function(){setTimeout(function(){viewGeneralSettings.metaboxObj.find("table").each(function(){var $trs=$(this).find("tr").filter(":visible");$trs.removeClass("alternate"),$trs.filter(":even").addClass("alternate")})},50)},toggleCheckboxes:function(e){e=e.currentTarget||e,viewConfiguration.toggleRequired(e,"requires",!1),viewConfiguration.toggleRequired(e,"requires-not",!0),e=$(e).is(".gv-fields")?$(e):$(e).parents(".gv-fields");e.length&&(viewConfiguration.toggleDisabled($("input[type=checkbox][name*=link_to_]",e),$("input[type=checkbox][name*=show_as_link]",e)),viewConfiguration.toggleDisabled($("input[type=checkbox][name*=link_phone]",e),$("input[type=checkbox][name*=show_as_link]",e)))},toggleDisabled:function($one,$two){0!==$one.length&&0!==$two.length&&($one.is(":checked")?$two.prop("disabled",!0):$two.is(":checked")&&$one.prop("disabled",!0))},toggleRequired:function(currentTarget,data_attr,reverse_logic){let $parent=$(currentTarget,"#post");$parent.find("[data-"+data_attr+"]").each(function(){var $this=$(this),requires_array=$this.data(data_attr).split("="),requires_name=requires_array[0],requires_array=requires_array[1],$options=$this.closest(".gv-dialog-options"),$options=($parent=0<$options.length?$options:$parent).find('[name$="['+requires_name+']"]').filter(":input");$options.is("[type=checkbox]")?reverse_logic?$this.toggle(0<$options.filter(":not(:checked)").filter(":not(:hidden)").length):$this.toggle($options.is(":checked")):$options.is("[type=radio]")?reverse_logic?$this.toggle(!$options.filter('[value="'+requires_array+'"]').is(":checked")):$this.toggle($options.filter('[value="'+requires_array+'"]').is(":checked")):void 0!==requires_array&&(reverse_logic?$this.toggle($options.val()!==requires_array):$this.toggle($options.val()===requires_array))})},switchTooltipLayout:function(e){var layout=$(this).data("value");viewConfiguration.setTooltipLayout(layout)},setTooltipLayout:function(layout){$(".gv-items-picker--"+layout).addClass("active"),$(".gv-items-picker").not(".gv-items-picker--"+layout).removeClass("active"),$(".gv-items-picker-container").attr("data-layout",layout),$.cookie("gv-items-picker-layout",layout,{path:gvGlobals.admin_cookiepath})},closeTooltips:function(e){var activeTooltips=$("[data-tooltip='active']"),close=!1,return_false=!1;switch(e.type){case"keyup":if(27===e.keyCode){if($(".ui-autocomplete").is(":visible"))return;if(viewConfiguration.ignoreEscapeEvent)return void(viewConfiguration.ignoreEscapeEvent=!1);return_false=close=0===$(".gv-field-filter-form input[data-has-search]:focus").length,window.Beacon&&window.Beacon("close")}((13===e.keyCode||32===e.keyCode)&&$(e.target).is(".close")||$(e.target).is(".dashicons-dismiss"))&&(close=!0);break;case"mouseup":$(e.target).closest(".ui-tooltip").length?close=!1:$(e.target).closest(".ui-dialog").length?0<activeTooltips.length&&(close="tooltips"):0<activeTooltips.length&&(close=!0),$(e.target).parents(".close").length&&(close=!0);break;case"click":$(e.target).is(".gv-overlay")&&(return_false=close=!0,$(e.target).remove())}if(close&&(activeTooltips.gvTooltip("close"),"tooltips"!==close&&$(".ui-dialog:visible").find(".ui-dialog-content").dialog("close"),return_false))return!1},toggleShowAsEntry:function(e){var parent=$(e.target).parents(".gv-fields");parent.toggleClass("has-single-entry-link",$(e.target).is(":checked")),parent.find(".gv-field-controls .dashicons-media-default").toggleClass("hide-if-js",$(e.target).not(":checked")),$(document.body).trigger("gravityview/show-as-entry",$(e.target).is(":checked"))},toggleCustomVisibility:function(e){var custom_visibility=$(e.target).is("select")?"read"!==$(e.target).val():$(e.target).is(":checked"),$settings=$(e.target).closest(".gv-dialog-options");let $field;($field=$settings.data("field")?$settings.data("field"):(($settings=$(e.target).closest(".gv-fields")).toggleClass("has-custom-visibility",custom_visibility),$settings.find(".gv-field-controls")))&&$field.find(".icon-custom-visibility").toggleClass("hide-if-js",!custom_visibility)},toggleInputHidden:function(e){var is_hidden="hidden"===$(e.target).val(),$settings=$(e.target).closest(".gv-dialog-options");let $field;($field=$settings.data("field")?$settings.data("field"):(($settings=$(e.target).closest(".gv-fields")).toggleClass("has-input-hidden",is_hidden),$settings.find(".gv-field-controls")))&&$field.find(".icon-hidden").toggleClass("hide-if-js",!is_hidden)},selectText:function(e){return e.preventDefault(),$(this).trigger("focus").trigger("select"),!1},editDirectAccess:function(e){var vcfg=viewConfiguration;e.preventDefault(),vcfg.directAccessSelect.is(":visible")||(vcfg.directAccessSelect.slideDown("fast",function(){vcfg.directAccessSelect.find('input[type="radio"]').first().trigger("focus")}),$(this).hide())},cancelDirectAccess:function(e){viewConfiguration.directAccessSelect.slideUp("fast"),$("#gv-direct-access-display strong").text(function(){return $(this).data("initial-label")}),$("#gv-direct-access .edit-direct-access").show().trigger("focus"),e.preventDefault()},updateDirectAccess:function(e){var checked,selectedDirectAccess=viewConfiguration.directAccessSelect.find("input:radio:checked");viewConfiguration.directAccessSelect.slideUp("fast"),$("#gv-direct-access .edit-direct-access").show().trigger("focus"),checked="embed"===selectedDirectAccess.val(),$("#gravityview_se_embed_only").prop("checked",checked),$("#gv-direct-access-display strong").text(selectedDirectAccess.data("display-label")),$("#gv-direct-access").toggleClass("embed-only",checked),e.preventDefault()},toggleInitialVisibility:function(vcfg){0!==vcfg.gvSelectForm.length&&(""===vcfg.currentFormId?vcfg.hideView():$("#gravityview_directory_template").length&&0<$("#gravityview_directory_template").val().length?($("#gravityview_select_template").slideUp(150),vcfg.showViewConfig()):(vcfg.templateFilter("custom"),vcfg.showViewTypeMetabox()),vcfg.currentFormId&&!vcfg.currentTemplateId&&vcfg.gvSwitchView.hide(),vcfg.togglePreviewButton(),vcfg.zebraStripeSettings(!0))},togglePreviewButton:function(){var preview_button=$("#preview-action").find(".button");""===viewConfiguration.gvSelectForm.val()?preview_button.hide():preview_button.show()},hideView:function(){var vcfg=viewConfiguration;vcfg.currentFormId="",vcfg.togglePreviewButton(),$("#gravityview_view_config, #gravityview_select_template, #gravityview_sort_filter, .gv-form-links").hide(),viewGeneralSettings.metaboxObj.hide()},updateFormLinks:function(){var vcfg=viewConfiguration;$(".gv-form-links a").each(function(){var new_url=$(this).attr("href").replace(/id=([0-9]+)/gm,"id="+vcfg.gvSelectForm.val());$(this).attr("href",new_url)})},updateWidgetFormIds:function(){var vcfg=viewConfiguration;$(".field-form-id").each(function(){$(this).val(vcfg.gvSelectForm.val())})},toggleViewTypeMetabox:function(){var $templates=$("#gravityview_select_template"),vcfg=viewConfiguration;$templates.is(":visible")?(vcfg.gvSwitchView.text(function(){return $(this).attr("data-text-backup")}),vcfg.currentDirectoryTemplate&&$templates.slideUp(150)):(vcfg.currentDirectoryTemplate?vcfg.gvSwitchView.attr("data-text-backup",function(){return $(this).text()}).text(gvGlobals.label_cancel):vcfg.gvSwitchView.hide(),$templates.slideDown(150))},showViewTypeMetabox:function(){$("#gravityview_select_template").slideDown(150)},startFresh:function(e){e.preventDefault();e=viewConfiguration;e.startFreshStatus=!0,e.getConfiguredFields().length?e.showDialog("#gravityview_select_preset_dialog"):e.startFreshContinue()},startFreshContinue:function(){var vcfg=viewConfiguration;$("#gravityview_form_id_start_fresh").val("1"),$("#gravityview_form_id").val(""),vcfg.currentFormId="",vcfg.currentTemplateId="",vcfg.gvSwitchView.hide(),vcfg.templateFilter("preset"),vcfg.showViewTypeMetabox(),vcfg.hideViewConfig(),vcfg.togglePreviewButton()},formChange:function(e){e.preventDefault();e=viewConfiguration;e.altKey||(e.startFreshStatus=!1,e.getConfiguredFields().length?e.showDialog("#gravityview_change_form_dialog"):e.formChangeContinue(),e.togglePreviewButton())},formChangeContinue:function(){var vcfg=viewConfiguration;vcfg.gvSelectForm.val()?(vcfg.templateFilter("custom"),Promise.all([vcfg.getAvailableFields(),vcfg.getSortableFields()]).then(function(){vcfg.currentFormId||vcfg.currentDirectoryTemplate?(vcfg.currentDirectoryTemplate&&vcfg.currentDirectoryTemplate&&vcfg.gvSwitchView.show(),vcfg.gvSwitchView.click()):(vcfg.showViewTypeMetabox(),vcfg.gvSwitchView.fadeOut(150))})):(vcfg.getConfiguredFields().remove(),vcfg.hideView(),vcfg.gvSwitchView.fadeOut(150)),vcfg.currentTemplateId="",vcfg.currentFormId=vcfg.gvSelectForm.val(),vcfg.setUnsavedChanges(!0),$(document.body).trigger("gravityview_form_change").addClass("gv-form-changed")},showDialog:function(dialogSelector,buttons){var vcfg=viewConfiguration,thisDialog=$(dialogSelector),dialogSelector={text:gvGlobals.label_cancel,click:function(){thisDialog.is("#gravityview_change_form_dialog")?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.val(vcfg.currentFormId)):thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg._isViewDropDown()||vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig()),thisDialog.dialog("close")}};buttons=buttons||[dialogSelector,{text:gvGlobals.label_continue,click:function(){thisDialog.is("#gravityview_change_form_dialog")||thisDialog.is("#gravityview_select_preset_dialog")?vcfg.startFreshStatus?vcfg.startFreshContinue():vcfg.formChangeContinue():thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg.selectTemplateContinue(!1),vcfg._isViewDropDown()||vcfg.toggleViewTypeMetabox()),vcfg._storeValue(),thisDialog.dialog("close")}}],thisDialog.dialog({dialogClass:"wp-dialog gv-dialog",appendTo:thisDialog.parent(),draggable:!1,resizable:!1,width:vcfg.getDialogWidth(thisDialog),open:function(){return $('<div class="gv-overlay" />').prependTo("#wpwrap"),$(document.body).trigger("gravityview/dialog-opened",thisDialog),vcfg.toggleCheckboxes(thisDialog),vcfg.setupFieldDetails(thisDialog),vcfg.refresh_merge_tags(thisDialog,function(){vcfg.setupCodeMirror(thisDialog)}),($sortableEls=$('.ui-widget-content[aria-hidden="false"]').find(".active-drop-widget, .active-drop-field")).length&&$sortableEls.each((i,el)=>{$(el).hasClass("ui-sortable")&&$(el).sortable("disable")}),!0},close:function(e){e.preventDefault(),$("textarea.code",thisDialog).each(function(){0!==($CodeMirror=$(this).next(".CodeMirror")).length&&$CodeMirror[0].hasOwnProperty("CodeMirror")&&$CodeMirror[0].CodeMirror.toTextArea()}),thisDialog.find(".merge-tag-support").removeClass("merge-tag-support").addClass("gv-merge-tag-support"),$(".gv-field-settings.active","#gravityview_view_config").removeClass("active"),vcfg.setCustomLabel(thisDialog),$("#wpwrap").find("> .gv-overlay").fadeOut("fast",function(){$(this).remove()}),($sortableEls=$('.ui-widget-content[aria-hidden="false"]').find(".active-drop-widget, .active-drop-field")).length&&$sortableEls.each((i,el)=>{$(el).hasClass("ui-sortable")&&$(el).sortable("enable")}),vcfg._restoreValue(),$(document.body).trigger("gravityview/dialog-closed",thisDialog)},closeOnEscape:!0,buttons:buttons})},setupCodeMirror:function(dialog){var vcfg=viewConfiguration;$("textarea.code:visible",dialog).each(function(){var $textarea,editorId,mergeTag,initialEditorCursorPos,$autocompleteEl,closeAutocompletion,codemirrorConfig=$.extend(!0,{},wp.codeEditor.defaultSettings),attributeValue=$(this).data("codemirror");attributeValue&&(codemirrorConfig.codemirror=$.extend({},codemirrorConfig.codemirror,attributeValue));let editor=wp.codeEditor.initialize($(this),codemirrorConfig);($(this).hasClass("merge-tag-support")||$(this).hasClass("gv-merge-tag-support"))&&(editor.codemirror.setSize("95%"),$textarea=$(this),editorId=$textarea.attr("id"),attributeValue=window.gfMergeTags.getAutoCompleteMergeTags($textarea),mergeTag="",initialEditorCursorPos=editor.codemirror.getCursor(),$textarea.parent().find(".all-merge-tags").detach().insertBefore($textarea),$textarea.parent().find("div .gform-dropdown__trigger").on("click.gravityforms",vcfg.sendMergeTagValueToCodemirrorEditor),$textarea.autocomplete({appendTo:$textarea.parent(),minLength:1,position:{my:"center top",at:"center bottom",collision:"none"},source:attributeValue,select:function(event,ui){var ui=ui.item.value.replace(/^{|}$/gm,""),currentEditorCursorPos=editor.codemirror.getCursor();editor.codemirror.replaceRange(ui,initialEditorCursorPos,window.wp.CodeMirror.Pos(currentEditorCursorPos.line,currentEditorCursorPos.ch)),editor.codemirror.focus(),editor.codemirror.setCursor(window.wp.CodeMirror.Pos(currentEditorCursorPos.line,currentEditorCursorPos.ch+ui.length+1))}}),$autocompleteEl=$textarea.parent().find("ul.ui-autocomplete"),closeAutocompletion=function(){$("#"+editorId).autocomplete("close")},$(document.body).on("keyup",function(e){$autocompleteEl.is(":visible")&&27===e.which&&(e.preventDefault(),closeAutocompletion(),$textarea.trigger("focus"))}),editor.codemirror.on("mousedown",function(){closeAutocompletion()}),editor.codemirror.on("keydown",function(el,e){!$autocompleteEl.is(":visible")||38!==e.which&&40!==e.which&&13!==e.which||($autocompleteEl.not(":focus")&&$autocompleteEl.trigger("focus"),e.preventDefault())}),editor.codemirror.on("change",function(e,obj){"{}"===obj.text[0]&&(initialEditorCursorPos=editor.codemirror.getCursor());obj=editor.codemirror.getCursor();"{"===(mergeTag=editor.codemirror.getRange({ch:initialEditorCursorPos.ch-1,line:initialEditorCursorPos.line},obj))[0]?$("#"+editorId).autocomplete("search",mergeTag):closeAutocompletion()}))})},sendMergeTagValueToCodemirrorEditor:function(e){var _activeEditorBackup=window.wpActiveEditor;window.wpActiveEditor=$(e.currentTarget).parentsUntil(".gv-setting-container").find("textarea").attr("id"),window.wpActiveEditor&&window.send_to_editor($(this).data("value")),window.wpActiveEditor=_activeEditorBackup},setupFieldDetails:function(dialog){var show_details_cookie;dialog.parents('[data-fieldid="search_bar"]').length||($(".gv-field-details--container",dialog).insertAfter(".ui-dialog-title:visible"),show_details_cookie=$.cookie("gv-field-details-expanded"),show_details_cookie=viewConfiguration.getCookieVal(show_details_cookie),viewConfiguration.toggleFieldDetails(dialog,show_details_cookie),viewConfiguration.migrateSurveyScore(dialog))},migrateSurveyScore:function($dialog){var $score;0!==$dialog.parents('[data-inputtype="survey"]').length&&($score=$dialog.find(".gv-setting-container-score input"))&&0!=+$score.val()&&$dialog.find('.gv-setting-container-choice_display input[value="score"]').trigger("click").trigger("focus")},toggleFieldDetails:function($dialog,show_details){($parent=$dialog.parent()).find(".gv-field-details").toggleClass("gv-field-details--closed",!show_details).end().find(".gv-field-details--toggle .dashicons").toggleClass("dashicons-arrow-down",!!show_details).toggleClass("dashicons-arrow-right",!show_details).end()},setCustomLabel:function(dialog){var $admin_label=$("[name*=admin_label]",dialog),$admin_label=$admin_label.length&&$admin_label.val()?$admin_label:$("[name*=custom_label]",dialog);$(dialog).closest("[data-search-fields]").length===$admin_label.closest("[data-search-fields]").length&&(dialog=dialog.closest(".gv-fields").find(".gv-field-label-text-container").first(),$admin_label.length)&&(0<($admin_label=$admin_label.val().trim()).length?dialog.html($admin_label):dialog.html(dialog.parent(".gv-field-label").data("original-title")))},ignoreEscape:function(){viewConfiguration.ignoreEscapeEvent=!0},getSortableFields:function(context,id){return new Promise((resolve,reject)=>{var vcfg=viewConfiguration,data=($(".gravityview_sort_field").prop("disabled","disabled").empty().append("<option>"+gvGlobals.loading_text+"</option>"),{action:"gv_sortable_fields_form",nonce:gvGlobals.nonce});void 0!==context&&"preset"===context?data.template_id=id:data.form_id=vcfg.gvSelectForm.val(),$.post(ajaxurl,data,function(response){"false"!==response&&"0"!==response&&$(".gravityview_sort_field").empty().append(response).prop("disabled",null),resolve()})})},hideViewConfig:function(){$("#gravityview_view_config").slideUp(150),$(document).trigger("gv_admin_views_hideViewConfig")},showViewConfig:function(){$("#gravityview_view_config").slideDown(150),viewGeneralSettings.metaboxObj.show(),viewConfiguration.toggleDropMessage(),viewConfiguration.init_tooltips(),$(document).trigger("gv_admin_views_showViewConfig")},switchView:function(e){e.preventDefault(),e.stopImmediatePropagation();e=viewConfiguration;e.templateFilter("custom"),e.toggleViewTypeMetabox()},templateFilter:function(templateType){$(".gv-view-types-module").each(function(){$(this).attr("data-filter")===templateType?$(this).parent().show():$(this).parent().hide()})},_isViewDropDown:function(){return viewConfiguration.wantedTemplate&&void 0!==viewConfiguration.wantedTemplate.data("view-data")},_getCurrentTemplateId(){var section=this._getTemplateSection();return null===section||"directory"===section?this.currentDirectoryTemplate:"single"===section?this.currentSingletemplate:""},_setCurrentTemplateId(template_id){var section=this._getTemplateSection();null!==section&&"directory"!==section||(this.currentDirectoryTemplate=template_id),null!==section&&"single"!==section||(this.currentSingletemplate=template_id)},_getTemplateId:function(use_base_template=!1){var $template=viewConfiguration.wantedTemplate;if(!$template)return"";let template_id=$template.data(use_base_template?"base-template":"templateid");return viewConfiguration._isViewDropDown()&&(template_id=viewConfiguration.wantedTemplate.val(),template_id=String($template.val())),template_id},_getTemplateSection:function(){let section=null;return section=viewConfiguration._isViewDropDown()?viewConfiguration.wantedTemplate.data("section"):section},_restoreValue:function(){viewConfiguration._isViewDropDown()&&viewConfiguration.wantedTemplate.data("view-data").restoreValue()},_storeValue:function(){viewConfiguration.wantedTemplate&&(viewConfiguration._isViewDropDown()?viewConfiguration.wantedTemplate.data("view-data").storeValue():$("select[data-view-dropdown]").each(function(){$(this).data("view-data").storeValue()}),this._setCurrentTemplateId(this._getTemplateId()))},selectTemplate:function(e,data){var currentTemplate,currTemplateIdSlug,vcfg=viewConfiguration;void 0!==data&&null===data.section||(e.preventDefault(),e.stopImmediatePropagation(),vcfg.wantedTemplate=$(this),data=vcfg._getTemplateId(),e=/(.*?)_(.*?)$/i,currTemplateIdSlug=(currentTemplate=vcfg._getCurrentTemplateId()).replace(e,"$2"),e=data.replace(e,"$2")===currTemplateIdSlug,currentTemplate&&!e&&vcfg.getConfiguredFields().length?currentTemplate!==data?vcfg.getConfiguredFields().length?vcfg.showDialog("#gravityview_switch_template_dialog"):(vcfg.toggleViewTypeMetabox(),vcfg.selectTemplateContinue(e)):(vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig()):($("#gravityview_select_template").slideUp(150),vcfg.selectTemplateContinue(e),vcfg._storeValue()))},selectTemplateContinue:function(slugmatch){var vcfg=viewConfiguration,selectedTemplateId=vcfg._getTemplateId(),selectedFormId=vcfg.gvSelectForm.val(),changeAllSection=!vcfg._getTemplateSection(),base_template=(changeAllSection&&(base_template=vcfg._getTemplateId(),$("#gravityview_directory_template").val(base_template).trigger("change",{section:null}),$("#gravityview_single_template").val(base_template).trigger("change",{section:null})),vcfg.wantedTemplate.parents(".gv-view-types-module"));base_template.parents(".gv-grid").find(".gv-view-types-module").removeClass("gv-selected"),base_template.addClass("gv-selected"),vcfg.waiting("start"),vcfg.startFreshStatus?Promise.all([vcfg.getAvailableFields("preset",selectedTemplateId),vcfg.getPresetFields(selectedTemplateId),vcfg.getSortableFields("preset",selectedTemplateId)]).then(function(){$(".ui-tabs-panel").each(function(){vcfg.init_droppables(this)})}):(!slugmatch||changeAllSection?vcfg.updateActiveAreas(selectedTemplateId,+selectedFormId):vcfg.waiting("stop"),changeAllSection&&(vcfg.gvSwitchView.fadeIn(150),vcfg.toggleViewTypeMetabox())),vcfg.currentTemplateId=selectedTemplateId,vcfg.setUnsavedChanges(!0)},server_request:(ajaxRoute,payload)=>{let defer=$.Deferred();viewConfiguration.performingAjaxAction=!0,$(".gv-view-template-notice").hide();var{_wpNonce:nonce,_wpAjaxAction:action,_wpAjaxUrl:url,ajaxRouter,frontendFoundationVersion}=window.gvGlobals.foundation_licenses_router;return $.post(url,{nonce:nonce,action:action,ajaxRouter:ajaxRouter,ajaxRoute:ajaxRoute,frontendFoundationVersion:frontendFoundationVersion,payload:payload}).fail(response=>defer.reject(response.responseText)).done(response=>{response.success?(viewConfiguration.performingAjaxAction=!1,defer.resolve(response)):defer.reject(response.data)}),defer.promise()},selectTemplateHover:function(e){let vcfg=viewConfiguration,$link=$(e.target),$parent=$link.parents(".gv-view-types-module"),$select=$(this).find(".gv_select_template");if($link.is("[rel=internal]")&&!$link.hasClass("gv-layout-activate")&&!$link.hasClass("gv-layout-install"))return!0;e.preventDefault(),e.stopImmediatePropagation();var e=error=>{$(".gv-view-template-notice").show().find("p").html(error),document.querySelector(".gv-view-template-notice").scrollIntoView({behavior:"smooth"})},do_always=()=>{vcfg.performingAjaxAction=!1,$link.removeClass("disabled"),$parent.removeClass("active")},on_success=()=>{$parent.find(".gv-view-types-hover > div:eq(0)").hide(),$parent.find(".gv-view-types-hover > div:eq(1)").removeClass("hidden"),$parent.removeClass("gv-view-template-placeholder"),$parent.find("a.gv_select_template").attr("data-templateid",$link.data("templateid")).trigger("click"),vcfg.activateViewSelection($link.data("templateid")),$select.trigger("click")};if($link.hasClass("gv-layout-activate"))return vcfg.performingAjaxAction?void 0:($parent.addClass("active"),$link.addClass("disabled").attr("disabled",!0),$link.html($spinner),void $.when(vcfg.server_request("activate_product",{text_domain:$link.attr("data-template-text-domain")})).then(on_success).always(do_always).fail(e));$link.hasClass("gv-layout-install")&&!vcfg.performingAjaxAction&&($parent.addClass("active"),$link.addClass("disabled").attr("disabled",!0),$link.html($spinner),$.when(vcfg.server_request("install_product",{id:$link.attr("data-download-id"),text_domain:$link.attr("data-template-text-domain"),activate:!0})).then(on_success).always(do_always).fail(e))},enableLockedTemplate:function(e,data){let $option=$(data?.option)||null;var action=data?.action||null,payload={text_domain:$option.data("template-text-domain"),activate:!0};if("{}"!==JSON.stringify(payload)){let $pill=$(e.target),$item=$pill.closest(".view-dropdown-list-item");$pill.addClass("is-idle").html($spinner),$item.addClass("is-idle"),$.when(viewConfiguration.server_request(action+"_product",payload)).then(()=>{$pill.removeClass("has-failed"),viewConfiguration.activateViewSelection($option.data("template-id")),data?.dropdown?.focusActive()}).fail(error=>{$pill.addClass("has-failed").text("Error"),console.log(error)}).always(()=>{$pill.removeClass("is-idle"),$item.removeClass("is-idle")})}},activateViewSelection:function(template_id){var $view_selectors=$("[data-view-dropdown]"),$options=$view_selectors.find('option[data-template-id="'+template_id+'"]');$options.attr("disabled",!1),$options.val(template_id),$view_selectors.each((_,el)=>{$(el).viewDropdown().renderOptions()}),viewConfiguration.updateSettingsArea()},openExternalLinks:function(){return window.Beacon&&($(this).is("[data-beacon-article]")||$(this).is("[data-beacon-article-modal]")||$(this).is("[data-beacon-article-sidebar]")||$(this).is("[data-beacon-article-inline]"))||window.open(this.href),!1},previewTemplate:function(e){e.preventDefault(),e.stopImmediatePropagation();var parent=$(e.currentTarget).parents(".gv-view-types-module");parent.find(".gv-template-preview").dialog({dialogClass:"wp-dialog gv-dialog",appendTo:$("#gravityview_select_template"),width:viewConfiguration.dialogWidth,open:function(){$('<div class="gv-overlay" />').prependTo("#wpwrap")},close:function(){$(this).dialog("option","appendTo",parent),$("#wpwrap").find("> .gv-overlay").fadeOut("fast",function(){$(this).remove()})},closeOnEscape:!0,buttons:[{text:gvGlobals.label_close,click:function(){$(this).dialog("close")}}]})},updateActiveAreas:function(template,form_id){var vcfg=viewConfiguration,template={action:"gv_get_active_areas",template_id:template,form_id:form_id,nonce:gvGlobals.nonce};return vcfg.updateViewConfig(template)},updateSettingsArea:function(){let $settings_content=$("#gravityview_settings .inside");$settings_content.html(""),$.get(document.URL,function(response){response&&(response=$(response),$settings_content.html(response.find("#gravityview_settings .inside").html()),viewGeneralSettings.refresh(),$("#gravityview_directory_template").trigger("change"))})},getPresetFields:function(template){var vcfg=viewConfiguration,template=($("#directory-active-fields, #single-active-fields").children().remove(),{action:"gv_get_preset_fields",template_id:template,nonce:gvGlobals.nonce});return vcfg.updateViewConfig(template)},updateViewConfig:function(data){return new Promise((resolve,reject)=>{let vcfg=viewConfiguration,section=vcfg._getTemplateSection(),update_directory="directory"===section||null===section,update_single="single"===section||null===section;update_directory&&$("#directory-active-fields").children().remove(),update_single&&$("#single-active-fields").children().remove(),$.post(ajaxurl,data,function(response){response&&(response=JSON.parse(response),update_directory&&($("#directory-header-widgets").html(response.header),$("#directory-footer-widgets").html(response.footer),$("#directory-active-fields").append(response.directory),$("#directory-header-widgets a[data-templateid], #directory-footer-widgets a[data-templateid]").attr("data-templateid",data.template_id).attr("data-formid",data.form_id)),update_single&&$("#single-active-fields").append(response.single),vcfg.showViewConfig(),vcfg.waiting("stop"),$(document.body).trigger("gravityview/view-config-updated",response,section)),resolve()}),vcfg.setUnsavedChanges(!0)})},waiting:function(action){$containers=$("#wpwrap,.gv-fields"),"start"===action?$containers.addClass("gv-wait"):$containers.removeClass("gv-wait")},remove_tooltips:function(el){$(el||".gv-add-field").is(":ui-tooltip")&&$(".gv-add-field").gvTooltip("destroy").off("click")},init_tooltips:function(el){0!==$(el||".gv-add-field","#post").not(":ui-tooltip").length&&$(el||".gv-add-field","#post").gvTooltip({show:150,hide:200,content:function(){var context=$(this).attr("data-context"),formId=$(this).attr("data-formid")||$("#gravityview_form_id").val(),templateId=$("#gravityview_directory_template").val();switch($(this).attr("data-objecttype")){case"search":case"field":return $("#"+context+"-available-fields-"+(formId||templateId)).html();case"widget":return $("#directory-available-widgets").html()}},close:function(){$(this).attr("data-tooltip",null)},open:function(event,tooltip){$(this).attr("data-tooltip","active").attr("data-tooltip-id",$(this).attr("aria-describedby"));let $focus_item=$("input[type=search]",tooltip.tooltip);$focus_item.length||($focus_item=$(tooltip.tooltip).find(".close").first());var activate_layout="list",tooltip=($(tooltip).find(".gv-items-picker-container[data-layout]").length?activate_layout=$(tooltip).find(".gv-items-picker-container[data-layout]").attr("data-layout"):(tooltip=$.cookie("gv-items-picker-layout"),viewConfiguration.getCookieVal(tooltip)&&(activate_layout=tooltip)),viewConfiguration.setTooltipLayout(activate_layout),$focus_item[0].focus({preventScroll:!0}),$focus_item[0].getBoundingClientRect());(tooltip.y<0||tooltip.y>document.body.getBoundingClientRect().height)&&window.scrollTo({left:window.scrollX,top:window.scrollY+tooltip.y+(tooltip.y<0?-60:60),behavior:"smooth"})},disabled:!0,position:{my:"center bottom",at:"center top-12"},tooltipClass:"gravityview-item-picker-tooltip top"}).attr("title",function(){return $(this).attr("title")||$(this).data("title")||""}).on("mouseout focusout",e=>e.stopImmediatePropagation()).on("click",function(e,data){$(this).attr("title",""),$(this).data("before",null),data?.before&&$(this).data("before",data.before),e.preventDefault(),$(this).gvTooltip("open")})},setupFieldFilters:function(e){var input=$(this).val().trim(),$tooltip=$(this).parents(".ui-tooltip-content"),$resultsNotFound=$tooltip.find(".gv-no-results");"keydown"===e.type?$(this).attr("data-has-search",0<input.length?input.length:null):($tooltip.find(".gv-fields").show().filter(function(){var match_title=$(this).find(".gv-field-label").attr("data-original-title").match(new RegExp(input,"i")),match_id=$(this).attr("data-fieldid").match(new RegExp(input,"i")),match_parent=!!$(this).attr("data-parent-label")&&$(this).attr("data-parent-label").match(new RegExp(input,"i"));return!match_title&&!match_id&&!match_parent}).hide(),$tooltip.find(".gv-fields:visible").length?$resultsNotFound.hide():$resultsNotFound.show())},refreshGFtooltips:function(){$(".gf_tooltip").gvTooltip({show:500,hide:1e3,content:function(){return $(this).prop("title")}})},getConfiguredFields:function(){var section=viewConfiguration._getTemplateSection(),selectors={directory:"#directory-active-fields",single:"#single-active-fields"},selectors=selectors.hasOwnProperty(section)?selectors[section]:"#directory-active-fields, #single-active-fields, #edit-active-fields";return $(selectors).find(".gv-fields")},getAvailableFields:function(preset,templateid){return new Promise((resolve,reject)=>{var vcfg=viewConfiguration,data=(vcfg.toggleDropMessage(),vcfg.getConfiguredFields().remove(),{action:"gv_available_fields",nonce:gvGlobals.nonce});data.form_preset_ids=void 0!==preset&&"preset"===preset?[templateid]:[vcfg.gvSelectForm.val()],$("#directory-available-fields-"+data.form_preset_ids[0]).length||$.post(ajaxurl,data,function(response){response.success||response.data||resolve(),$.each(response.data,function(context,markup){$("#"+context+"-fields").append(markup)}),resolve()})})},startAddField:function(e){$(this).has(".field-id-all-fields").length?viewConfiguration.addAllFields($(this)):viewConfiguration.addField($(this),e)},addAllFields:function(clicked){let fields=clicked.siblings(".gv-fields").filter(function(){var field_id=$(this).data("fieldid");return+field_id===parseInt(field_id,10)});!async function(){for(let i=0;i<fields.length;i++)await(el=>new Promise((resolve,reject)=>{$(document.body).one("gravityview/field-added",function(){resolve()}),$(el).trigger("click")}))(fields[i]);$("a.gv-add-field[data-tooltip='active']").gvTooltip("close")}()},addField:function(clicked,e){e.preventDefault();var e=clicked.closest(".ui-tooltip").attr("id"),e=$('.gv-add-field[data-tooltip-id="'+e+'"]'),$before=e.data("before");viewConfiguration.placeField(clicked,e,$before,!!$before),viewConfiguration.toggleAllowedOnceField(clicked)},placeField:function($field,$addButton,$anchor,add_before_anchor=!1){let vcfg=viewConfiguration,$newField=$field.clone().hide();var data={action:"gv_field_options",template:$addButton.attr("data-templateid")??$addButton.parents(".gv-section").find(".view-template-select select").val()??$("#gravityview_directory_template").val(),area:$addButton.attr("data-areaid"),context:$addButton.attr("data-context"),field_id:$newField.attr("data-fieldid"),field_label:$newField.find(".gv-field-label").attr("data-original-title"),field_type:$addButton.attr("data-objecttype"),input_type:$newField.attr("data-inputtype"),form_id:parseInt($field.attr("data-formid"),10)||vcfg.currentFormId,nonce:gvGlobals.nonce};$.ajax({type:"POST",url:ajaxurl,data:data,async:!0,beforeSend:function(){vcfg.disable_publish()},complete:function(){vcfg.enable_publish()}}).done(function(response){var regex=/[^\[]+\[[^\]]+\]\[([^\]]+)\].*/i;if(0<$field.find("input.field-key").length){$newField.find(".gv-dialog, .gv-dialog-options").remove();let oldId=$field.find("input.field-key").attr("name").replace(regex,"$1"),newId=response.match(regex,"$1")[1]??null;response=$(response),$field.find(".gv-dialog-options :input").each(function(i,el){var $fields;$(el).attr("name")&&(1===($fields=response.find('[name="'+$(el).attr("name").replaceAll(""+oldId,""+newId)+'"]')).length?$fields.val($(el).val()):2===$fields.length&&$(el).is(":checked")&&$fields.prop("checked",!0))})}$newField.append(response),$(".ui-tabs-panel").each(function(){vcfg.init_droppables(this)}),0<$(".gv-dialog-options",$newField).length&&$(".gv-field-settings",$newField).removeClass("hide-if-js"),$anchor?(regex=add_before_anchor?"insertBefore":"insertAfter",$newField[regex]($anchor)):$addButton.closest(".gv-droppable-area").find(".active-drop").first().append($newField),$(document.body).trigger("gravityview/field-added",$newField),$newField.fadeIn(100),vcfg.refreshGFtooltips()}).fail(function(jqXHR){vcfg.enable_publish(),alert(gvGlobals.field_loaderror),console.log(jqXHR)}).always(function(){vcfg.toggleDropMessage(),vcfg.setUnsavedChanges(!0)})},duplicateField:function(e){e.preventDefault();e=$(this).closest(".gv-fields");viewConfiguration.placeField(e,$(this).closest(".active-drop-container").find("a.gv-add-field"),e)},onTooltipOpen:function(e,tooltip){viewConfiguration.filterFields(e.target,tooltip.tooltip[0])},toggleAllowedOnceField:function(target,toggle=!0){$(target).is('[data-allowed-once="true"]')||(target=$(target).closest('[data-allowed-once="true"]')),$(target).toggleClass("gv-field--is-added",toggle)},filterFields:function(source,wrapper){let fields=$(source).closest(".gv-section").find("[data-fieldid]").map((_,el)=>$(el).data("fieldid")).toArray();var $content,source=$(wrapper).html();source&&(($content=$("<div>").html(source)).find('[data-allowed-once="true"]').each((_,el)=>{var is_added=-1<fields.indexOf($(el).data("fieldid"));viewConfiguration.toggleAllowedOnceField(el,is_added)}),source=$content.html(),$(wrapper).html(source))},refresh_merge_tags:function($source,onRefresh){let $merge_tag_supported=$source?$(".gv-merge-tag-support,.merge-tag-support",$source):$(".gv-merge-tag-support:visible");$merge_tag_supported.removeClass("gv-merge-tag-support mt-initialized").addClass("merge-tag-support"),window.gform?.instances?.mergeTags?($(".all-merge-tags",$source).remove(),document.dispatchEvent(new Event("DOMContentLoaded")),setTimeout(function(){$merge_tag_supported.removeClass("merge-tag-support").addClass("gv-merge-tag-support"),onRefresh&&onRefresh()},300)):"undefined"!=typeof form&&$(document.body).not(".gv-form-changed")&&0<=$merge_tag_supported.length&&(window.gfMergeTags&&($(".all-merge-tags:visible").remove(),gfMergeTags.hasOwnProperty("destroy")?$merge_tag_supported.each(function(){new gfMergeTagsObj(form,$(this))}):window.gfMergeTags=new gfMergeTagsObj(form)),$merge_tag_supported.removeClass("merge-tag-support").addClass("gv-merge-tag-support"),onRefresh)&&onRefresh()},enable_publish:function(){$(document).trigger("autosave-enable-buttons.edit-post"),$("#publishing-action").find("#publish").prop("disabled",null).removeClass("button-primary-disabled")},disable_publish:function(){$(document).trigger("autosave-disable-buttons.edit-post"),$("#publishing-action").find("#publish").prop("disabled","disabled").addClass("button-primary-disabled")},init_droppables:function(panel){var vcfg;$(panel).find(".active-drop-field").sortable("instance")||(vcfg=viewConfiguration,$(panel).find(".active-drop-widget").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-widget",start:function(event,ui){$("#directory-fields, #single-fields").find(".active-drop-container-widget").addClass("is-receivable")},stop:function(event,ui){$("#directory-fields, #single-fields").find(".active-drop-container-widget").removeClass("is-receivable")},change:function(event,ui){vcfg.setUnsavedChanges(!0)},receive:function(event,ui){var sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid");ui.item.find('[name^="widgets['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))}),vcfg.toggleDropMessage()}}),$(panel).find(".active-drop-field").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-field",start:function(event,ui){$(document.body).find(".active-drop-container-field").addClass("is-receivable")},stop:function(event,ui){$(document.body).find(".active-drop-container-field").removeClass("is-receivable")},change:function(event,ui){vcfg.setUnsavedChanges(!0)},receive:function(event,ui){var sender_area,receiver_area;0<ui.item.find(".gv-dialog-options").length&&(sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid"),ui.item.find('[name^="fields['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))})),vcfg.toggleDropMessage()}}),$(panel).find(".active-drop-search").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-search",start:function(_,ui){ui=ui.item.data("allowed-sections");let $containers=$(document.body).find(".active-drop-container-search");if(ui){let sections=ui.split(",");$containers=$containers.filter(function(){return-1<sections.indexOf($(this).closest("[data-grid-context]").data("grid-context"))})}$containers.addClass("is-receivable")},stop:function(_,ui){$(document.body).find(".active-drop-container-search").removeClass("is-receivable")},change:function(){vcfg.setUnsavedChanges(!0)},receive:function(_,ui){if(0<ui.item.find(".gv-dialog-options").length){let sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid");ui.item.find('[name*="['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))})}var targetContext,allowedSections=ui.item.data("allowed-sections");allowedSections&&(targetContext=$(this).closest("[data-grid-context]").data("grid-context"),allowedSections.split(",").includes(targetContext)||$(ui.sender).sortable("cancel")),vcfg.toggleDropMessage()},over:function(_,ui){var targetContext=$(this).closest("[data-grid-context]").data("grid-context"),allowedSections=ui.item.data("allowed-sections");allowedSections&&!allowedSections.split(",").includes(targetContext)&&ui.item.addClass("gv-field--not-allowed")},out:function(_,ui){ui.item.removeClass("gv-field--not-allowed")}}))},toggleDropMessage:function(){$(".active-drop").each(function(){0<$(this).find(".gv-fields").length?$(this).find(".drop-message").hide():$(this).find(".drop-message").fadeIn(100)})},removeField:function(e){e.preventDefault();var vcfg=viewConfiguration,area=$(e.currentTarget).parentsUntil(".active-drop").parent();vcfg.setUnsavedChanges(!0),e.altKey&&1<$(area).find(".gv-fields").length?vcfg.removeAllFields(e,area):$(e.currentTarget).parentsUntil(".gv-fields").parent().fadeOut("fast",function(){$(this).remove(),$(document.body).trigger("gravityview/field-removed",$(this)),vcfg.toggleDropMessage()})},removeAllFields:function(e,area){e.preventDefault(),window.confirm(gvGlobals.remove_all_fields)&&((area=area||null)||(area_id=$(e.originalEvent.target).data("areaid"),area=$(e.originalEvent.target).parents('div[data-areaid="'+area_id+'"]')[0]),$(area).find(".gv-fields").remove(),$(document.body).trigger("gravityview/all-fields-removed"),viewConfiguration.toggleDropMessage())},toggleRemoveAllFields:function(e,item){has_fields=!1,$(".active-drop:visible").each(function(index,item){has_fields=1<$(this).find(".gv-fields").length,$(".clear-all-fields",$(item).parents(".gv-droppable-area")).toggle(has_fields)})},openFieldSettings:function(e){e.preventDefault();var vcfg,$field=$(e.target).closest('[data-fieldid="search_bar"]');$field.length&&$(e.target).closest($field.find(".gv-dialog-options")).length||(vcfg=viewConfiguration,$field=$(e.currentTarget).is(".gv-fields")?$(e.currentTarget):$(e.currentTarget).parents(".gv-fields"),$(".gv-field-settings",$field).first().addClass("active"),vcfg.updateVisibilitySettings(e,!0),$(document.body).on("change",".gv-fields input[type=checkbox]",vcfg.updateVisibilitySettings),e=[{text:gvGlobals.label_close,class:"button button-link",click:function(){$(this).dialog("close")}}],($field=$field.find(".gv-dialog-options").first()).find(":input").one("change",function(){vcfg.setUnsavedChanges(!0)}),vcfg.showDialog($field,e))},updateVisibilitySettings:function(e,first_run){var vcfg=viewConfiguration,e=(first_run=first_run||!1,$(e.currentTarget).is(".gv-fields")?$(e.currentTarget):$(e.currentTarget).parents(".gv-fields"));$(".gv-setting-list",e).trigger("change"),$("input[type=checkbox]",e).attr("disabled",null),first_run||vcfg.setUnsavedChanges(!0)},toggleVisibility:function($checkbox,$toggled,first_run,inverse){$checkbox=$checkbox.is(":checked");(inverse?!$checkbox:$checkbox)?$toggled.parents(".gv-setting-container").fadeIn(0):$toggled.parents(".gv-setting-container").fadeOut(0)},processFormSubmit:function(e){var vcfg=viewConfiguration,templateId=vcfg._getTemplateId();return!!vcfg.validateSettingFields(e)&&(vcfg.startFreshStatus?(vcfg.createPresetForm(e,templateId),!1):(!vcfg.startFreshStatus||""===templateId)&&(vcfg.setUnsavedChanges(!1),vcfg.serializeForm(e)))},setUnsavedChanges(has_changes){viewConfiguration.hasUnsavedChanges=has_changes},serializeForm:function(e){var serialized_data,$fields,$post=$("#post");return!!$post.data("gv-valid")||(e.stopImmediatePropagation(),$post.data("gv-valid",!1),$post.data("gv-serialized")?serialized_data=$post.data("gv-serialized"):(serialized_data=($fields=$post.find("[name^=fields]").filter(":input")).serialize(),$fields.prop("disabled",!0),$post.data("gv-serialized",serialized_data)),$post.find("[name=gv_fields]").filter(":input").prop("disabled",!0),$post.append($("<input/>",{name:"gv_fields",value:serialized_data,type:"hidden"})),setTimeout(function(){$post.data("gv-valid",!0),"click"===e.type?$(e.target).trigger("click"):$post.trigger("submit")},101),!1)},validateSettingFields:function(e){var $metabox=viewGeneralSettings.metaboxObj,$invalidFields=$metabox.find("[name^=template_settings].gv-error").filter(function(){return"none"!==$(this).closest("tr.alternate").css("display")});if(!$invalidFields.length)return!0;e.stopImmediatePropagation(),e.preventDefault();e=$invalidFields.first().closest("div[role=tabpanel]").prop("id");return $metabox.find(".ui-tab[aria-controls="+e+"] a.nav-tab").trigger("click"),window.scrollTo({top:$metabox.offset().top,behavior:"smooth"}),!1},createPresetForm:function(e,templateId){var vcfg=viewConfiguration,$target=$(e.target),templateId=(e.stopPropagation(),{action:"gv_set_preset_form",template_id:templateId,nonce:gvGlobals.nonce});return $.ajax({type:"POST",url:ajaxurl,data:templateId,async:!1,success:function(response){"false"!==response&&"0"!==response?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.find("option:selected").removeAttr("selected").end().append(response),"click"===e.type?$target.trigger("click"):$("#post").trigger("submit")):$target.before('<div id="message" class="error below-h2"><p>'+gvGlobals.label_publisherror+"</p></div>")}}),!1}},viewGeneralSettings={templateId:null,metaboxObj:null,init:function(){viewGeneralSettings.metaboxObj=$("#gravityview_settings"),viewGeneralSettings.initTabs(),$("#gravityview_directory_template").on("change",viewGeneralSettings.updateSettingsDisplay),$(document.body).on("gravityview/settings/tab/enable",viewGeneralSettings.enableSettingTab).on("gravityview/settings/tab/disable",viewGeneralSettings.disableSettingTab)},refresh:function(){viewGeneralSettings.metaboxObj.trigger("change"),viewGeneralSettings.metaboxObj.tabs("destroy"),viewGeneralSettings.initTabs()},updateSettingsDisplay:function(){viewGeneralSettings.templateId=$(this).val(),$("tr[data-show-if]").each(viewGeneralSettings.toggleSetting)},toggleSetting:function(){var row=$(this),templates=row.attr("data-show-if");templates.length<1||!viewGeneralSettings.templateId||(0<viewGeneralSettings.templateId.length&&-1<templates.indexOf(viewGeneralSettings.templateId)?row.show():(row.find("select, input").val("").prop("checked",!1),row.hide()))},initTabs:function(){let cookie_key="gv-active-setting-tab-"+$("#post_ID").val(),active_settings_tab=$.cookie(cookie_key);!1===viewConfiguration.getCookieVal(active_settings_tab)&&(active_settings_tab=0),viewGeneralSettings.metaboxObj.insertAfter($("#gravityview_view_config")).tabs({active:active_settings_tab,create:function(event,ui){setTimeout(function(){viewConfiguration.setupCodeMirror(ui.panel)},50)},activate:function(event,ui){$.cookie(cookie_key,ui.newTab.index(),{path:gvGlobals.admin_cookiepath}),viewConfiguration.setupCodeMirror(ui.newPanel),viewConfiguration.zebraStripeSettings()}}).addClass("ui-tabs-vertical ui-helper-clearfix").find("li").removeClass("ui-corner-top")},tabsCreate:function(event,ui){var $panels=$(this).find(".ui-tabs-panel"),max=[];$panels.each(function(){max.push($(this).outerHeight(!0))}).css({"min-height":_.max(max)})},enableSettingTab:function(e,tab){viewGeneralSettings.metaboxObj.tabs("enable",$(tab).attr("id"))},disableSettingTab:function(e,tab){viewGeneralSettings.metaboxObj.tabs("disable",$(tab).attr("id"))}},jQuery(function($){$("#title-prompt-text").text(gvGlobals.label_viewname),viewGeneralSettings.init(),viewConfiguration.init(),$(".gv-datepicker").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1});var cookie_key="gv-active-tab-"+$("#post_ID").val(),activate_tab=$.cookie(cookie_key);!1===viewConfiguration.getCookieVal(activate_tab)&&(activate_tab=0),location.hash&&$(location.hash).length&&(activate_tab=$(location.hash).index()-1),$("#gv-view-configuration-tabs").tabs({active:activate_tab,hide:!1,show:!1,create:function(event,ui){viewConfiguration.init_droppables(ui.panel),$(document.body).trigger("gravityview/tab-ready",ui.panel).trigger("gravityview/tabs-ready")},activate:function(event,ui){$.cookie(cookie_key,ui.newTab.index(),{path:gvGlobals.cookiepath}),viewConfiguration.init_droppables(ui.newPanel),$(document.body).trigger("gravityview/tab-ready",ui.newPanel)}});let $embedShortcodeEl=$("#gv-embed-shortcode");$("#gravityview_se_is_secure").on("change",function(){let embedShortcode=$embedShortcodeEl.val();embedShortcode&&(embedShortcode=$(this).is(":checked")?embedShortcode.replace(/]$/,` secret="${$embedShortcodeEl.data("secret")}"]`):embedShortcode.replace(/ secret="[^"]+"/,""),$embedShortcodeEl.val(embedShortcode))}),window.gvAdminActions={initTooltips:viewConfiguration.init_tooltips,removeTooltips:viewConfiguration.remove_tooltips,showDialog:viewConfiguration.showDialog,initDroppables:viewConfiguration.init_droppables,setCustomLabel:viewConfiguration.setCustomLabel,ignoreEscape:viewConfiguration.ignoreEscape},$(document.body).trigger("gravityview/loaded")}),$(function(){let $csv_enable=$("#gravityview_se_csv_enable");function update_csv_widget_classes(){$('[data-fieldid="export_link"]').toggleClass("csv-disabled",!$csv_enable.is(":checked")).attr("aria-disabled",$csv_enable.is(":checked")?"false":"true")}$csv_enable.on("change",update_csv_widget_classes),update_csv_widget_classes()}),$(function(){let $spinner=$('<svg class="loading" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 6.47715 6.47715 2 12 2V5C8.13401 5 5 8.13401 5 12H2Z" fill="currentColor"></path></svg>');$(document).on("click",".gk-gravityview-placeholder-actions [data-action]",function(e){var payload;e.preventDefault(),viewConfiguration.hasUnsavedChanges&&!window.confirm(gvGlobals.discard_unsaved_changes)||$(this).hasClass("is-idle")||($(this).addClass("is-idle").html($spinner),e=$(this).data("action")+"_product",payload={text_domain:$(this).data("text-domain"),activate:!0},$.when(viewConfiguration.server_request(e,payload)).then(response=>{if(!response.success)throw new Error;document.location=document.location}).fail(()=>$(this).removeClass("is-idle").addClass("is-error").text("Try again")))})})}(jQuery);