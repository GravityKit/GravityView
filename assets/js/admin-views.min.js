/**
 * Custom js script at Add New / Edit Views screen
 *
 * @package   GravityView
 * @license   GPL2+
 * @author    GravityKit <hello@gravitykit.com>
 * @link      http://www.gravitykit.com
 * @copyright Copyright 2014, Katz Web Services, Inc.
 *
 * @since 1.0.0
 *
 * @typedef {{
*   passed_form_id: bool,
*   has_merge_tag_listener: bool,
*   label_cancel: string,
*   label_continue: string,
*   loading_text: string,
*   nonce: string,
*   label_close: string,
*   field_loaderror: string,
*   cookiepath: string,
*   label_viewname: string,
*   label_publisherror: string,
*   label_expand_dialog: string,
*   label_contract_dialog: string,
* }} gvGlobals
*
* @typedef {{
*  target: element,
*  relatedTarget: element,
*  which: number,
*  pageX: number,
*  pageY: number,
*  metaKey: string,
*  altKey: boolean,
*  cancelable: bool,
*  char: string,
*  charCode: number,
*  clientX: number,
*  clientY: number,
*  ctrlKey: bool,
*  currentTarget: element,
*  data: object,
*  keyCode: number,
*  namespace: string,
*  result: object,
*  type: string,
*  preventDefault: function,
*  stopImmediatePropagation: function
* }} jQueryEvent
*/
!function(e){var t,i;e.widget.bridge("gvTooltip",e.ui.tooltip);const a=e('<svg class="loading" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 6.47715 6.47715 2 12 2V5C8.13401 5 5 8.13401 5 12H2Z" fill="currentColor"></path></svg>'),o='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M2.2 7.2c.4 0 .7-.3.7-.7V6l-.2-2.1 1.6 1.7 2 2c.1.2.3.2.5.2.5 0 .8-.3.8-.8 0-.2 0-.4-.2-.5l-2-2-1.7-1.6h2.2c0 .1.5.1.5.1.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7H2.6c-.8 0-1.2.5-1.2 1.2v3.7c0 .4.3.7.8.7zm7.4 7.5h3.8c.8 0 1.2-.4 1.2-1.2V9.8c0-.4-.3-.7-.8-.7-.4 0-.7.3-.7.7v2.6c.1 0-1.5-1.7-1.5-1.7l-2-2c-.1-.1-.3-.2-.5-.2-.5 0-.8.3-.8.8s0 .4.2.5l2 2 1.7 1.6H10c0-.1-.5-.1-.5-.1-.4 0-.7.3-.7.7 0 .4.3.7.7.7z"/></svg>';t={startFreshStatus:!1,hasUnsavedChanges:!1,altKey:!1,dialogWidth:750,performingAjaxAction:!1,maxDialogWidth:.95,ignoreEscapeEvent:!1,init:function(){var i=t;i.gvSelectForm=e("#gravityview_form_id"),i.gvSwitchView=e("#gv_switch_view_button"),i.currentFormId=i.gvSelectForm.val(),i.currentDirectoryTemplate=e("#gravityview_directory_template").val(),i.currentSingletemplate=e("#gravityview_single_template").val(),i.directAccessSelect=e("#gv-direct-access-select"),i.toggleInitialVisibility(i),e(document.body).on("keydown keyup",i.altKeyListener).on("change","#gravityview_form_id",i.formChange).on("click",'a[href="#gv_start_fresh"]',i.startFresh).on("click","#publish, #save-post",i.processFormSubmit).on("submit","#post",i.processFormSubmit).on("click",".gv-view-types-hover",i.selectTemplateHover).on("click","a[rel*=external]",i.openExternalLinks).on("click mouseup keyup",i.closeTooltips).on("click",'.gv-field-filter-form span[role="button"]',i.switchTooltipLayout).on("click","#gv_switch_view_button",i.switchView).on("click",".clear-all-fields",i.removeAllFields).on("click",".gv_select_template",i.selectTemplate).on("change","select[data-view-dropdown]",i.selectTemplate).on("click",".ui-tooltip-content .gv-fields",i.startAddField).on("click",".gv-add-field-before",(function(){e(this).closest(".active-drop-container").find("a.gv-add-field").trigger("click",{before:e(this).closest(".gv-fields")})})).on("click",".gv-field-duplicate",i.duplicateField).on("click","#gv-direct-access .edit-direct-access",i.editDirectAccess).on("click","#gv-direct-access-select .cancel-direct-access",i.cancelDirectAccess).on("click","#gv-direct-access-select .save-direct-access",i.updateDirectAccess).on("gravityview_form_change",i.updateFormLinks).on("gravityview_form_change",i.updateWidgetFormIds).on("change",".gv-dialog-options input[name*=show_as_link]",i.toggleShowAsEntry).on("change",".gv-dialog-options input[name*=only_loggedin]",i.toggleCustomVisibility).on("change",".gv-dialog-options [name*=allow_edit_cap]",i.toggleCustomVisibility).on("change",".gv-dialog-options [name*=input_type]",i.toggleInputHidden).on("click",".gv-field-controls .gv-remove-field",i.removeField).on("click",".gv-field-controls .gv-field-settings",i.openFieldSettings).on("dblclick",".gv-fields:not(.gv-nonexistent-form-field) h5",i.openFieldSettings).on("change","#gravityview_settings",i.changedSettingsAction).on("click",'div[data-js="gform-simplebar"]',i.changedSettingsAction).on("click",".gv-field-details--toggle",(function(i){var a=e(this).parents(".ui-dialog"),o=e(".gv-field-details",a).hasClass("gv-field-details--closed");return t.toggleFieldDetails(a,o),e.cookie("gv-field-details-expanded",o,{path:gvGlobals.admin_cookiepath}),!1})).on("search keydown keyup",".gv-field-filter-form input:visible",i.setupFieldFilters).on("click",".gv-section .is-dismissible .notice-dismiss",(function(t){var i=e(this).parents(".gv-section").attr("id")+"-"+e("#post_ID").val();e.cookie("warning-dismissed-"+i,1,{path:gvGlobals.admin_cookiepath}),e(document.body).trigger("gravityview/tabs-ready")})).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry gravityview/view-config-updated",i.toggleTabConfigurationWarnings).on("gravityview/loaded gravityview/tabs-ready gravityview/field-added gravityview/field-removed gravityview/all-fields-removed gravityview/show-as-entry gravityview/view-config-updated",i.toggleRemoveAllFields).on("search keydown keyup",".gv-field-filter-form input:visible",i.setupFieldFilters).on("gravityview/loaded",(function(){e(".gv-setting-list, #gravityview_settings").on("change",i.toggleCheckboxes).trigger("change")})).on("change",".gv-dialog-options",i.toggleCheckboxes).on("focus",".gv-add-field",(function(t){e(this).parent(".gv-fields").addClass("trigger--hover")})).on("blur",".gv-add-field",(function(t){e(this).parent(".gv-fields").removeClass("trigger--hover")})).on("keydown",".gv-add-field",(function(t){if("Enter"!==t.key&&" "!==t.key&&13!==t.keyCode&&32!==t.keyCode)return!0;t.preventDefault(),e(this).parent(".gv-fields").addClass("trigger--active")})).on("keyup",".gv-add-field",(function(t){if("Enter"!==t.key&&" "!==t.key&&13!==t.keyCode&&32!==t.keyCode)return!0;t.preventDefault();const i=e(this);i.parent(".gv-fields").removeClass("trigger--active"),i.trigger("click")})).on("gravityview/dropdown/activate gravityview/dropdown/install",i.enableLockedTemplate).on("gravityview/dialog-opened",(function(t,a){const n=e(a).parent();if(!n.find(".gv-dialog-warning").length&&0===n.find(".gv-dialog-expand").length&&i.dialogWidth<e(window).width()*i.maxDialogWidth){const t=e("<button>",{class:"gv-dialog-expand ui-button","aria-label":gvGlobals.label_expand_dialog,"aria-expanded":"false","aria-controls":n.find(".ui-dialog-content").attr("id")||"dialog-content",title:gvGlobals.label_expand_dialog,html:'<span class="screen-reader-text">'+gvGlobals.label_expand_dialog+"</span>"+o});n.find(".ui-dialog-titlebar").append(t)}})).on("click",".gv-dialog-expand",(function(t){if("keydown"===t.type&&"Enter"!==t.key&&" "!==t.key)return;t.preventDefault();const i=e(this).closest(".ui-dialog"),a=e(this),n=i.hasClass("gv-dialog-expanded");i.toggleClass("gv-dialog-expanded"),a.attr({"aria-expanded":!n,"aria-label":n?gvGlobals.label_contract_dialog:gvGlobals.label_expand_dialog,title:n?gvGlobals.label_contract_dialog:gvGlobals.label_expand_dialog}).find(".screen-reader-text").text(n?gvGlobals.label_contract_dialog:gvGlobals.label_expand_dialog).end().find("svg").replaceWith(n?o:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6.9 2c-.4 0-.7.3-.7.7v.5l.2 2.1-1.6-1.7-2-2c-.1-.2-.3-.2-.5-.2-.5 0-.8.3-.8.8s0 .4.2.5l2 2 1.7 1.6H3.2c0-.1-.5-.1-.5-.1-.4 0-.7.3-.7.7s.3.7.7.7h3.8c.8 0 1.2-.5 1.2-1.2V2.7c0-.4-.3-.7-.8-.7zm6.5 6.4H9.6c-.8 0-1.2.5-1.2 1.2v3.7c0 .4.3.7.8.7s.7-.3.7-.7v-2.6c-.1 0 1.5 1.7 1.5 1.7l2 2c.1.2.3.2.5.2.5 0 .8-.3.8-.8s0-.4-.2-.5l-2-2-1.7-1.6H13c0 .1.5.1.5.1.4 0 .7-.3.7-.7s-.3-.7-.7-.7z"/></svg>'),e(window).trigger("resize")})).on("tooltipopen",i.onTooltipOpen).on("click",".gv-move-up",(function(t){var a=e(this);if(a.data("gv-skip-click"))return a.removeData("gv-skip-click"),t.preventDefault(),void t.stopPropagation();t.preventDefault(),t.stopPropagation(),i.moveField(a.closest(".gv-fields"),-1,"up",a)})).on("click",".gv-move-down",(function(t){var a=e(this);if(a.data("gv-skip-click"))return a.removeData("gv-skip-click"),t.preventDefault(),void t.stopPropagation();t.preventDefault(),t.stopPropagation(),i.moveField(a.closest(".gv-fields"),1,"down",a)})).on("keydown",".gv-field-reorder button",(function(t){var a=e(this),o=a.hasClass("gv-move-up");a.hasClass("gv-move-down");if(" "===t.key||32===t.keyCode||"Enter"===t.key||13===t.keyCode)return t.preventDefault(),t.stopPropagation(),a.data("gv-skip-click",!0),setTimeout((function(){a.removeData("gv-skip-click")}),250),void(o?i.moveField(a.closest(".gv-fields"),-1,"up",a):i.moveField(a.closest(".gv-fields"),1,"down",a));"ArrowUp"===t.key||38===t.keyCode?(t.preventDefault(),i.moveField(a.closest(".gv-fields"),-1,"up",a)):"ArrowDown"!==t.key&&40!==t.keyCode||(t.preventDefault(),i.moveField(a.closest(".gv-fields"),1,"down",a))})).on("keydown",".gv-fields",(function(t){"ArrowUp"===t.key||38===t.keyCode?(t.preventDefault(),i.moveField(e(this),-1,"up")):"ArrowDown"!==t.key&&40!==t.keyCode||(t.preventDefault(),i.moveField(e(this),1,"down"))})).on("focusin",".gv-fields",(function(){i.updateReorderButtons(e(this))})),e(window).on("resize",(function(){const t=e(".ui-dialog:visible").find(".ui-dialog-content");t.dialog("option","position",{my:"center",at:"center",collision:"fit",of:window,within:e("#wpwrap")}),t.dialog("option","width",i.getDialogWidth(t))})),window.addEventListener("beforeunload",(e=>{i.hasUnsavedChanges&&e.preventDefault()})),gvGlobals.passed_form_id&&i.gvSelectForm.trigger("change");var a=window.send_to_editor;window.send_to_editor=function(t){var i=e("#"+window.wpActiveEditor);if(!i.hasClass("codemirror")&&a)return a(t);var o=i.next(".CodeMirror")[0].CodeMirror,n=o.getCursor();o.replaceRange(t,window.wp.CodeMirror.Pos(n.line,n.ch))},e("div .gform-dropdown__trigger").on("click.gravityforms",i.sendMergeTagValueToCodemirrorEditor)},getDialogWidth:function(i){var a=t.dialogWidth;i.parents('[data-fieldid="search_bar"]').length>0&&(a=1200);let o=e(window).width()*t.maxDialogWidth;return a>o?o:a},getCookieVal:function(e){return!(!e||"undefined"===e||"false"===e)&&e},toggleTabConfigurationWarnings:function(i){const a={single:{configured:e(".gv-dialog-options input[name*=show_as_link]:checked","#directory-active-fields").length||e('[data-fieldid="entry_link"]',"#directory-active-fields").length,icon:"dashicons-media-default"},edit:{configured:e('.gv-fields .field-key[value="edit_link"]').length,icon:"dashicons-welcome-write-blog"}};e.each(a,(function(i,a){const o=i+"-fields-"+e("#post_ID").val(),n=t.getCookieVal(e.cookie("warning-dismissed-"+o)),r=e("#"+i+"-fields"),l=r.find(".active-drop .gv-fields").length,s=!n&&0===a.configured&&l>0;r.find(".notice-no-link").toggle(s),e('li[aria-controls="'+i+'-view"]').toggleClass("tab-not-configured",s).find(".tab-icon").toggleClass("dashicons-warning",s).toggleClass(a.icon,!s)}))},altKeyListener:function(e){t.altKey=e.altKey},changedSettingsAction:function(a){i.metaboxObj.find("[name^=template_settings]:visible").each((function(){t.validateField(e(this))})),t.zebraStripeSettings()},validateField:function(i){var a=i.data("rules");if(a){var o=t.validateValue(i.val(),a);i.toggleClass("gv-error",!!o),i.parent().find(".gv-error-message").remove(),o&&i.parent().append(e("<div>",{class:"gv-error-message",text:o}))}},validateValue(e,i){if(i){var a=t.getValidators();for(var o in i)if(i.hasOwnProperty(o)){var n=i[o],r=n.rule,l=n.message,s="",d=!0;if(r.includes(":")){var c=r.split(/:(.+)/);r=c[0],s=c[1]}if(a[r]&&(d=a[r](e,s)),!d)return l}}},getValidators:function(){return{required:function(e){return null!=e&&""!==e.toString().trim()},max:function(e,t){return null!=e&&Number(e)<=t},min:function(e,t){return null!=e&&Number(e)>=t},email:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},integer:function(e){return Number.isInteger?Number.isInteger(Number(e)):Number(e)%1==0},matches:function(e,t){return new RegExp(t).test(e)}}},zebraStripeSettings:function(){setTimeout((function(){i.metaboxObj.find("table").each((function(){var t=e(this).find("tr").filter(":visible");t.removeClass("alternate"),t.filter(":even").addClass("alternate")}))}),50)},toggleCheckboxes:function(i){var a=i.currentTarget?i.currentTarget:i;t.toggleRequired(a,"requires",!1),t.toggleRequired(a,"requires-not",!0);var o=e(a).is(".gv-fields")?e(a):e(a).parents(".gv-fields");o.length&&(t.toggleDisabled(e("input[type=checkbox][name*=link_to_]",o),e("input[type=checkbox][name*=show_as_link]",o)),t.toggleDisabled(e("input[type=checkbox][name*=link_phone]",o),e("input[type=checkbox][name*=show_as_link]",o)))},toggleDisabled:function(e,t){0!==e.length&&0!==t.length&&(e.is(":checked")?t.prop("disabled",!0):t.is(":checked")&&e.prop("disabled",!0))},toggleRequired:function(t,i,a){let o=e(t,"#post");o.find("[data-"+i+"]").each((function(){var t=e(this),n=t.data(i).split("="),r=n[0],l=n[1];const s=t.closest(".gv-dialog-options");s.length>0&&(o=s);const d=o.find('[name$="['+r+']"]').filter(":input");d.is("[type=checkbox]")?a?t.toggle(d.filter(":not(:checked)").filter(":not(:hidden)").length>0):t.toggle(d.is(":checked")):d.is("[type=radio]")?a?t.toggle(!d.filter('[value="'+l+'"]').is(":checked")):t.toggle(d.filter('[value="'+l+'"]').is(":checked")):void 0!==l&&(a?t.toggle(d.val()!==l):t.toggle(d.val()===l))}))},switchTooltipLayout:function(i){var a=e(this).data("value");t.setTooltipLayout(a)},setTooltipLayout:function(t){e(".gv-items-picker--"+t).addClass("active"),e(".gv-items-picker").not(".gv-items-picker--"+t).removeClass("active"),e(".gv-items-picker-container").attr("data-layout",t),e.cookie("gv-items-picker-layout",t,{path:gvGlobals.admin_cookiepath})},closeTooltips:function(i){var a=e("[data-tooltip='active']"),o=!1,n=!1;switch(i.type){case"keyup":if(27===i.keyCode){if(e(".ui-autocomplete").is(":visible"))return;if(t.ignoreEscapeEvent)return void(t.ignoreEscapeEvent=!1);n=o=0===e(".gv-field-filter-form input[data-has-search]:focus").length,window.Beacon&&window.Beacon("close")}((13===i.keyCode||32===i.keyCode)&&e(i.target).is(".close")||e(i.target).is(".dashicons-dismiss"))&&(o=!0);break;case"mouseup":e(i.target).closest(".ui-tooltip").length?o=!1:e(i.target).closest(".ui-dialog").length?a.length>0&&(o="tooltips"):a.length>0&&(o=!0),e(i.target).parents(".close").length&&(o=!0);break;case"click":e(i.target).is(".gv-overlay")&&(o=!0,n=!0,e(i.target).remove())}if(o&&(a.gvTooltip("close"),"tooltips"!==o&&e(".ui-dialog:visible").find(".ui-dialog-content").dialog("close"),n))return!1},toggleShowAsEntry:function(t){var i=e(t.target).parents(".gv-fields");i.toggleClass("has-single-entry-link",e(t.target).is(":checked")),i.find(".gv-field-controls .dashicons-media-default").toggleClass("hide-if-js",e(t.target).not(":checked")),e(document.body).trigger("gravityview/show-as-entry",e(t.target).is(":checked"))},toggleCustomVisibility:function(t){var i;i=e(t.target).is("select")?"read"!==e(t.target).val():e(t.target).is(":checked");const a=e(t.target).closest(".gv-dialog-options");let o;if(a.data("field"))o=a.data("field");else{const a=e(t.target).closest(".gv-fields");a.toggleClass("has-custom-visibility",i),o=a.find(".gv-field-controls")}o&&o.find(".icon-custom-visibility").toggleClass("hide-if-js",!i)},toggleInputHidden:function(t){const i="hidden"===e(t.target).val(),a=e(t.target).closest(".gv-dialog-options");let o;if(a.data("field"))o=a.data("field");else{const a=e(t.target).closest(".gv-fields");a.toggleClass("has-input-hidden",i),o=a.find(".gv-field-controls")}o&&o.find(".icon-hidden").toggleClass("hide-if-js",!i)},selectText:function(t){return t.preventDefault(),e(this).trigger("focus").trigger("select"),!1},editDirectAccess:function(i){var a=t;i.preventDefault(),a.directAccessSelect.is(":visible")||(a.directAccessSelect.slideDown("fast",(function(){a.directAccessSelect.find('input[type="radio"]').first().trigger("focus")})),e(this).hide())},cancelDirectAccess:function(i){t.directAccessSelect.slideUp("fast"),e("#gv-direct-access-display strong").text((function(){return e(this).data("initial-label")})),e("#gv-direct-access .edit-direct-access").show().trigger("focus"),i.preventDefault()},updateDirectAccess:function(i){let a=!1,o=t.directAccessSelect.find("input:radio:checked");t.directAccessSelect.slideUp("fast"),e("#gv-direct-access .edit-direct-access").show().trigger("focus"),a="embed"===o.val(),e("#gravityview_se_embed_only").prop("checked",a),e("#gv-direct-access-display strong").text(o.data("display-label")),e("#gv-direct-access").toggleClass("embed-only",a),i.preventDefault()},toggleInitialVisibility:function(t){0!==t.gvSelectForm.length&&(""===t.currentFormId?t.hideView():e("#gravityview_directory_template").length&&e("#gravityview_directory_template").val().length>0?(e("#gravityview_select_template").slideUp(150),t.showViewConfig()):(t.templateFilter("custom"),t.showViewTypeMetabox()),t.currentFormId&&!t.currentTemplateId&&t.gvSwitchView.hide(),t.togglePreviewButton(),t.zebraStripeSettings(!0))},togglePreviewButton:function(){var i=e("#preview-action").find(".button");""===t.gvSelectForm.val()?i.hide():i.show()},hideView:function(){var a=t;a.currentFormId="",a.togglePreviewButton(),e("#gravityview_view_config, #gravityview_select_template, #gravityview_sort_filter, .gv-form-links").hide(),i.metaboxObj.hide()},updateFormLinks:function(){var i=t;e(".gv-form-links a").each((function(){var t=e(this).attr("href").replace(/id=([0-9]+)/gm,"id="+i.gvSelectForm.val());e(this).attr("href",t)}))},updateWidgetFormIds:function(){var i=t;e(".field-form-id").each((function(){e(this).val(i.gvSelectForm.val())}))},toggleViewTypeMetabox:function(){var i=e("#gravityview_select_template"),a=t;i.is(":visible")?(a.gvSwitchView.text((function(){return e(this).attr("data-text-backup")})),a.currentDirectoryTemplate&&i.slideUp(150)):(a.currentDirectoryTemplate?a.gvSwitchView.attr("data-text-backup",(function(){return e(this).text()})).text(gvGlobals.label_cancel):a.gvSwitchView.hide(),i.slideDown(150))},showViewTypeMetabox:function(){e("#gravityview_select_template").slideDown(150)},startFresh:function(e){e.preventDefault();var i=t;i.startFreshStatus=!0,i.getConfiguredFields().length?i.showDialog("#gravityview_select_preset_dialog"):i.startFreshContinue()},startFreshContinue:function(){var i=t;e("#gravityview_form_id_start_fresh").val("1"),e("#gravityview_form_id").val(""),i.currentFormId="",i.currentTemplateId="",i.gvSwitchView.hide(),i.templateFilter("preset"),i.showViewTypeMetabox(),i.hideViewConfig(),i.togglePreviewButton()},formChange:function(e){e.preventDefault();var i=t;i.altKey||(i.startFreshStatus=!1,i.getConfiguredFields().length?i.showDialog("#gravityview_change_form_dialog"):i.formChangeContinue(),i.togglePreviewButton())},formChangeContinue:function(){var i=t;i.gvSelectForm.val()?(i.templateFilter("custom"),Promise.all([i.getAvailableFields(),i.getSortableFields()]).then((function(){i.currentFormId||i.currentDirectoryTemplate?(i.currentDirectoryTemplate&&i.currentDirectoryTemplate&&i.gvSwitchView.show(),i.gvSwitchView.click()):(i.showViewTypeMetabox(),i.gvSwitchView.fadeOut(150))}))):(i.getConfiguredFields().remove(),i.hideView(),i.gvSwitchView.fadeOut(150)),i.currentTemplateId="",i.currentFormId=i.gvSelectForm.val(),i.setUnsavedChanges(!0),e(document.body).trigger("gravityview_form_change").addClass("gv-form-changed")},showDialog:function(i,a){var o=t,n=e(i),r={text:gvGlobals.label_cancel,click:function(){n.is("#gravityview_change_form_dialog")?(o.startFreshStatus=!1,o.gvSelectForm.val(o.currentFormId)):n.is("#gravityview_switch_template_dialog")&&(o._isViewDropDown()||o.toggleViewTypeMetabox(),o.showViewConfig()),n.dialog("close")}},l={text:gvGlobals.label_continue,click:function(){n.is("#gravityview_change_form_dialog")||n.is("#gravityview_select_preset_dialog")?o.startFreshStatus?o.startFreshContinue():o.formChangeContinue():n.is("#gravityview_switch_template_dialog")&&(o.selectTemplateContinue(!1),o._isViewDropDown()||o.toggleViewTypeMetabox()),o._storeValue(),n.dialog("close")}};a=a||[r,l],n.dialog({dialogClass:"wp-dialog gv-dialog",appendTo:n.parent(),draggable:!1,resizable:!1,width:o.getDialogWidth(n),open:function(){return e('<div class="gv-overlay" />').prependTo("#wpwrap"),e(document.body).trigger("gravityview/dialog-opened",n),o.toggleCheckboxes(n),o.setupFieldDetails(n),o.refresh_merge_tags(n,(function(){o.setupCodeMirror(n)})),$sortableEls=e('.ui-widget-content[aria-hidden="false"]').find(".active-drop-widget, .active-drop-field"),$sortableEls.length&&$sortableEls.each(((t,i)=>{e(i).hasClass("ui-sortable")&&e(i).sortable("disable")})),!0},close:function(t){t.preventDefault(),e("textarea.code",n).each((function(){$CodeMirror=e(this).next(".CodeMirror"),0!==$CodeMirror.length&&$CodeMirror[0].hasOwnProperty("CodeMirror")&&$CodeMirror[0].CodeMirror.toTextArea()})),n.find(".merge-tag-support").removeClass("merge-tag-support").addClass("gv-merge-tag-support"),e(".gv-field-settings.active","#gravityview_view_config").removeClass("active"),o.setCustomLabel(n),e("#wpwrap").find("> .gv-overlay").fadeOut("fast",(function(){e(this).remove()})),$sortableEls=e('.ui-widget-content[aria-hidden="false"]').find(".active-drop-widget, .active-drop-field"),$sortableEls.length&&$sortableEls.each(((t,i)=>{e(i).hasClass("ui-sortable")&&e(i).sortable("enable")})),o._restoreValue(),e(document.body).trigger("gravityview/dialog-closed",n)},closeOnEscape:!0,buttons:a})},setupCodeMirror:function(i){var a=t;e("textarea.code:visible",i).each((function(){const t=e.extend(!0,{},wp.codeEditor.defaultSettings);let i=e(this).data("codemirror");i&&(t.codemirror=e.extend({},t.codemirror,i));let o=wp.codeEditor.initialize(e(this),t);if(e(this).hasClass("merge-tag-support")||e(this).hasClass("gv-merge-tag-support")){o.codemirror.setSize("95%");var n=e(this),r=n.attr("id"),l=window.gfMergeTags.getAutoCompleteMergeTags(n),s="",d=o.codemirror.getCursor();n.parent().find(".all-merge-tags").detach().insertBefore(n),n.parent().find("div .gform-dropdown__trigger").on("click.gravityforms",a.sendMergeTagValueToCodemirrorEditor),n.autocomplete({appendTo:n.parent(),minLength:1,position:{my:"center top",at:"center bottom",collision:"none"},source:l,select:function(e,t){var i=t.item.value.replace(/^{|}$/gm,""),a=o.codemirror.getCursor();o.codemirror.replaceRange(i,d,window.wp.CodeMirror.Pos(a.line,a.ch)),o.codemirror.focus(),o.codemirror.setCursor(window.wp.CodeMirror.Pos(a.line,a.ch+i.length+1))}});var c=n.parent().find("ul.ui-autocomplete"),g=function(){e("#"+r).autocomplete("close")};e(document.body).on("keyup",(function(e){c.is(":visible")&&27===e.which&&(e.preventDefault(),g(),n.trigger("focus"))})),o.codemirror.on("mousedown",(function(){g()})),o.codemirror.on("keydown",(function(e,t){c.is(":visible")&&(38!==t.which&&40!==t.which&&13!==t.which||(c.not(":focus")&&c.trigger("focus"),t.preventDefault()))})),o.codemirror.on("change",(function(t,i){"{}"===i.text[0]&&(d=o.codemirror.getCursor());var a=o.codemirror.getCursor();"{"!==(s=o.codemirror.getRange({ch:d.ch-1,line:d.line},a))[0]?g():e("#"+r).autocomplete("search",s)}))}}))},sendMergeTagValueToCodemirrorEditor:function(t){var i=window.wpActiveEditor;window.wpActiveEditor=e(t.currentTarget).parentsUntil(".gv-setting-container").find("textarea").attr("id"),window.wpActiveEditor&&window.send_to_editor(e(this).data("value")),window.wpActiveEditor=i},setupFieldDetails:function(i){if(!i.parents('[data-fieldid="search_bar"]').length){e(".gv-field-details--container",i).insertAfter(".ui-dialog-title:visible");var a=e.cookie("gv-field-details-expanded"),o=t.getCookieVal(a);t.toggleFieldDetails(i,o),t.migrateSurveyScore(i)}},migrateSurveyScore:function(e){if(0!==e.parents('[data-inputtype="survey"]').length){var t=e.find(".gv-setting-container-score input");t&&0!=1*t.val()&&e.find('.gv-setting-container-choice_display input[value="score"]').trigger("click").trigger("focus")}},toggleFieldDetails:function(e,t){$parent=e.parent(),$parent.find(".gv-field-details").toggleClass("gv-field-details--closed",!t).end().find(".gv-field-details--toggle .dashicons").toggleClass("dashicons-arrow-down",!!t).toggleClass("dashicons-arrow-right",!t).end()},setCustomLabel:function(t){var i,a=e("[name*=admin_label]",t);if(i=a.length&&a.val()?a:e("[name*=custom_label]",t),e(t).closest("[data-search-fields]").length===i.closest("[data-search-fields]").length){var o=t.closest(".gv-fields").find(".gv-field-label-text-container").first();if(i.length){var n=i.val().trim();n.length>0?o.html(n):o.html(o.parent(".gv-field-label").data("original-title"))}}},ignoreEscape:function(){t.ignoreEscapeEvent=!0},getSortableFields:function(i,a){return new Promise(((o,n)=>{var r=t;e(".gravityview_sort_field").prop("disabled","disabled").empty().append("<option>"+gvGlobals.loading_text+"</option>");var l={action:"gv_sortable_fields_form",nonce:gvGlobals.nonce};void 0!==i&&"preset"===i?l.template_id=a:l.form_id=r.gvSelectForm.val(),e.post(ajaxurl,l,(function(t){"false"!==t&&"0"!==t&&e(".gravityview_sort_field").empty().append(t).prop("disabled",null),o()}))}))},hideViewConfig:function(){e("#gravityview_view_config").slideUp(150),e(document).trigger("gv_admin_views_hideViewConfig")},showViewConfig:function(){e("#gravityview_view_config").slideDown(150),i.metaboxObj.show(),t.toggleDropMessage(),t.init_tooltips(),e(document).trigger("gv_admin_views_showViewConfig")},switchView:function(e){e.preventDefault(),e.stopImmediatePropagation();var i=t;i.templateFilter("custom"),i.toggleViewTypeMetabox()},templateFilter:function(t){e(".gv-view-types-module").each((function(){e(this).attr("data-filter")===t?e(this).parent().show():e(this).parent().hide()}))},_isViewDropDown:function(){return t.wantedTemplate&&void 0!==t.wantedTemplate.data("view-data")},_getCurrentTemplateId(){const e=this._getTemplateSection();return null===e||"directory"===e?this.currentDirectoryTemplate:"single"===e?this.currentSingletemplate:""},_setCurrentTemplateId(e){const t=this._getTemplateSection();null!==t&&"directory"!==t||(this.currentDirectoryTemplate=e),null!==t&&"single"!==t||(this.currentSingletemplate=e)},_getTemplateId:function(e=!1){const i=t.wantedTemplate;if(!i)return"";let a=i.data(e?"base-template":"templateid");return t._isViewDropDown()&&(a=t.wantedTemplate.val(),a=String(i.val())),a},_getTemplateSection:function(){let e=null;return t._isViewDropDown()&&(e=t.wantedTemplate.data("section")),e},_restoreValue:function(){t._isViewDropDown()&&t.wantedTemplate.data("view-data").restoreValue()},_storeValue:function(){t.wantedTemplate&&(t._isViewDropDown()?t.wantedTemplate.data("view-data").storeValue():e("select[data-view-dropdown]").each((function(){e(this).data("view-data").storeValue()})),this._setCurrentTemplateId(this._getTemplateId()))},selectTemplate:function(i,a){var o=t;if(void 0===a||null!==a.section){i.preventDefault(),i.stopImmediatePropagation(),o.wantedTemplate=e(this);var n=o._getTemplateId(),r=/(.*?)_(.*?)$/i,l=o._getCurrentTemplateId(),s=l.replace(r,"$2"),d=n.replace(r,"$2")===s;l&&!d&&o.getConfiguredFields().length?l!==n?o.getConfiguredFields().length?o.showDialog("#gravityview_switch_template_dialog"):(o.toggleViewTypeMetabox(),o.selectTemplateContinue(d)):(o.toggleViewTypeMetabox(),o.showViewConfig()):(e("#gravityview_select_template").slideUp(150),o.selectTemplateContinue(d),o._storeValue())}},selectTemplateContinue:function(i){var a=t,o=a._getTemplateId(),n=a.gvSelectForm.val(),r=!a._getTemplateSection();if(r){var l=a._getTemplateId();e("#gravityview_directory_template").val(l).trigger("change",{section:null}),e("#gravityview_single_template").val(l).trigger("change",{section:null})}var s=a.wantedTemplate.parents(".gv-view-types-module");s.parents(".gv-grid").find(".gv-view-types-module").removeClass("gv-selected"),s.addClass("gv-selected"),a.waiting("start"),a.startFreshStatus?Promise.all([a.getAvailableFields("preset",o),a.getPresetFields(o),a.getSortableFields("preset",o)]).then((function(){e(".ui-tabs-panel").each((function(){a.init_droppables(this)}))})):(!i||r?a.updateActiveAreas(o,1*n):a.waiting("stop"),r&&(a.gvSwitchView.fadeIn(150),a.toggleViewTypeMetabox())),a.currentTemplateId=o,a.setUnsavedChanges(!0)},server_request:(i,a)=>{const o=e.Deferred();t.performingAjaxAction=!0,e(".gv-view-template-notice").hide();const{_wpNonce:n,_wpAjaxAction:r,_wpAjaxUrl:l,ajaxRouter:s,frontendFoundationVersion:d}=window.gvGlobals.foundation_licenses_router,c={nonce:n,action:r,ajaxRouter:s,ajaxRoute:i,frontendFoundationVersion:d,payload:a};return e.post(l,c).fail((e=>o.reject(e.responseText))).done((e=>{e.success?(t.performingAjaxAction=!1,o.resolve(e)):o.reject(e.data)})),o.promise()},selectTemplateHover:function(i){const o=t,n=e(i.target),r=n.parents(".gv-view-types-module"),l=e(this).find(".gv_select_template");if(n.is("[rel=internal]")&&!n.hasClass("gv-layout-activate")&&!n.hasClass("gv-layout-install"))return!0;i.preventDefault(),i.stopImmediatePropagation();const s=t=>{e(".gv-view-template-notice").show().find("p").html(t),document.querySelector(".gv-view-template-notice").scrollIntoView({behavior:"smooth"})},d=()=>{o.performingAjaxAction=!1,n.removeClass("disabled"),r.removeClass("active")},c=()=>{r.find(".gv-view-types-hover > div:eq(0)").hide(),r.find(".gv-view-types-hover > div:eq(1)").removeClass("hidden"),r.removeClass("gv-view-template-placeholder"),r.find("a.gv_select_template").attr("data-templateid",n.data("templateid")).trigger("click"),o.activateViewSelection(n.data("templateid")),l.trigger("click")};if(n.hasClass("gv-layout-activate")){if(o.performingAjaxAction)return;return r.addClass("active"),n.addClass("disabled").attr("disabled",!0),n.html(a),void e.when(o.server_request("activate_product",{text_domain:n.attr("data-template-text-domain")})).then(c).always(d).fail(s)}if(n.hasClass("gv-layout-install")){if(o.performingAjaxAction)return;return r.addClass("active"),n.addClass("disabled").attr("disabled",!0),n.html(a),void e.when(o.server_request("install_product",{id:n.attr("data-download-id"),text_domain:n.attr("data-template-text-domain"),activate:!0})).then(c).always(d).fail(s)}},enableLockedTemplate:function(i,o){const n=e(o?.option)||null,r=o?.action||null,l={text_domain:n.data("template-text-domain"),activate:!0};if("{}"!==JSON.stringify(l)){const s=e(i.target),d=s.closest(".view-dropdown-list-item");s.addClass("is-idle").html(a),d.addClass("is-idle"),e.when(t.server_request(r+"_product",l)).then((()=>{s.removeClass("has-failed"),t.activateViewSelection(n.data("template-id")),o?.dropdown?.focusActive()})).fail((e=>{s.addClass("has-failed").text("Error"),console.log(e)})).always((()=>{s.removeClass("is-idle"),d.removeClass("is-idle")}))}},activateViewSelection:function(i){const a=e("[data-view-dropdown]"),o=a.find('option[data-template-id="'+i+'"]');o.attr("disabled",!1),o.val(i),a.each(((t,i)=>{e(i).viewDropdown().renderOptions()})),t.updateSettingsArea()},openExternalLinks:function(){return window.Beacon&&(e(this).is("[data-beacon-article]")||e(this).is("[data-beacon-article-modal]")||e(this).is("[data-beacon-article-sidebar]")||e(this).is("[data-beacon-article-inline]"))||window.open(this.href),!1},previewTemplate:function(i){i.preventDefault(),i.stopImmediatePropagation();var a=e(i.currentTarget).parents(".gv-view-types-module");a.find(".gv-template-preview").dialog({dialogClass:"wp-dialog gv-dialog",appendTo:e("#gravityview_select_template"),width:t.dialogWidth,open:function(){e('<div class="gv-overlay" />').prependTo("#wpwrap")},close:function(){e(this).dialog("option","appendTo",a),e("#wpwrap").find("> .gv-overlay").fadeOut("fast",(function(){e(this).remove()}))},closeOnEscape:!0,buttons:[{text:gvGlobals.label_close,click:function(){e(this).dialog("close")}}]})},updateActiveAreas:function(e,i){var a=t,o={action:"gv_get_active_areas",template_id:e,form_id:i,nonce:gvGlobals.nonce};return a.updateViewConfig(o)},updateSettingsArea:function(){const t=e("#gravityview_settings .inside");t.html(""),e.get(document.URL,(function(a){if(a){const o=e(a);t.html(o.find("#gravityview_settings .inside").html()),i.refresh(),e("#gravityview_directory_template").trigger("change")}}))},getPresetFields:function(i){var a=t;e("#directory-active-fields, #single-active-fields").children().remove();var o={action:"gv_get_preset_fields",template_id:i,nonce:gvGlobals.nonce};return a.updateViewConfig(o)},updateViewConfig:function(i){return new Promise(((a,o)=>{const n=t,r=n._getTemplateSection(),l="directory"===r||null===r,s="single"===r||null===r;l&&e("#directory-active-fields").children().remove(),s&&e("#single-active-fields").children().remove(),e.post(ajaxurl,i,(function(t){if(t){var o=JSON.parse(t);l&&(e("#directory-header-widgets").html(o.header),e("#directory-footer-widgets").html(o.footer),e("#directory-active-fields").append(o.directory),e("#directory-header-widgets a[data-templateid], #directory-footer-widgets a[data-templateid]").attr("data-templateid",i.template_id).attr("data-formid",i.form_id)),s&&e("#single-active-fields").append(o.single),n.showViewConfig(),n.waiting("stop"),e(document.body).trigger("gravityview/view-config-updated",o,r)}a()})),n.setUnsavedChanges(!0)}))},waiting:function(t){$containers=e("#wpwrap,.gv-fields"),"start"===t?$containers.addClass("gv-wait"):$containers.removeClass("gv-wait")},remove_tooltips:function(t){e(t||".gv-add-field").is(":ui-tooltip")&&e(".gv-add-field").gvTooltip("destroy").off("click")},init_tooltips:function(i){0!==e(i||".gv-add-field","#post").not(":ui-tooltip").length&&e(i||".gv-add-field","#post").gvTooltip({show:150,hide:200,content:function(){var t=e(this).attr("data-context"),i=e(this).attr("data-formid")||e("#gravityview_form_id").val(),a=e("#gravityview_directory_template").val();switch(e(this).attr("data-objecttype")){case"search":case"field":return e("#"+t+"-available-fields-"+(i||a)).html();case"widget":return e("#directory-available-widgets").html()}},close:function(){e(this).attr("data-tooltip",null)},open:function(i,a){e(this).attr("data-tooltip","active").attr("data-tooltip-id",e(this).attr("aria-describedby"));let o=e("input[type=search]",a.tooltip);o.length||(o=e(a.tooltip).find(".close").first());var n="list";if(e(a).find(".gv-items-picker-container[data-layout]").length)n=e(a).find(".gv-items-picker-container[data-layout]").attr("data-layout");else{const i=e.cookie("gv-items-picker-layout");t.getCookieVal(i)&&(n=i)}t.setTooltipLayout(n),o[0].focus({preventScroll:!0});const r=o[0].getBoundingClientRect();(r.y<0||r.y>document.body.getBoundingClientRect().height)&&window.scrollTo({left:window.scrollX,top:window.scrollY+r.y+(r.y<0?-60:60),behavior:"smooth"})},disabled:!0,position:{my:"center bottom",at:"center top-12"},tooltipClass:"gravityview-item-picker-tooltip top"}).attr("title",(function(){return e(this).attr("title")||e(this).data("title")||""})).on("mouseout focusout",(e=>e.stopImmediatePropagation())).on("click",(function(t,i){e(this).attr("title",""),e(this).data("before",null),i?.before&&e(this).data("before",i.before),t.preventDefault(),e(this).gvTooltip("open")}))},setupFieldFilters:function(t){var i=function(e){return"string"!=typeof e?"":e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},a=e(this).val().trim(),o=e(this).parents(".ui-tooltip-content"),n=o.find(".gv-no-results");"keydown"!==t.type?(o.find(".gv-fields").show().filter((function(){var t=i(a),o=e(this).find(".gv-field-label").attr("data-original-title")||"",n=e(this).attr("data-fieldid")||"",r=e(this).attr("data-parent-label")||"",l=""===t||-1!==i(o).indexOf(t),s=""===t||-1!==i(n).indexOf(t),d=""===t||r&&-1!==i(r).indexOf(t);return!(l||s||d)})).hide(),o.find(".gv-fields:visible").length?n.hide():n.show()):e(this).attr("data-has-search",a.length>0?a.length:null)},refreshGFtooltips:function(){e(".gf_tooltip").gvTooltip({show:500,hide:1e3,content:function(){return e(this).prop("title")}})},getConfiguredFields:function(){const i=t._getTemplateSection(),a={directory:"#directory-active-fields",single:"#single-active-fields"},o=a.hasOwnProperty(i)?a[i]:"#directory-active-fields, #single-active-fields, #edit-active-fields";return e(o).find(".gv-fields")},getAvailableFields:function(i,a){return new Promise(((o,n)=>{var r=t;r.toggleDropMessage(),r.getConfiguredFields().remove();var l={action:"gv_available_fields",nonce:gvGlobals.nonce};l.form_preset_ids=void 0!==i&&"preset"===i?[a]:[r.gvSelectForm.val()],e("#directory-available-fields-"+l.form_preset_ids[0]).length||e.post(ajaxurl,l,(function(t){t.success||t.data||o(),e.each(t.data,(function(t,i){e("#"+t+"-fields").append(i)})),o()}))}))},startAddField:function(i){e(this).has(".field-id-all-fields").length?t.addAllFields(e(this)):t.addField(e(this),i)},addAllFields:function(t){const i=t.siblings(".gv-fields").filter((function(){const t=e(this).data("fieldid");return+t===parseInt(t,10)})),a=t=>new Promise(((i,a)=>{e(document.body).one("gravityview/field-added",(function(){i()})),e(t).trigger("click")}));!async function(){for(let e=0;e<i.length;e++)await a(i[e]);e("a.gv-add-field[data-tooltip='active']").gvTooltip("close")}()},addField:function(i,a){a.preventDefault();const o=i.closest(".ui-tooltip").attr("id"),n=e('.gv-add-field[data-tooltip-id="'+o+'"]'),r=n.data("before");t.placeField(i,n,r,!!r),t.toggleAllowedOnceField(i)},placeField:function(i,a,o,n=!1){const r=t,l=i.clone().hide(),s={action:"gv_field_options",template:a.attr("data-templateid")??a.parents(".gv-section").find(".view-template-select select").val()??e("#gravityview_directory_template").val(),area:a.attr("data-areaid"),context:a.attr("data-context"),field_id:l.attr("data-fieldid"),field_label:l.find(".gv-field-label").attr("data-original-title"),field_type:a.attr("data-objecttype"),input_type:l.attr("data-inputtype"),form_id:parseInt(i.attr("data-formid"),10)||r.currentFormId,nonce:gvGlobals.nonce};e.ajax({type:"POST",url:ajaxurl,data:s,async:!0,beforeSend:function(){r.disable_publish()},complete:function(){r.enable_publish()}}).done((function(t){const s=/[^\[]+\[[^\]]+\]\[([^\]]+)\].*/i;if(i.find("input.field-key").length>0){l.find(".gv-dialog, .gv-dialog-options").remove();const a=i.find("input.field-key").attr("name").replace(s,"$1"),o=t.match(s,"$1")[1]??null;t=e(t),i.find(".gv-dialog-options :input").each((function(i,n){if(!e(n).attr("name"))return;const r=t.find('[name="'+e(n).attr("name").replaceAll(""+a,""+o)+'"]');1===r.length?r.val(e(n).val()):2===r.length&&e(n).is(":checked")&&r.prop("checked",!0)}))}if(l.append(t),e(".ui-tabs-panel").each((function(){r.init_droppables(this)})),e(".gv-dialog-options",l).length>0&&e(".gv-field-settings",l).removeClass("hide-if-js"),o){l[n?"insertBefore":"insertAfter"](o)}else a.closest(".gv-droppable-area").find(".active-drop").first().append(l);e(document.body).trigger("gravityview/field-added",l),l.fadeIn(100),r.refreshGFtooltips()})).fail((function(e){r.enable_publish(),alert(gvGlobals.field_loaderror),console.log(e)})).always((function(){r.toggleDropMessage(),r.setUnsavedChanges(!0)}))},duplicateField:function(i){i.preventDefault();const a=e(this).closest(".gv-fields");t.placeField(a,e(this).closest(".active-drop-container").find("a.gv-add-field"),a)},onTooltipOpen:function(e,i){t.filterFields(e.target,i.tooltip[0])},toggleAllowedOnceField:function(t,i=!0){e(t).is('[data-allowed-once="true"]')||(t=e(t).closest('[data-allowed-once="true"]')),e(t).toggleClass("gv-field--is-added",i)},filterFields:function(i,a){const o=e(i).closest(".gv-section").find("[data-fieldid]").map(((t,i)=>e(i).data("fieldid"))).toArray();let n=e(a).html();if(!n)return;const r=e("<div>").html(n);r.find('[data-allowed-once="true"]').each(((i,a)=>{const n=o.indexOf(e(a).data("fieldid"))>-1;t.toggleAllowedOnceField(a,n)})),n=r.html(),e(a).html(n)},refresh_merge_tags:function(t,i){let a=t?e(".gv-merge-tag-support,.merge-tag-support",t):e(".gv-merge-tag-support:visible");if(a.removeClass("gv-merge-tag-support mt-initialized").addClass("merge-tag-support"),window.gform?.instances?.mergeTags)return e(".all-merge-tags",t).remove(),document.dispatchEvent(new Event("DOMContentLoaded")),void setTimeout((function(){a.removeClass("merge-tag-support").addClass("gv-merge-tag-support"),i&&i()}),300);"undefined"!=typeof form&&e(document.body).not(".gv-form-changed")&&a.length>=0&&(window.gfMergeTags&&(e(".all-merge-tags:visible").remove(),gfMergeTags.hasOwnProperty("destroy")?a.each((function(){new gfMergeTagsObj(form,e(this))})):window.gfMergeTags=new gfMergeTagsObj(form)),a.removeClass("merge-tag-support").addClass("gv-merge-tag-support"),i&&i())},enable_publish:function(){e(document).trigger("autosave-enable-buttons.edit-post"),e("#publishing-action").find("#publish").prop("disabled",null).removeClass("button-primary-disabled")},disable_publish:function(){e(document).trigger("autosave-disable-buttons.edit-post"),e("#publishing-action").find("#publish").prop("disabled","disabled").addClass("button-primary-disabled")},init_droppables:function(i){if(!e(i).find(".active-drop-field").sortable("instance")){var a=t;e(i).find(".active-drop-widget").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-widget",start:function(t,i){e("#directory-fields, #single-fields").find(".active-drop-container-widget").addClass("is-receivable")},keyboardMoveField:function(i,a,o,n){if(i&&0!==i.length){var r=i.closest(".active-drop-field, .active-drop-widget, .active-drop-search");if(0!==r.length){var l=r.children(".gv-fields"),s=l.index(i);if(-1!==s){var d=s+(a<0?-1:1);if(!(d<0||d>=l.length)){var c=e(document.activeElement),g=e.contains(i[0],c[0]);a<0?i.prev(".gv-fields").before(i):i.next(".gv-fields").after(i),t.setUnsavedChanges(!0),t.updateReorderButtonsState(i),t.announceReorder(i),setTimeout((function(){var t,a;if(n&&n.length&&n.is(":visible"))n.trigger("focus");else if(t="up"===o?".gv-move-up":".gv-move-down",(a=i.find(t).filter(":visible")).length||(t="up"===o?".gv-move-down":".gv-move-up",a=i.find(t).filter(":visible")),!a.length||(a.trigger("focus"),0))if(g&&c&&c.length&&e.contains(i[0],c[0]))c.trigger("focus");else{var r=i.find('.gv-move-up:visible, .gv-move-down:visible, button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').filter(":visible").first();r.length&&r.trigger("focus")}}),0)}}}}},updateReorderButtonsState:function(e){if(e&&0!==e.length){var t=e.closest(".active-drop-field, .active-drop-widget, .active-drop-search").children(".gv-fields"),i=t.index(e),a=e.find(".gv-move-up"),o=e.find(".gv-move-down"),n=i<=0,r=i===t.length-1;a.attr("aria-hidden",n?"true":"false").toggle(!n),o.attr("aria-hidden",r?"true":"false").toggle(!r)}},announceReorder:function(t){try{var i=t.closest(".active-drop-field, .active-drop-widget, .active-drop-search").children(".gv-fields"),a=i.index(t),o="gv-reorder-status",n=e("#"+o);0===n.length&&(n=e("<div/>",{id:o,class:"screen-reader-text","aria-live":"polite",role:"status"}).appendTo(document.body));var r=a+1;n.text("Moved to position "+r+" of "+i.length+".")}catch(e){}},stop:function(t,i){e("#directory-fields, #single-fields").find(".active-drop-container-widget").removeClass("is-receivable")},change:function(e,t){a.setUnsavedChanges(!0)},receive:function(t,i){var o=i.sender.attr("data-areaid"),n=e(this).attr("data-areaid");i.item.find('[name^="widgets['+o+']"]').each((function(){var t=e(this).attr("name");e(this).attr("name",t.replace(o,n))})),a.toggleDropMessage()}}),e(i).find(".active-drop-field").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-field",start:function(t,i){e(document.body).find(".active-drop-container-field").addClass("is-receivable")},stop:function(t,i){e(document.body).find(".active-drop-container-field").removeClass("is-receivable")},change:function(e,t){a.setUnsavedChanges(!0)},receive:function(t,i){if(i.item.find(".gv-dialog-options").length>0){var o=i.sender.attr("data-areaid"),n=e(this).attr("data-areaid");i.item.find('[name^="fields['+o+']"]').each((function(){var t=e(this).attr("name");e(this).attr("name",t.replace(o,n))}))}a.toggleDropMessage()}}),e(i).find(".active-drop-search").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-search",start:function(t,i){const a=i.item.data("allowed-sections");let o=e(document.body).find(".active-drop-container-search");if(a){const t=a.split(",");o=o.filter((function(){return t.indexOf(e(this).closest("[data-grid-context]").data("grid-context"))>-1}))}o.addClass("is-receivable")},stop:function(t,i){e(document.body).find(".active-drop-container-search").removeClass("is-receivable")},change:function(){a.setUnsavedChanges(!0)},receive:function(t,i){if(i.item.find(".gv-dialog-options").length>0){const t=i.sender.attr("data-areaid"),a=e(this).attr("data-areaid");i.item.find('[name*="['+t+']"]').each((function(){const i=e(this).attr("name");e(this).attr("name",i.replace(t,a))}))}const o=i.item.data("allowed-sections");if(o){const t=e(this).closest("[data-grid-context]").data("grid-context");o.split(",").includes(t)||e(i.sender).sortable("cancel")}a.toggleDropMessage()},over:function(t,i){const a=e(this).closest("[data-grid-context]").data("grid-context"),o=i.item.data("allowed-sections");if(o){o.split(",").includes(a)||i.item.addClass("gv-field--not-allowed")}},out:function(e,t){t.item.removeClass("gv-field--not-allowed")}})}},toggleDropMessage:function(){e(".active-drop").each((function(){e(this).find(".gv-fields").length>0?e(this).find(".drop-message").hide():e(this).find(".drop-message").fadeIn(100)}))},removeField:function(i){i.preventDefault();var a=t,o=e(i.currentTarget).parentsUntil(".active-drop").parent();a.setUnsavedChanges(!0),i.altKey&&e(o).find(".gv-fields").length>1?a.removeAllFields(i,o):e(i.currentTarget).parentsUntil(".gv-fields").parent().fadeOut("fast",(function(){e(this).remove(),e(document.body).trigger("gravityview/field-removed",e(this)),a.toggleDropMessage()}))},removeAllFields:function(i,a){i.preventDefault(),window.confirm(gvGlobals.remove_all_fields)&&((a=a||null)||(area_id=e(i.originalEvent.target).data("areaid"),a=e(i.originalEvent.target).parents('div[data-areaid="'+area_id+'"]')[0]),e(a).find(".gv-fields").remove(),e(document.body).trigger("gravityview/all-fields-removed"),t.toggleDropMessage())},toggleRemoveAllFields:function(){let t=!1;e(".active-drop:visible").each((function(i,a){t=e(this).find(".gv-fields").length>1,e(".clear-all-fields",e(a).parents(".gv-droppable-area")).toggleClass("gv-hide",!t)}))},openFieldSettings:function(i){i.preventDefault();const a=e(i.target).closest('[data-fieldid="search_bar"]');if(a.length&&e(i.target).closest(a.find(".gv-dialog-options")).length)return;var o,n=t;o=e(i.currentTarget).is(".gv-fields")?e(i.currentTarget):e(i.currentTarget).parents(".gv-fields"),e(".gv-field-settings",o).first().addClass("active"),n.updateVisibilitySettings(i,!0),e(document.body).on("change",".gv-fields input[type=checkbox]",n.updateVisibilitySettings);var r=[{text:gvGlobals.label_close,class:"button button-link",click:function(){e(this).dialog("close")}}];const l=o.find(".gv-dialog-options").first();l.find(":input").one("change",(function(){n.setUnsavedChanges(!0)})),n.showDialog(l,r)},updateVisibilitySettings:function(i,a){var o=t;a=a||!1;var n=e(i.currentTarget).is(".gv-fields")?e(i.currentTarget):e(i.currentTarget).parents(".gv-fields");e(".gv-setting-list",n).trigger("change"),e("input[type=checkbox]",n).attr("disabled",null),a||o.setUnsavedChanges(!0)},toggleVisibility:function(e,t,i,a){var o=e.is(":checked");(o=a?!o:o)?t.parents(".gv-setting-container").fadeIn(0):t.parents(".gv-setting-container").fadeOut(0)},processFormSubmit:function(e){var i=t,a=i._getTemplateId();return!!i.validateSettingFields(e)&&(i.startFreshStatus?(i.createPresetForm(e,a),!1):(!i.startFreshStatus||""===a)&&(i.setUnsavedChanges(!1),i.serializeForm(e)))},setUnsavedChanges(e){t.hasUnsavedChanges=e},serializeForm:function(t){var i,a,o=e("#post");return!!o.data("gv-valid")||(t.stopImmediatePropagation(),o.data("gv-valid",!1),o.data("gv-serialized")?i=o.data("gv-serialized"):(i=(a=o.find("[name^=fields]").filter(":input")).serialize(),a.prop("disabled",!0),o.data("gv-serialized",i)),o.find("[name=gv_fields]").filter(":input").prop("disabled",!0),o.append(e("<input/>",{name:"gv_fields",value:i,type:"hidden"})),setTimeout((function(){o.data("gv-valid",!0),"click"===t.type?e(t.target).trigger("click"):o.trigger("submit")}),101),!1)},validateSettingFields:function(t){var a=i.metaboxObj,o=a.find("[name^=template_settings].gv-error").filter((function(){return"none"!==e(this).closest("tr.alternate").css("display")}));if(!o.length)return!0;t.stopImmediatePropagation(),t.preventDefault();var n=o.first().closest("div[role=tabpanel]").prop("id");return a.find(".ui-tab[aria-controls="+n+"] a.nav-tab").trigger("click"),window.scrollTo({top:a.offset().top,behavior:"smooth"}),!1},createPresetForm:function(i,a){var o=t,n=e(i.target);i.stopPropagation();var r={action:"gv_set_preset_form",template_id:a,nonce:gvGlobals.nonce};return e.ajax({type:"POST",url:ajaxurl,data:r,async:!1,success:function(t){"false"!==t&&"0"!==t?(o.startFreshStatus=!1,o.gvSelectForm.find("option:selected").removeAttr("selected").end().append(t),"click"===i.type?n.trigger("click"):e("#post").trigger("submit")):n.before('<div id="message" class="error below-h2"><p>'+gvGlobals.label_publisherror+"</p></div>")}}),!1},getFieldContainer:function(e){return e.closest(".active-drop-field, .active-drop-widget, .active-drop-search")},updateReorderButtons:function(e){var i=t.getFieldContainer(e).children(".gv-fields"),a=i.index(e),o=e.find(".gv-move-up"),n=e.find(".gv-move-down"),r=a<=0,l=a===i.length-1;o.attr("aria-hidden",r?"true":"false").toggle(!r),n.attr("aria-hidden",l?"true":"false").toggle(!l)},announceFieldMove:function(i){try{var a=t.getFieldContainer(i).children(".gv-fields"),o=a.index(i),n=e("#gv-reorder-status");0===n.length&&(n=e("<div/>",{id:"gv-reorder-status",class:"screen-reader-text","aria-live":"polite",role:"status"}).appendTo(document.body)),n.text("Moved to position "+(o+1)+" of "+a.length+".")}catch(e){}},ensureFocus:function(e){if(!e||!e.length)return!1;var t=0,i=function(){if(t++,!e.is(":visible"))return t<5?setTimeout(i,0):void 0;try{e[0].focus({preventScroll:!0})}catch(t){e.trigger("focus")}!(document.activeElement===e[0])&&t<5&&setTimeout(i,0)};return i(),!0},focusFieldContainer:function(e){if(e&&e.length)try{e.attr("tabindex","-1"),e[0].focus({preventScroll:!0}),setTimeout((function(){e.removeAttr("tabindex")}),250)}catch(e){}},focusReorderControl:function(e,t){var i="up"===t?".gv-move-up":".gv-move-down",a=e.find(i).filter(":visible");return a.length||(i="up"===t?".gv-move-down":".gv-move-up",a=e.find(i).filter(":visible")),!!a.length&&(a.trigger("focus"),!0)},moveField:function(i,a,o,n){var r=t;if(i&&i.length){var l=r.getFieldContainer(i);if(l.length){var s=l.children(".gv-fields"),d=s.index(i)+(a<0?-1:1);if(!(d<0||d>=s.length)){var c=e(document.activeElement),g=e.contains(i[0],c[0]);a<0?i.prev(".gv-fields").before(i):i.next(".gv-fields").after(i),r.setUnsavedChanges(!0),setTimeout((function(){if(r.focusFieldContainer(i),r.updateReorderButtons(i),r.announceFieldMove(i),n&&n.length&&n.is(":visible"))r.ensureFocus(n);else if(!r.focusReorderControl(i,o))if(g&&c&&c.length&&e.contains(i[0],c[0]))r.ensureFocus(c);else{var t=i.find('.gv-move-up:visible, .gv-move-down:visible, button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])').filter(":visible").first();t.length&&r.ensureFocus(t)}}),0)}}}}},i={templateId:null,metaboxObj:null,init:function(){i.metaboxObj=e("#gravityview_settings"),i.initTabs(),e("#gravityview_directory_template").on("change",i.updateSettingsDisplay),e(document.body).on("gravityview/settings/tab/enable",i.enableSettingTab).on("gravityview/settings/tab/disable",i.disableSettingTab)},refresh:function(){i.metaboxObj.trigger("change"),i.metaboxObj.tabs("destroy"),i.initTabs()},updateSettingsDisplay:function(){i.templateId=e(this).val(),e("tr[data-show-if]").each(i.toggleSetting)},toggleSetting:function(){var t=e(this),a=t.attr("data-show-if");a.length<1||!i.templateId||(i.templateId.length>0&&a.indexOf(i.templateId)>-1?t.show():(t.find("select, input").val("").prop("checked",!1),t.hide()))},initTabs:function(){let a="gv-active-setting-tab-"+e("#post_ID").val(),o=e.cookie(a);!1===t.getCookieVal(o)&&(o=0),i.metaboxObj.insertAfter(e("#gravityview_view_config")).tabs({active:o,create:function(e,i){setTimeout((function(){t.setupCodeMirror(i.panel)}),50)},activate:function(i,o){e.cookie(a,o.newTab.index(),{path:gvGlobals.admin_cookiepath}),t.setupCodeMirror(o.newPanel),t.zebraStripeSettings()}}).addClass("ui-tabs-vertical ui-helper-clearfix").find("li").removeClass("ui-corner-top")},tabsCreate:function(t,i){var a=e(this).find(".ui-tabs-panel"),o=[];a.each((function(){o.push(e(this).outerHeight(!0))})).css({"min-height":_.max(o)})},enableSettingTab:function(t,a){i.metaboxObj.tabs("enable",e(a).attr("id"))},disableSettingTab:function(t,a){i.metaboxObj.tabs("disable",e(a).attr("id"))}},jQuery((function(e){e("#title-prompt-text").text(gvGlobals.label_viewname),i.init(),t.init(),e(".gv-datepicker").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1});var a="gv-active-tab-"+e("#post_ID").val(),o=e.cookie(a);!1===t.getCookieVal(o)&&(o=0),location.hash&&e(location.hash).length&&(o=e(location.hash).index()-1),e("#gv-view-configuration-tabs").tabs({active:o,hide:!1,show:!1,create:function(i,a){t.init_droppables(a.panel),e(document.body).trigger("gravityview/tab-ready",a.panel).trigger("gravityview/tabs-ready")},activate:function(i,o){e.cookie(a,o.newTab.index(),{path:gvGlobals.cookiepath}),t.init_droppables(o.newPanel),e(document.body).trigger("gravityview/tab-ready",o.newPanel)}});const n=e("#gv-embed-shortcode");e("#gravityview_se_is_secure").on("change",(function(){let t=n.val();t&&(t=e(this).is(":checked")?t.replace(/]$/,` secret="${n.data("secret")}"]`):t.replace(/ secret="[^"]+"/,""),n.val(t))})),window.gvAdminActions={initTooltips:t.init_tooltips,removeTooltips:t.remove_tooltips,showDialog:t.showDialog,initDroppables:t.init_droppables,setCustomLabel:t.setCustomLabel,ignoreEscape:t.ignoreEscape},e(document.body).trigger("gravityview/loaded")})),e((function(){const t=e("#gravityview_se_csv_enable"),i=function(){e('[data-fieldid="export_link"]').toggleClass("csv-disabled",!t.is(":checked")).attr("aria-disabled",t.is(":checked")?"false":"true")};t.on("change",i),i()})),e((function(){const i=e('<svg class="loading" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 6.47715 6.47715 2 12 2V5C8.13401 5 5 8.13401 5 12H2Z" fill="currentColor"></path></svg>');e(document).on("click",".gk-gravityview-placeholder-actions [data-action]",(function(a){if(a.preventDefault(),t.hasUnsavedChanges&&!window.confirm(gvGlobals.discard_unsaved_changes))return;if(e(this).hasClass("is-idle"))return;e(this).addClass("is-idle").html(i);const o=e(this).data("action")+"_product",n={text_domain:e(this).data("text-domain"),activate:!0};e.when(t.server_request(o,n)).then((e=>{if(!e.success)throw new Error;document.location=document.location})).fail((()=>e(this).removeClass("is-idle").addClass("is-error").text("Try again")))}))}))}(jQuery);