!function($){"use strict";function ViewDropDown(el){this.initialized=!1,this.$el=$(el),this.open=!1,this.init(),this.renderOptions(),this.refresh()}ViewDropDown.prototype.init=function(){var $el,dropdown;this.initialized||($el=this.$el,(dropdown=this).storeValue(),$el.hide(),$el.wrap($('<div class="view-dropdown"></div>')),this.$wrapper=$el.closest("div.view-dropdown"),this.$options_wrapper=$(' <div class="view-dropdown-options"></div>'),this.$wrapper.append(this.$options_wrapper),this.$el.data("scope")&&this.$options_wrapper.append($('<div class="view-dropdown-options__header"><span>'+this.$el.data("scope")+" â€” "+this.$el.data("label")+"</span></div>")),this.$options_list=$('<div class="view-dropdown-list"></div>'),this.$options_wrapper.append($('<div class="view-dropdown-options__body"></div>').append(this.$options_list)),this.$options_wrapper.append($('<div class="view-dropdown-options__footer">\t<a target="_blank" href="#">Learn more about view types &amp; layouts</a></div>')),this.select=$('<div tabindex="0" role="listbox" class="view-dropdown-select">\t<div class="view-dropdown-select__value">\t\t<div class="view-dropdown-select__value__icon"></div>\t\t<span class="view-dropdown-select__value__label">'+this.$el.data("label")+':</span>\t\t<span class="view-dropdown-select__value__selection"></span>\t</div>\t<div class="view-dropdown-select__toggle">\t\t<div class="view-dropdown-toggle__chevron"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12.5L10 7.5L15 12.5" stroke="#667085" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/></svg></div>\t</div></div>').insertAfter(this.$el),$(document.body).on("keyup",function(e){dropdown.open&&"Escape"===e.key&&dropdown.close()}).on("keydown",function(e){!dropdown.open||e.altKey||e.metaKey||e.ctrlKey||e.shiftKey||e.preventDefault(),dropdown.open&&-1<[" ","Enter","Tab"].indexOf(e.key)&&0<dropdown.$options_list.find(":focus").length&&e.preventDefault(),-1<["Enter"," ","ArrowUp","ArrowDown"].indexOf(e.key)&&dropdown.select.is(document.activeElement)&&e.preventDefault()}).on("click",function(e){!$.contains(dropdown.$wrapper.get(0),e.target)&&dropdown.open&&(e.preventDefault(),dropdown.close())}),$(this.select).on("click",$.proxy(this.toggle,dropdown)).on("keyup",$.proxy(this.handleKeySelect,this)),$el.on("change",$.proxy(this.close,dropdown)),$(this.$options_list).on("mousedown",'div.view-dropdown-list-item[aria-disabled="true"]',function(e){e.preventDefault()}).on("click","div.view-dropdown-list-item",function(e){const $item=$(this);if("true"===$item.attr("aria-disabled"))return"A"!==e.target.tagName&&e.preventDefault(),void 0!==$(e.target).data("action")&&(e.preventDefault(),$el.trigger({type:"gravityview/dropdown/"+$(e.target).data("action"),target:$item.data("option").get(0)})),e.stopPropagation(),void e.stopImmediatePropagation();$el.val($(this).data("value")),$el.trigger("change"),dropdown.focus()}).on("keyup","div.view-dropdown-list-item",$.proxy(this.handleKeyOption,this)),this.initialized=!0)},ViewDropDown.prototype.focus=function(){this.select.focus()},ViewDropDown.prototype.focusFirst=function(){this.open&&this.$options_list.find(".view-dropdown-list-item:first-child").focus()},ViewDropDown.prototype.focusLast=function(){this.open&&this.$options_list.find(".view-dropdown-list-item:last-child").focus()},ViewDropDown.prototype.focusUp=function(){if(this.open){var $focussed=this.$options_list.find(":focus");if($focussed.length){var $previous=$focussed.prev(".view-dropdown-list-item");for(0===$previous.length&&($previous=this.$options_list.find(".view-dropdown-list-item:last-child"));"true"===$previous.attr("aria-disabled")&&$previous!==$focussed;)$previous=$previous.prev(".view-dropdown-list-item");$previous&&$previous.focus()}}},ViewDropDown.prototype.focusDown=function(){if(this.open){var $focussed=this.$options_list.find(":focus");if($focussed.length){var $next=$focussed.next(".view-dropdown-list-item");for(0===$next.length&&($next=this.$options_list.find(".view-dropdown-list-item:first-child"));"true"===$next.attr("aria-disabled")&&$next!==$focussed;)0===($next=$next.next(".view-dropdown-list-item")).length&&($next=this.$options_list.find(".view-dropdown-list-item:first-child"));$next&&$next.focus()}}},ViewDropDown.prototype.handleKeySelect=function(e){e.preventDefault(),-1<["Enter"," ","ArrowUp","ArrowDown"].indexOf(e.key)&&this.toggle()},ViewDropDown.prototype.handleKeyOption=function(e){e.preventDefault(),"Enter"===e.key||" "===e.key?($(e.target).trigger("click"),this.close()):"ArrowUp"===e.key?this.focusUp():"ArrowDown"===e.key?this.focusDown():"Tab"===e.key?!0===e.shiftKey?this.focusUp():this.focusDown():"Home"===e.key?this.focusFirst():"End"===e.key&&this.focusLast()},ViewDropDown.prototype.storeValue=function(){this.$el.data("gv-view-value",this.$el.val())},ViewDropDown.prototype.restoreValue=function(){this.$el.val(this.$el.data("gv-view-value")),this.refresh()},ViewDropDown.prototype.renderOptions=function(){var $list=this.$options_list;$list.html("");const $dropdown=this.$el;this.$el.find("option").each(function(){var icon,license,buy_source,activate,id,$item,$option=$(this);""!==$option.val()&&(icon="",$option.data("icon")&&(icon='<img src="'+$option.data("icon")+'" alt="Icon" />'),license=$option.data("license"),buy_source=$option.data("buy-source"),activate=$option.data("activate"),$item=$option.data("download-id"),id="view-option-"+(Math.random()+1).toString(36).substring(2),$item=$('<div tabindex="0" id="'+id+'" role="option" aria-selected="false" class="view-dropdown-list-item" aria-disabled="'+$option.is(":disabled")+'" data-value="'+$option.val()+'">\t<div class="view-dropdown-list-item__icon">'+icon+"</div>"+(license?'<div class="view-dropdown-list-item__license hidden">\t<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">   \t<path d="M4 0C4.24397 0 4.45537 0.169044 4.50899 0.407096L4.77668 1.59548C4.95946 2.40689 5.59313 3.04056 6.40452 3.2233L7.5929 3.49099C7.83096 3.54463 8 3.75603 8 4C8 4.24397 7.83096 4.45537 7.5929 4.50901L6.40452 4.7767C5.59313 4.95944 4.95946 5.59311 4.77668 6.40452L4.50899 7.59291C4.45537 7.83096 4.24397 8 4 8C3.75603 8 3.54463 7.83096 3.49101 7.59291L3.22333 6.40452C3.04054 5.59311 2.40687 4.95944 1.59544 4.7767L0.407082 4.50901C0.169078 4.45537 0 4.24397 0 4C0 3.75603 0.169078 3.54463 0.407082 3.49099L1.59544 3.2233C2.40687 3.04056 3.04054 2.40689 3.22333 1.59548L3.49101 0.407096C3.54463 0.169044 3.75603 0 4 0Z" fill="currentColor"/>\t</svg>\t<span>'+license+"</span></div>":"")+'\t<div class="view-dropdown-list-item__value">\t\t<div class="view-dropdown-list-item__label">'+$option.data("title")+(buy_source?' <a class="view-dropdown-button--pill" href="'+buy_source+'" target="_blank">'+($dropdown.data("label-buy")||"Buy Now")+"</a>":"")+(activate?' <a role="button" data-action="activate" class="view-dropdown-button--pill" href="#">'+($dropdown.data("label-activate")||"Activate")+"</a>":"")+($item?' <a role="button" data-action="install" class="view-dropdown-button--pill" href="#">'+($dropdown.data("label-install")||"Install")+"</a>":"")+'\t\t</div>\t\t<div class="view-dropdown-list-item__description">'+$option.data("description")+"</div>\t</div></div>"),license&&$item.addClass("view-dropdown-list-item--license"),$item.data("option",$option),$list.append($item))})},ViewDropDown.prototype.toggle=function(){this.open=!this.open,this.refresh(),this.open&&this.focusActive()},ViewDropDown.prototype.focusActive=function(){this.$options_list.find("div.view-dropdown-list-item--active").focus()},ViewDropDown.prototype.close=function(){this.open=!1,this.refresh()},ViewDropDown.prototype.refresh=function(){this.$wrapper.toggleClass("view-dropdown--open",this.open);var value=this.$el.val(),$option=this.$el.find('option[value="'+value+'"]'),title=$option[0]?.innerText||"Select an option",icon="";$option.data("icon")&&(icon='<img src="'+$option.data("icon")+'" alt="Icon" />');var dropdown=this;value&&(title=$option.data("title"),this.$options_list.find("div.view-dropdown-list-item").each(function(){var active=$(this).data("value")===value;$(this).toggleClass("view-dropdown-list-item--active",$(this).data("value")===value).attr("aria-selected",active?"true":"false"),active&&dropdown.select.attr("aria-activedescendant",$(this).attr("id"))})),this.select.find(".view-dropdown-select__value__selection").html(title),this.select.find(".view-dropdown-select__value__icon").html(icon)},$.fn.extend({viewDropdown:function(){$(this).data("view-dropdown")||$(this).data("view-data",new ViewDropDown(this))}}),$(function(){$("select[data-view-dropdown]").each(function(){$(this).viewDropdown()})})}(jQuery);