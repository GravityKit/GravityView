($=>{function ViewDropDown(el){this.initialized=!1,this.$el=$(el),this.open=!1,this.init(),this.renderOptions()}ViewDropDown.prototype.init=function(){if(!this.initialized){let $el=this.$el,dropdown=this;this.storeValue(),$el.hide(),$el.wrap($('<div class="view-dropdown"></div>')),this.$wrapper=$el.closest("div.view-dropdown"),this.$options_wrapper=$(' <div class="view-dropdown-options"></div>'),this.$wrapper.append(this.$options_wrapper),this.$el.data("scope")&&this.$options_wrapper.append($('<div class="view-dropdown-options__header"><span>'+this.$el.data("scope")+" â€” "+this.$el.data("label")+"</span></div>")),this.$options_list=$('<div class="view-dropdown-list"></div>'),this.$options_wrapper.append($('<div class="view-dropdown-options__body"></div>').append(this.$options_list)),this.$options_wrapper.append($('<div class="view-dropdown-options__footer">\t<a target="_blank" href="https://docs.gravitykit.com/article/400-what-are-the-differences-between-the-view-types">\t\t<span>'+this.$el.data("label-learn-more")+'</span>\t\t<svg width="11" height="10" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">\t\t\t<path d="M1 9.16659L9.33333 0.833252M9.33333 0.833252H1M9.33333 0.833252V9.16659" stroke="#2271B1" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>\t\t</svg>\t</a></div>')),this.select=$('<div tabindex="0" role="listbox" class="view-dropdown-select">\t<div class="view-dropdown-select__value">\t\t<div class="view-dropdown-select__value__icon"></div>\t\t<span class="view-dropdown-select__value__label">'+this.$el.data("label")+':</span>\t\t<span class="view-dropdown-select__value__selection"></span>\t</div>\t<div class="view-dropdown-select__toggle">\t\t<div class="view-dropdown-toggle__chevron"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12.5L10 7.5L15 12.5" stroke="#667085" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/></svg></div>\t</div></div>').insertAfter(this.$el),$(document.body).on("keyup",function(e){dropdown.open&&"Escape"===e.key&&dropdown.close()}).on("keydown",function(e){!dropdown.open||e.altKey||e.metaKey||e.ctrlKey||e.shiftKey||e.preventDefault(),dropdown.open&&-1<[" ","Enter","Tab"].indexOf(e.key)&&0<dropdown.$options_list.find(":focus").length&&e.preventDefault(),-1<["Enter"," ","ArrowUp","ArrowDown"].indexOf(e.key)&&dropdown.select.is(document.activeElement)&&e.preventDefault()}).on("click",function(e){!$.contains(dropdown.$wrapper.get(0),e.target)&&dropdown.open&&(e.preventDefault(),dropdown.close())}),$(this.select).on("click",$.proxy(this.toggle,dropdown)).on("keyup",$.proxy(this.handleKeySelect,this)),$el.on("change",$.proxy(this.close,dropdown)),$(this.$options_list).on("mousedown",'div.view-dropdown-list-item[aria-disabled="true"]',function(e){e.preventDefault()}).on("click","div.view-dropdown-list-item",function(e){var action,$item=$(this);"true"===$item.attr("aria-disabled")?("A"!==e.target.tagName&&e.preventDefault(),void 0!==$(e.target).data("action")&&(e.preventDefault(),action=$(e.target).data("action"),$el.trigger({type:"gravityview/dropdown/"+action,target:e.target},{action:action,dropdown:dropdown,option:$item.data("option").get(0)})),e.stopPropagation(),e.stopImmediatePropagation()):($el.val($(this).data("value")),$el.trigger("change"),dropdown.focus())}).on("keyup","div.view-dropdown-list-item",$.proxy(this.handleKeyOption,this)),this.initialized=!0}},ViewDropDown.prototype.focus=function(){this.select.focus()},ViewDropDown.prototype.focusFirst=function(){this.open&&this.$options_list.find(".view-dropdown-list-item:first-child").focus()},ViewDropDown.prototype.focusLast=function(){this.open&&this.$options_list.find(".view-dropdown-list-item:last-child").focus()},ViewDropDown.prototype.focusUp=function(){if(this.open){var $focussed=this.$options_list.find(":focus");if($focussed.length){let $previous=$focussed.prev(".view-dropdown-list-item");for(0===$previous.length&&($previous=this.$options_list.find(".view-dropdown-list-item:last-child"));"true"===$previous.attr("aria-disabled")&&$previous!==$focussed;)$previous=$previous.prev(".view-dropdown-list-item");$previous&&$previous.focus()}}},ViewDropDown.prototype.focusDown=function(){if(this.open){var $focussed=this.$options_list.find(":focus");if($focussed.length){let $next=$focussed.next(".view-dropdown-list-item");for(0===$next.length&&($next=this.$options_list.find(".view-dropdown-list-item:first-child"));"true"===$next.attr("aria-disabled")&&$next!==$focussed;)0===($next=$next.next(".view-dropdown-list-item")).length&&($next=this.$options_list.find(".view-dropdown-list-item:first-child"));$next&&$next.focus()}}},ViewDropDown.prototype.handleKeySelect=function(e){e.preventDefault(),-1<["Enter"," ","ArrowUp","ArrowDown"].indexOf(e.key)&&this.toggle()},ViewDropDown.prototype.handleKeyOption=function(e){e.preventDefault(),"Enter"===e.key||" "===e.key?($(e.target).trigger("click"),this.close()):"ArrowUp"===e.key?this.focusUp():"ArrowDown"===e.key?this.focusDown():"Tab"===e.key?!0===e.shiftKey?this.focusUp():this.focusDown():"Home"===e.key?this.focusFirst():"End"===e.key&&this.focusLast()},ViewDropDown.prototype.storeValue=function(){this.$el.data("gv-view-value",this.$el.val())},ViewDropDown.prototype.restoreValue=function(){this.$el.val(this.$el.data("gv-view-value")),this.refresh()},ViewDropDown.prototype.renderOptions=function(){let $list=this.$options_list,placeholders=[],$dropdown=($list.html(""),this.$el);if(this.$el.find("option").each(function(){var $option=$(this);if(""!==$option.val()){let icon="";$option.data("icon")&&(icon='<img src="'+$option.data("icon")+'" alt="Icon" />');var action=$option.data("action"),id="view-option-"+(Math.random()+1).toString(36).substring(2),id=$("<div"+($option.is(":disabled")?"":' tabindex="0"')+' id="'+id+'" role="option" aria-selected="false" class="view-dropdown-list-item" aria-disabled="'+$option.is(":disabled")+'" data-value="'+$option.val()+'">\t<div class="view-dropdown-list-item__icon">'+icon+'</div>\t<div class="view-dropdown-list-item__value">\t\t<div class="view-dropdown-list-item__label">'+$option.data("title")+("activate"===action?' <a role="button" data-action="activate" class="view-dropdown-button--pill" href="#">'+($dropdown.data("label-activate")||"Activate")+"</a>":"")+("install"===action?' <a role="button" data-action="install" class="view-dropdown-button--pill" href="#">'+($dropdown.data("label-install")||"Install")+"</a>":"")+'\t\t</div>\t\t<div class="view-dropdown-list-item__description">'+$option.data("description")+"</div>\t</div></div>");id.data("option",$option),"buy"===action?placeholders.push(id):$list.append(id)}}),0<placeholders.length){let $available=$('<div class="view-dropdown-list-available">\t<div class="view-dropdown-list-available__header">\t\t<div class="view-dropdown-list-available__heading">\t\t\t<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 0C7.42695 0 7.79691 0.295826 7.89073 0.712418L8.35918 2.79209C8.67906 4.21205 9.78797 5.32097 11.2079 5.64078L13.2876 6.10923C13.7042 6.20309 14 6.57306 14 7C14 7.42694 13.7042 7.79691 13.2876 7.89077L11.2079 8.35922C9.78797 8.67903 8.67906 9.78795 8.35918 11.2079L7.89073 13.2876C7.79691 13.7042 7.42695 14 7 14C6.57305 14 6.2031 13.7042 6.10927 13.2876L5.64082 11.2079C5.32094 9.78795 4.21203 8.67903 2.79203 8.35922L0.712393 7.89077C0.295887 7.79691 0 7.42694 0 7C0 6.57306 0.295887 6.20309 0.712393 6.10923L2.79203 5.64078C4.21203 5.32097 5.32094 4.21205 5.64082 2.79209L6.10927 0.712418C6.2031 0.295826 6.57305 0 7 0Z" fill="white"/></svg>\t\t\t<span>'+($dropdown.data("label-available")||"Available")+'</span>\t\t</div>\t\t<div><a target="_blank" rel="nofollow noopener" class="view-dropdown-list-available__upgrade" href="https://www.gravitykit.com/pricing/?utm_campaign=gk_upsells&utm_source=view-editor&utm_content=upgrade">'+($dropdown.data("label-upgrade")||"Upgrade")+'</a></div>\t</div>\t<div class="view-dropdown-list-available__options"></div> </div>');$(placeholders).each(function(i,el){$available.find(".view-dropdown-list-available__options").append(el)}),$list.append($available)}this.refresh()},ViewDropDown.prototype.toggle=function(){this.open=!this.open,this.refresh(),this.open&&this.focusActive()},ViewDropDown.prototype.focusActive=function(){this.$options_list.find("div.view-dropdown-list-item--active").focus()},ViewDropDown.prototype.close=function(){this.open=!1,this.refresh()},ViewDropDown.prototype.refresh=function(){this.$wrapper.toggleClass("view-dropdown--open",this.open);var value=this.$el.val(),$option=this.$el.find('option[value="'+value+'"]'),title=$option[0]?.innerText||"Select an option",icon="",dropdown=($option.data("icon")&&(icon='<img src="'+$option.data("icon")+'" alt="Icon" />'),this);value&&(title=$option.data("title"),this.$options_list.find("div.view-dropdown-list-item").each(function(){var active=$(this).data("value")===value;$(this).toggleClass("view-dropdown-list-item--active",$(this).data("value")===value).attr("aria-selected",active?"true":"false"),active&&dropdown.select.attr("aria-activedescendant",$(this).attr("id"))})),this.select.find(".view-dropdown-select__value__selection").html(title),this.select.find(".view-dropdown-select__value__icon").html(icon)},$.fn.extend({viewDropdown:function(){return $(this).data("view-data")||$(this).data("view-data",new ViewDropDown(this)),$(this).data("view-data")}}),$(function(){$("select[data-view-dropdown]").each(function(){$(this).viewDropdown()})})})(jQuery);