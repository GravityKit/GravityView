($=>{let gridReorder={getRowContainer:function($row){return $row.closest(".gv-grid-rows-container")},markUnsavedChanges:function(){window?.viewConfiguration?.setUnsavedChanges&&window.viewConfiguration.setUnsavedChanges(!0)},updateRowReorderButtons:function($row){var $siblings=gridReorder.getRowContainer($row).children(".gv-grid-row.is-sortable"),index=$siblings.index($row),$up=$row.find(".gv-grid-row-move-up"),$row=$row.find(".gv-grid-row-move-down"),atTop=index<=0,index=index===$siblings.length-1;$up.attr("aria-hidden",atTop?"true":"false").toggle(!atTop),$row.attr("aria-hidden",index?"true":"false").toggle(!index)},refreshRowReorderButtons:function($container){($container=$container&&$container.length?$container:$(".gv-grid-rows-container")).children(".gv-grid-row.is-sortable").each(function(){gridReorder.updateRowReorderButtons($(this))})},announceRowMove:function($row){try{var $siblings=gridReorder.getRowContainer($row).children(".gv-grid-row.is-sortable"),index=$siblings.index($row);let $status=$("#gv-row-reorder-status");($status=0===$status.length?$("<div/>",{id:"gv-row-reorder-status",class:"screen-reader-text","aria-live":"polite",role:"status"}).appendTo(document.body):$status).text("Row moved to position "+(index+1)+" of "+$siblings.length+".")}catch(e){}},ensureFocus:function($el){if(!$el||!$el.length)return!1;function tryFocus(){if(attempts++,!$el.is(":visible"))return attempts<5?setTimeout(tryFocus,0):void 0;try{$el[0].focus({preventScroll:!0})}catch(e){$el.trigger("focus")}!(document.activeElement===$el[0])&&attempts<5&&setTimeout(tryFocus,0)}let attempts=0;return tryFocus(),!0},focusRowContainer:function($row){if($row&&$row.length)try{$row.attr("tabindex","-1"),$row[0].focus({preventScroll:!0}),setTimeout(function(){$row.removeAttr("tabindex")},250)}catch(e){}},focusRowControl:function($row,preferred){let $btn=$row.find("up"===preferred?".gv-grid-row-move-up":".gv-grid-row-move-down").filter(":visible");return!!($btn=$btn.length?$btn:$row.find("up"===preferred?".gv-grid-row-move-down":".gv-grid-row-move-up").filter(":visible")).length&&($btn.trigger("focus"),!0)},moveRow:function($row,delta,preferred,$usedBtn){if($row&&$row.length&&$row.hasClass("is-sortable")){let $container=gridReorder.getRowContainer($row);if($container.length){var $siblings=$container.children(".gv-grid-row.is-sortable"),newIndex=$siblings.index($row)+(delta<0?-1:1);if(!(newIndex<0||newIndex>=$siblings.length)){let $focused=$(document.activeElement),hadFocusInside=$.contains($row[0],$focused[0]);delta<0?$row.prev(".gv-grid-row.is-sortable").before($row):$row.next(".gv-grid-row.is-sortable").after($row),gridReorder.markUnsavedChanges(),setTimeout(function(){var $t;gridReorder.focusRowContainer($row),gridReorder.updateRowReorderButtons($row),gridReorder.announceRowMove($row),gridReorder.refreshRowReorderButtons($container),$usedBtn&&$usedBtn.length&&$usedBtn.is(":visible")?gridReorder.ensureFocus($usedBtn):gridReorder.focusRowControl($row,preferred)||(hadFocusInside&&$focused&&$focused.length&&$.contains($row[0],$focused[0])?gridReorder.ensureFocus($focused):($t=$row.find('.gv-grid-row-move-up:visible, .gv-grid-row-move-down:visible, button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').filter(":visible").first()).length&&gridReorder.ensureFocus($t))},0)}}}}},activateGrid=selector=>{$(selector).find(".gv-grid > .gv-grid-rows-container").each((i,grid)=>{var options={handle:"> .gv-grid-row-actions > .gv-grid-row-handle",items:"> .gv-grid-row.is-sortable",cancel:"input, textarea, select, option",distance:2,revert:75,placeholder:"grid-row-placeholder",forcePlaceholderSize:!0,stop:function(event,ui){gridReorder.markUnsavedChanges(),gridReorder.refreshRowReorderButtons($(this)),gridReorder.announceRowMove(ui.item)},receive:function(event,ui){let sender_area=ui.sender.closest(".gv-grid").data("grid-context"),receiver_area=$(this).closest(".gv-grid").data("grid-context");ui.item.attr("data-context",receiver_area),ui.item.find("[data-context]").attr("data-context",receiver_area),ui.item.find("[data-areaid]").attr("data-areaid",(_,area_id)=>area_id.replace(sender_area+"_",receiver_area+"_")),ui.item.find('[name*="['+sender_area+'_"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace("["+sender_area+"_","["+receiver_area+"_"))})}};let connectWith=$(grid).closest(".gv-grid").data("grid-connect");void 0!==connectWith&&(options.connectWith='[data-grid-connect="'+connectWith+'"] > .gv-grid-rows-container',options.start=()=>{$(selector).find('[data-grid-connect="'+connectWith+'"]').addClass("is-receivable")},options.stop=function(event,ui){$(selector).find('[data-grid-connect="'+connectWith+'"]').removeClass("is-receivable"),gridReorder.markUnsavedChanges(),gridReorder.refreshRowReorderButtons($(this)),gridReorder.announceRowMove(ui.item)}),$(grid).sortable(options)})};$(()=>{activateGrid(document),void 0!==window?.gvAdminActions&&(window.gvAdminActions.activateGrid=activateGrid,window.gvAdminActions.gridReorder=gridReorder),$(document).on("click",".gv-grid-row-delete",function(){let $row=$(this).closest(".gv-grid-row"),$fields=$row.find(".gv-fields");0<$fields.length&&!confirm($(this).data("confirm"))||$row.fadeOut("fast",()=>{$fields.each(function(){$(this).remove(),$(document.body).trigger("gravityview/field-removed",$(this))}),$row.remove(),$(document.body).trigger("gravityview/row-removed",$row)})}),$(document).on("keydown",".gv-grid-row-action:not(button)",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$(this).trigger("click"))}),$(document).on("click",".gv-grid-row-move-up",function(e){var $btn=$(this);$btn.data("gv-skip-click")?($btn.removeData("gv-skip-click"),e.preventDefault(),e.stopPropagation()):(e.preventDefault(),e.stopPropagation(),gridReorder.moveRow($btn.closest(".gv-grid-row"),-1,"up",$btn))}),$(document).on("click",".gv-grid-row-move-down",function(e){var $btn=$(this);$btn.data("gv-skip-click")?($btn.removeData("gv-skip-click"),e.preventDefault(),e.stopPropagation()):(e.preventDefault(),e.stopPropagation(),gridReorder.moveRow($btn.closest(".gv-grid-row"),1,"down",$btn))}),$(document).on("keydown",".gv-grid-row-move-up, .gv-grid-row-move-down",function(e){let $btn=$(this);var isUp=$btn.hasClass("gv-grid-row-move-up");" "===e.key||32===e.keyCode||"Enter"===e.key||13===e.keyCode?(e.preventDefault(),e.stopPropagation(),$btn.data("gv-skip-click",!0),setTimeout(function(){$btn.removeData("gv-skip-click")},250),isUp?gridReorder.moveRow($btn.closest(".gv-grid-row"),-1,"up",$btn):gridReorder.moveRow($btn.closest(".gv-grid-row"),1,"down",$btn)):"ArrowUp"===e.key||38===e.keyCode?(e.preventDefault(),gridReorder.moveRow($btn.closest(".gv-grid-row"),-1,"up",$btn)):"ArrowDown"!==e.key&&40!==e.keyCode||(e.preventDefault(),gridReorder.moveRow($btn.closest(".gv-grid-row"),1,"down",$btn))}),$(document).on("focusin",".gv-grid-row.is-sortable",function(){gridReorder.updateRowReorderButtons($(this))}),gridReorder.refreshRowReorderButtons(),$(document.body).on("gravityview/row-added",function(event,$row){$row&&$row.length&&($row=gridReorder.getRowContainer($row),gridReorder.refreshRowReorderButtons($row))}),$(document).on("click",".gv-grid-add-row .gv-toggle",function(e){var $add_row=$(this).closest(".gv-grid-add-row");$add_row.toggleClass("open"),$(this).attr("aria-expanded",$add_row.hasClass("open"))}).on("click",".gv-grid-add-row [data-add-row]",function(e){var $add_row_button=$(this);let $add_row=$(this).closest(".gv-grid-add-row"),zone=$add_row_button.data("add-row"),template_id=$add_row_button.data("template-id"),type=$add_row_button.data("type"),row_type=$add_row_button.data("row-type");$.post(ajaxurl,{action:"gv_create_row",template_id:template_id,nonce:gvGlobals.nonce,zone:zone,type:type,row_type:row_type,dataType:"json"}).always(()=>{$add_row.removeClass("open").find(".gv-toggle").attr("aria-expanded",!1).end().find("button").attr("tabindex","-1")}).done(response=>{response=JSON.parse(response),response=$(response?.row);response.appendTo($add_row.closest(".gv-grid").find("> .gv-grid-rows-container")),response.find("button").attr("tabindex",null).first().trigger("focus"),$(document.body).trigger("gravityview/row-added",response,{type:type,row_type:row_type,zone:zone,template_id:template_id}),window?.gvAdminActions?.initTooltips(),window?.gvAdminActions?.initDroppables(response)})})})})(jQuery);