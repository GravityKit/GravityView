(d=>{let s={getRowContainer:function(e){return e.closest(".gv-grid-rows-container")},markUnsavedChanges:function(){window?.viewConfiguration?.setUnsavedChanges&&window.viewConfiguration.setUnsavedChanges(!0)},updateRowReorderButtons:function(e){var t=s.getRowContainer(e).children(".gv-grid-row.is-sortable"),o=t.index(e),r=e.find(".gv-grid-row-move-up"),e=e.find(".gv-grid-row-move-down"),n=o<=0,o=o===t.length-1;r.attr("aria-hidden",n?"true":"false").toggle(!n),e.attr("aria-hidden",o?"true":"false").toggle(!o)},refreshRowReorderButtons:function(e){(e=e&&e.length?e:d(".gv-grid-rows-container")).children(".gv-grid-row.is-sortable").each(function(){s.updateRowReorderButtons(d(this))})},announceRowMove:function(t){try{var o=s.getRowContainer(t).children(".gv-grid-row.is-sortable"),r=o.index(t);let e=d("#gv-row-reorder-status");0===e.length&&(e=d("<div/>",{id:"gv-row-reorder-status",class:"screen-reader-text","aria-live":"polite",role:"status"}).appendTo(document.body));var n=(window.gvGlobals?.row_moved_to_position||"Row moved to position %1$s of %2$s.").replace("%1$s",r+1).replace("%2$s",o.length);e.text(n)}catch(e){}},ensureFocus:function(t){if(!t||!t.length)return!1;function e(){if(o++,!t.is(":visible"))return o<5?setTimeout(e,0):void 0;try{t[0].focus({preventScroll:!0})}catch(e){t.trigger("focus")}!(document.activeElement===t[0])&&o<5&&setTimeout(e,0)}let o=0;return e(),!0},focusRowContainer:function(e){if(e&&e.length)try{e.attr("tabindex","-1"),e[0].focus({preventScroll:!0}),setTimeout(function(){e.removeAttr("tabindex")},250)}catch(e){}},focusRowControl:function(e,t){let o=e.find("up"===t?".gv-grid-row-move-up":".gv-grid-row-move-down").filter(":visible");return!!(o=o.length?o:e.find("up"===t?".gv-grid-row-move-down":".gv-grid-row-move-up").filter(":visible")).length&&(o.trigger("focus"),!0)},moveRow:function(n,e,i,a){if(n&&n.length&&n.hasClass("is-sortable")){let r=s.getRowContainer(n);if(r.length){var t=r.children(".gv-grid-row.is-sortable"),o=t.index(n)+(e<0?-1:1);if(!(o<0||o>=t.length)){let t=d(document.activeElement),o=d.contains(n[0],t[0]);e<0?n.prev(".gv-grid-row.is-sortable").before(n):n.next(".gv-grid-row.is-sortable").after(n),s.markUnsavedChanges(),setTimeout(function(){var e;s.focusRowContainer(n),s.updateRowReorderButtons(n),s.announceRowMove(n),s.refreshRowReorderButtons(r),a&&a.length&&a.is(":visible")?s.ensureFocus(a):s.focusRowControl(n,i)||(o&&t&&t.length&&d.contains(n[0],t[0])?s.ensureFocus(t):(e=n.find('.gv-grid-row-move-up:visible, .gv-grid-row-move-down:visible, button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').filter(":visible").first()).length&&s.ensureFocus(e))},0)}}}}},e=n=>{d(n).find(".gv-grid > .gv-grid-rows-container").each((e,t)=>{var o={handle:"> .gv-grid-row-actions > .gv-grid-row-handle",items:"> .gv-grid-row.is-sortable",cancel:"input, textarea, select, option",distance:2,revert:75,placeholder:"grid-row-placeholder",forcePlaceholderSize:!0,stop:function(e,t){s.markUnsavedChanges(),s.refreshRowReorderButtons(d(this)),s.announceRowMove(t.item)},receive:function(e,t){let o=t.sender.closest(".gv-grid").data("grid-context"),r=d(this).closest(".gv-grid").data("grid-context");t.item.attr("data-context",r),t.item.find("[data-context]").attr("data-context",r),t.item.find("[data-areaid]").attr("data-areaid",(e,t)=>t.replace(o+"_",r+"_")),t.item.find('[name*="['+o+'_"]').each(function(){var e=d(this).attr("name");d(this).attr("name",e.replace("["+o+"_","["+r+"_"))})}};let r=d(t).closest(".gv-grid").data("grid-connect");void 0!==r&&(o.connectWith='[data-grid-connect="'+r+'"] > .gv-grid-rows-container',o.start=()=>{d(n).find('[data-grid-connect="'+r+'"]').addClass("is-receivable")},o.stop=function(e,t){d(n).find('[data-grid-connect="'+r+'"]').removeClass("is-receivable"),s.markUnsavedChanges(),s.refreshRowReorderButtons(d(this)),s.announceRowMove(t.item)}),d(t).sortable(o)})};d(()=>{e(document),void 0!==window?.gvAdminActions&&(window.gvAdminActions.activateGrid=e,window.gvAdminActions.gridReorder=s),d(document).on("click",".gv-grid-row-delete",function(){let e=d(this).closest(".gv-grid-row"),t=e.find(".gv-fields");0<t.length&&!confirm(d(this).data("confirm"))||e.fadeOut("fast",()=>{t.each(function(){d(this).remove(),d(document.body).trigger("gravityview/field-removed",d(this))}),e.remove(),d(document.body).trigger("gravityview/row-removed",e)})}),d(document).on("keydown",".gv-grid-row-action:not(button)",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),d(this).trigger("click"))}),d(document).on("click",".gv-grid-row-move-up",function(e){var t=d(this);t.data("gv-skip-click")?(t.removeData("gv-skip-click"),e.preventDefault(),e.stopPropagation()):(e.preventDefault(),e.stopPropagation(),s.moveRow(t.closest(".gv-grid-row"),-1,"up",t))}),d(document).on("click",".gv-grid-row-move-down",function(e){var t=d(this);t.data("gv-skip-click")?(t.removeData("gv-skip-click"),e.preventDefault(),e.stopPropagation()):(e.preventDefault(),e.stopPropagation(),s.moveRow(t.closest(".gv-grid-row"),1,"down",t))}),d(document).on("keydown",".gv-grid-row-move-up, .gv-grid-row-move-down",function(e){let t=d(this);var o=t.hasClass("gv-grid-row-move-up");" "===e.key||32===e.keyCode||"Enter"===e.key||13===e.keyCode?(e.preventDefault(),e.stopPropagation(),t.data("gv-skip-click",!0),setTimeout(function(){t.removeData("gv-skip-click")},250),o?s.moveRow(t.closest(".gv-grid-row"),-1,"up",t):s.moveRow(t.closest(".gv-grid-row"),1,"down",t)):"ArrowUp"===e.key||38===e.keyCode?(e.preventDefault(),s.moveRow(t.closest(".gv-grid-row"),-1,"up",t)):"ArrowDown"!==e.key&&40!==e.keyCode||(e.preventDefault(),s.moveRow(t.closest(".gv-grid-row"),1,"down",t))}),d(document).on("focusin",".gv-grid-row.is-sortable",function(){s.updateRowReorderButtons(d(this))}),s.refreshRowReorderButtons(),d(document.body).on("gravityview/row-added",function(e,t){t&&t.length&&(t=s.getRowContainer(t),s.refreshRowReorderButtons(t))}),d(document).on("click",".gv-grid-add-row .gv-toggle",function(e){var t=d(this).closest(".gv-grid-add-row");t.toggleClass("open"),d(this).attr("aria-expanded",t.hasClass("open"))}).on("click",".gv-grid-add-row [data-add-row]",function(e){var t=d(this);let o=d(this).closest(".gv-grid-add-row"),r=t.data("add-row"),n=t.data("template-id"),i=t.data("type"),a=t.data("row-type");d.post(ajaxurl,{action:"gv_create_row",template_id:n,nonce:gvGlobals.nonce,zone:r,type:i,row_type:a,dataType:"json"}).always(()=>{o.removeClass("open").find(".gv-toggle").attr("aria-expanded",!1).end().find("button").attr("tabindex","-1")}).done(e=>{e=JSON.parse(e),e=d(e?.row);e.appendTo(o.closest(".gv-grid").find("> .gv-grid-rows-container")),e.find("button").attr("tabindex",null).first().trigger("focus"),d(document.body).trigger("gravityview/row-added",e,{type:i,row_type:a,zone:r,template_id:n}),window?.gvAdminActions?.initTooltips(),window?.gvAdminActions?.initDroppables(e)})})})})(jQuery);